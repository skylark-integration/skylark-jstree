{"version":3,"sources":["plugin/unique.js"],"names":["define","langx","browser","eventer","noder","geom","velm","$","jstree","sbswt","plugins","unique","defaults","case_sensitive","trim_whitespace","duplicate","name","counter","options","parent","this","check","chk","obj","par","pos","more","call","id","get_node","children","i","j","t","n","text","c","s","settings","w","m","_model","data","length","toLowerCase","replace","push","inArray","_data","core","last_error","error","plugin","reason","JSON","stringify","is_multi","create_node","node","callback","is_loaded","undefined","root","toString","match","tmp","dpc","cb","get_string"],"mappings":"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","file":"../../plugin/unique.js","sourcesContent":["define([\n  \"skylark-utils/langx\",\n  \"skylark-utils/browser\",\n  \"skylark-utils/eventer\",\n  \"skylark-utils/noder\",\n  \"skylark-utils/geom\",\n  \"skylark-utils/velm\",\n  \"skylark-utils/query\",\n  \"../tree\",\n  \"skylark-ui-swt/sbswt\"\n],function(langx,browser,eventer,noder,geom,velm,$,jstree,sbswt){\n\t\"use strict\";\n\n\tif($.jstree.plugins.unique) { return; }\n\n\t/**\n\t * stores all defaults for the unique plugin\n\t * @name $.jstree.defaults.unique\n\t * @plugin unique\n\t */\n\t$.jstree.defaults.unique = {\n\t\t/**\n\t\t * Indicates if the comparison should be case sensitive. Default is `false`.\n\t\t * @name $.jstree.defaults.unique.case_sensitive\n\t\t * @plugin unique\n\t\t */\n\t\tcase_sensitive : false,\n\t\t/**\n\t\t * Indicates if white space should be trimmed before the comparison. Default is `false`.\n\t\t * @name $.jstree.defaults.unique.trim_whitespace\n\t\t * @plugin unique\n\t\t */\n\t\ttrim_whitespace : false,\n\t\t/**\n\t\t * A callback executed in the instance's scope when a new node is created and the name is already taken, the two arguments are the conflicting name and the counter. The default will produce results like `New node (2)`.\n\t\t * @name $.jstree.defaults.unique.duplicate\n\t\t * @plugin unique\n\t\t */\n\t\tduplicate : function (name, counter) {\n\t\t\treturn name + ' (' + counter + ')';\n\t\t}\n\t};\n\n\t$.jstree.plugins.unique = function (options, parent) {\n\t\tthis.check = function (chk, obj, par, pos, more) {\n\t\t\tif(parent.check.call(this, chk, obj, par, pos, more) === false) { return false; }\n\t\t\tobj = obj && obj.id ? obj : this.get_node(obj);\n\t\t\tpar = par && par.id ? par : this.get_node(par);\n\t\t\tif(!par || !par.children) { return true; }\n\t\t\tvar n = chk === \"rename_node\" ? pos : obj.text,\n\t\t\t\tc = [],\n\t\t\t\ts = this.settings.unique.case_sensitive,\n\t\t\t\tw = this.settings.unique.trim_whitespace,\n\t\t\t\tm = this._model.data, i, j, t;\n\t\t\tfor(i = 0, j = par.children.length; i < j; i++) {\n\t\t\t\tt = m[par.children[i]].text;\n\t\t\t\tif (!s) {\n\t\t\t\t\tt = t.toLowerCase();\n\t\t\t\t}\n\t\t\t\tif (w) {\n\t\t\t\t\tt = t.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n\t\t\t\t}\n\t\t\t\tc.push(t);\n\t\t\t}\n\t\t\tif(!s) { n = n.toLowerCase(); }\n\t\t\tif (w) { n = n.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, ''); }\n\t\t\tswitch(chk) {\n\t\t\t\tcase \"delete_node\":\n\t\t\t\t\treturn true;\n\t\t\t\tcase \"rename_node\":\n\t\t\t\t\tt = obj.text || '';\n\t\t\t\t\tif (!s) {\n\t\t\t\t\t\tt = t.toLowerCase();\n\t\t\t\t\t}\n\t\t\t\t\tif (w) {\n\t\t\t\t\t\tt = t.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n\t\t\t\t\t}\n\t\t\t\t\ti = ($.inArray(n, c) === -1 || (obj.text && t === n));\n\t\t\t\t\tif(!i) {\n\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_01', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\n\t\t\t\t\t}\n\t\t\t\t\treturn i;\n\t\t\t\tcase \"create_node\":\n\t\t\t\t\ti = ($.inArray(n, c) === -1);\n\t\t\t\t\tif(!i) {\n\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_04', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\n\t\t\t\t\t}\n\t\t\t\t\treturn i;\n\t\t\t\tcase \"copy_node\":\n\t\t\t\t\ti = ($.inArray(n, c) === -1);\n\t\t\t\t\tif(!i) {\n\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_02', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\n\t\t\t\t\t}\n\t\t\t\t\treturn i;\n\t\t\t\tcase \"move_node\":\n\t\t\t\t\ti = ( (obj.parent === par.id && (!more || !more.is_multi)) || $.inArray(n, c) === -1);\n\t\t\t\t\tif(!i) {\n\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'unique', 'id' : 'unique_03', 'reason' : 'Child with name ' + n + ' already exists. Preventing: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\n\t\t\t\t\t}\n\t\t\t\t\treturn i;\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t\tthis.create_node = function (par, node, pos, callback, is_loaded) {\n\t\t\tif(!node || node.text === undefined) {\n\t\t\t\tif(par === null) {\n\t\t\t\t\tpar = $.jstree.root;\n\t\t\t\t}\n\t\t\t\tpar = this.get_node(par);\n\t\t\t\tif(!par) {\n\t\t\t\t\treturn parent.create_node.call(this, par, node, pos, callback, is_loaded);\n\t\t\t\t}\n\t\t\t\tpos = pos === undefined ? \"last\" : pos;\n\t\t\t\tif(!pos.toString().match(/^(before|after)$/) && !is_loaded && !this.is_loaded(par)) {\n\t\t\t\t\treturn parent.create_node.call(this, par, node, pos, callback, is_loaded);\n\t\t\t\t}\n\t\t\t\tif(!node) { node = {}; }\n\t\t\t\tvar tmp, n, dpc, i, j, m = this._model.data, s = this.settings.unique.case_sensitive, w = this.settings.unique.trim_whitespace, cb = this.settings.unique.duplicate, t;\n\t\t\t\tn = tmp = this.get_string('New node');\n\t\t\t\tdpc = [];\n\t\t\t\tfor(i = 0, j = par.children.length; i < j; i++) {\n\t\t\t\t\tt = m[par.children[i]].text;\n\t\t\t\t\tif (!s) {\n\t\t\t\t\t\tt = t.toLowerCase();\n\t\t\t\t\t}\n\t\t\t\t\tif (w) {\n\t\t\t\t\t\tt = t.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n\t\t\t\t\t}\n\t\t\t\t\tdpc.push(t);\n\t\t\t\t}\n\t\t\t\ti = 1;\n\t\t\t\tt = n;\n\t\t\t\tif (!s) {\n\t\t\t\t\tt = t.toLowerCase();\n\t\t\t\t}\n\t\t\t\tif (w) {\n\t\t\t\t\tt = t.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n\t\t\t\t}\n\t\t\t\twhile($.inArray(t, dpc) !== -1) {\n\t\t\t\t\tn = cb.call(this, tmp, (++i)).toString();\n\t\t\t\t\tt = n;\n\t\t\t\t\tif (!s) {\n\t\t\t\t\t\tt = t.toLowerCase();\n\t\t\t\t\t}\n\t\t\t\t\tif (w) {\n\t\t\t\t\t\tt = t.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tnode.text = n;\n\t\t\t}\n\t\t\treturn parent.create_node.call(this, par, node, pos, callback, is_loaded);\n\t\t};\n\t};\n\n\t// include the unique plugin by default\n\t// $.jstree.defaults.plugins.push(\"unique\");\n\treturn $;\n\t\n});\n"]}