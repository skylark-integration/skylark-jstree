{"version":3,"sources":["plugin/contextmenu.js"],"names":["define","langx","browser","eventer","noder","geom","velm","$","menu","jstree","plugins","contextmenu","defaults","select_node","show_at_node","items","o","cb","create","separator_before","separator_after","_disabled","label","action","data","inst","reference","obj","get_node","create_node","new_node","edit","ex","setTimeout","rename","remove","icon","is_selected","delete_node","get_selected","ccp","submenu","cut","get_top_selected","copy","paste","can_paste","options","parent","this","bind","call","ey","last_ts","cto","element","on","proxy","get_container_ul","addClass","e","target","tagName","toLowerCase","preventDefault","ctrlKey","Date","clearTimeout","is_loading","currentTarget","show_contextmenu","pageX","pageY","_data","visible","hide","originalEvent","changedTouches","clientX","clientY","trigger","Math","abs","document","removeClass","teardown","x","y","id","root","s","settings","d","a","children","i","undefined","offset","left","top","core","li_height","activate_node","isFunction","_show_contextmenu","isPlainObject","one","cls","get_theme","popup","node"],"mappings":"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","file":"../../plugin/contextmenu.js","sourcesContent":["define([\n  \"skylark-utils/langx\",\n  \"skylark-utils/browser\",\n  \"skylark-utils/eventer\",\n  \"skylark-utils/noder\",\n  \"skylark-utils/geom\",\n  \"skylark-utils/velm\",\n  \"skylark-utils/query\",\n  \"./menu\",\n  \"../tree\"\n],function(langx,browser,eventer,noder,geom,velm,$, menu,jstree){\n\n\t\"use strict\";\n\n\tif($.jstree.plugins.contextmenu) { return; }\n\n\t/**\n\t * stores all defaults for the contextmenu plugin\n\t * @name $.jstree.defaults.contextmenu\n\t * @plugin contextmenu\n\t */\n\t$.jstree.defaults.contextmenu = {\n\t\t/**\n\t\t * a boolean indicating if the node should be selected when the context menu is invoked on it. Defaults to `true`.\n\t\t * @name $.jstree.defaults.contextmenu.select_node\n\t\t * @plugin contextmenu\n\t\t */\n\t\tselect_node : true,\n\t\t/**\n\t\t * a boolean indicating if the menu should be shown aligned with the node. Defaults to `true`, otherwise the mouse coordinates are used.\n\t\t * @name $.jstree.defaults.contextmenu.show_at_node\n\t\t * @plugin contextmenu\n\t\t */\n\t\tshow_at_node : true,\n\t\t/**\n\t\t * an object of actions, or a function that accepts a node and a callback function and calls the callback function with an object of actions available for that node (you can also return the items too).\n\t\t *\n\t\t * Each action consists of a key (a unique name) and a value which is an object with the following properties (only label and action are required). Once a menu item is activated the `action` function will be invoked with an object containing the following keys: item - the contextmenu item definition as seen below, reference - the DOM node that was used (the tree node), element - the contextmenu DOM element, position - an object with x/y properties indicating the position of the menu.\n\t\t *\n\t\t * * `separator_before` - a boolean indicating if there should be a separator before this item\n\t\t * * `separator_after` - a boolean indicating if there should be a separator after this item\n\t\t * * `_disabled` - a boolean indicating if this action should be disabled\n\t\t * * `label` - a string - the name of the action (could be a function returning a string)\n\t\t * * `title` - a string - an optional tooltip for the item\n\t\t * * `action` - a function to be executed if this item is chosen, the function will receive \n\t\t * * `icon` - a string, can be a path to an icon or a className, if using an image that is in the current directory use a `./` prefix, otherwise it will be detected as a class\n\t\t * * `shortcut` - keyCode which will trigger the action if the menu is open (for example `113` for rename, which equals F2)\n\t\t * * `shortcut_label` - shortcut label (like for example `F2` for rename)\n\t\t * * `submenu` - an object with the same structure as $.jstree.defaults.contextmenu.items which can be used to create a submenu - each key will be rendered as a separate option in a submenu that will appear once the current item is hovered\n\t\t *\n\t\t * @name $.jstree.defaults.contextmenu.items\n\t\t * @plugin contextmenu\n\t\t */\n\t\titems : function (o, cb) { // Could be an object directly\n\t\t\treturn {\n\t\t\t\t\"create\" : {\n\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\"separator_after\"\t: true,\n\t\t\t\t\t\"_disabled\"\t\t\t: false, //(this.check(\"create_node\", data.reference, {}, \"last\")),\n\t\t\t\t\t\"label\"\t\t\t\t: \"Create\",\n\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\tinst.create_node(obj, {}, \"last\", function (new_node) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tinst.edit(new_node);\n\t\t\t\t\t\t\t} catch (ex) {\n\t\t\t\t\t\t\t\tsetTimeout(function () { inst.edit(new_node); },0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"rename\" : {\n\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\"_disabled\"\t\t\t: false, //(this.check(\"rename_node\", data.reference, this.get_parent(data.reference), \"\")),\n\t\t\t\t\t\"label\"\t\t\t\t: \"Rename\",\n\t\t\t\t\t/*!\n\t\t\t\t\t\"shortcut\"\t\t\t: 113,\n\t\t\t\t\t\"shortcut_label\"\t: 'F2',\n\t\t\t\t\t\"icon\"\t\t\t\t: \"glyphicon glyphicon-leaf\",\n\t\t\t\t\t*/\n\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\tinst.edit(obj);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"remove\" : {\n\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\"icon\"\t\t\t\t: false,\n\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\"_disabled\"\t\t\t: false, //(this.check(\"delete_node\", data.reference, this.get_parent(data.reference), \"\")),\n\t\t\t\t\t\"label\"\t\t\t\t: \"Delete\",\n\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\tif(inst.is_selected(obj)) {\n\t\t\t\t\t\t\tinst.delete_node(inst.get_selected());\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tinst.delete_node(obj);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t\"ccp\" : {\n\t\t\t\t\t\"separator_before\"\t: true,\n\t\t\t\t\t\"icon\"\t\t\t\t: false,\n\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\"label\"\t\t\t\t: \"Edit\",\n\t\t\t\t\t\"action\"\t\t\t: false,\n\t\t\t\t\t\"submenu\" : {\n\t\t\t\t\t\t\"cut\" : {\n\t\t\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\t\t\"label\"\t\t\t\t: \"Cut\",\n\t\t\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\t\t\tif(inst.is_selected(obj)) {\n\t\t\t\t\t\t\t\t\tinst.cut(inst.get_top_selected());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tinst.cut(obj);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"copy\" : {\n\t\t\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\t\t\"icon\"\t\t\t\t: false,\n\t\t\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\t\t\"label\"\t\t\t\t: \"Copy\",\n\t\t\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\t\t\tif(inst.is_selected(obj)) {\n\t\t\t\t\t\t\t\t\tinst.copy(inst.get_top_selected());\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tinst.copy(obj);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t\"paste\" : {\n\t\t\t\t\t\t\t\"separator_before\"\t: false,\n\t\t\t\t\t\t\t\"icon\"\t\t\t\t: false,\n\t\t\t\t\t\t\t\"_disabled\"\t\t\t: function (data) {\n\t\t\t\t\t\t\t\treturn !$.jstree.reference(data.reference).can_paste();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\"separator_after\"\t: false,\n\t\t\t\t\t\t\t\"label\"\t\t\t\t: \"Paste\",\n\t\t\t\t\t\t\t\"action\"\t\t\t: function (data) {\n\t\t\t\t\t\t\t\tvar inst = $.jstree.reference(data.reference),\n\t\t\t\t\t\t\t\t\tobj = inst.get_node(data.reference);\n\t\t\t\t\t\t\t\tinst.paste(obj);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t};\n\n\t$.jstree.plugins.contextmenu = function (options, parent) {\n\t\tthis.bind = function () {\n\t\t\tparent.bind.call(this);\n\n\t\t\tvar last_ts = 0, cto = null, ex, ey;\n\t\t\tthis.element\n\t\t\t\t.on(\"init.jstree loading.jstree ready.jstree\", $.proxy(function () {\n\t\t\t\t\t\tthis.get_container_ul().addClass('jstree-contextmenu');\n\t\t\t\t\t}, this))\n\t\t\t\t.on(\"contextmenu.jstree\", \".jstree-anchor\", $.proxy(function (e, data) {\n\t\t\t\t\t\tif (e.target.tagName.toLowerCase() === 'input') {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tlast_ts = e.ctrlKey ? +new Date() : 0;\n\t\t\t\t\t\tif(data || cto) {\n\t\t\t\t\t\t\tlast_ts = (+new Date()) + 10000;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(cto) {\n\t\t\t\t\t\t\tclearTimeout(cto);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(!this.is_loading(e.currentTarget)) {\n\t\t\t\t\t\t\tthis.show_contextmenu(e.currentTarget, e.pageX, e.pageY, e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this))\n\t\t\t\t.on(\"click.jstree\", \".jstree-anchor\", $.proxy(function (e) {\n\t\t\t\t\t\tif(this._data.contextmenu.visible && (!last_ts || (+new Date()) - last_ts > 250)) { // work around safari & macOS ctrl+click\n\t\t\t\t\t\t\tmenu.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlast_ts = 0;\n\t\t\t\t\t}, this))\n\t\t\t\t.on(\"touchstart.jstree\", \".jstree-anchor\", function (e) {\n\t\t\t\t\t\tif(!e.originalEvent || !e.originalEvent.changedTouches || !e.originalEvent.changedTouches[0]) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tex = e.originalEvent.changedTouches[0].clientX;\n\t\t\t\t\t\tey = e.originalEvent.changedTouches[0].clientY;\n\t\t\t\t\t\tcto = setTimeout(function () {\n\t\t\t\t\t\t\t$(e.currentTarget).trigger('contextmenu', true);\n\t\t\t\t\t\t}, 750);\n\t\t\t\t\t})\n\t\t\t\t.on('touchmove.vakata.jstree', function (e) {\n\t\t\t\t\t\tif(cto && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0] && (Math.abs(ex - e.originalEvent.changedTouches[0].clientX) > 10 || Math.abs(ey - e.originalEvent.changedTouches[0].clientY) > 10)) {\n\t\t\t\t\t\t\tclearTimeout(cto);\n\t\t\t\t\t\t\tmenu.hide();\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t.on('touchend.vakata.jstree', function (e) {\n\t\t\t\t\t\tif(cto) {\n\t\t\t\t\t\t\tclearTimeout(cto);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t/*!\n\t\t\tif(!('oncontextmenu' in document.body) && ('ontouchstart' in document.body)) {\n\t\t\t\tvar el = null, tm = null;\n\t\t\t\tthis.element\n\t\t\t\t\t.on(\"touchstart\", \".jstree-anchor\", function (e) {\n\t\t\t\t\t\tel = e.currentTarget;\n\t\t\t\t\t\ttm = +new Date();\n\t\t\t\t\t\t$(document).one(\"touchend\", function (e) {\n\t\t\t\t\t\t\te.target = document.elementFromPoint(e.originalEvent.targetTouches[0].pageX - window.pageXOffset, e.originalEvent.targetTouches[0].pageY - window.pageYOffset);\n\t\t\t\t\t\t\te.currentTarget = e.target;\n\t\t\t\t\t\t\ttm = ((+(new Date())) - tm);\n\t\t\t\t\t\t\tif(e.target === el && tm > 600 && tm < 1000) {\n\t\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t\t$(el).trigger('contextmenu', e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tel = null;\n\t\t\t\t\t\t\ttm = null;\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t}\n\t\t\t*/\n\t\t\t$(document).on(\"context_hide.sbswt.popup\", $.proxy(function (e, data) {\n\t\t\t\tthis._data.contextmenu.visible = false;\n\t\t\t\t$(data.reference).removeClass('jstree-context');\n\t\t\t}, this));\n\t\t};\n\t\tthis.teardown = function () {\n\t\t\tif(this._data.contextmenu.visible) {\n\t\t\t\tmenu.hide();\n\t\t\t}\n\t\t\tparent.teardown.call(this);\n\t\t};\n\n\t\t/**\n\t\t * prepare and show the context menu for a node\n\t\t * @name show_contextmenu(obj [, x, y])\n\t\t * @param {mixed} obj the node\n\t\t * @param {Number} x the x-coordinate relative to the document to show the menu at\n\t\t * @param {Number} y the y-coordinate relative to the document to show the menu at\n\t\t * @param {Object} e the event if available that triggered the contextmenu\n\t\t * @plugin contextmenu\n\t\t * @trigger show_contextmenu.jstree\n\t\t */\n\t\tthis.show_contextmenu = function (obj, x, y, e) {\n\t\t\tobj = this.get_node(obj);\n\t\t\tif(!obj || obj.id === $.jstree.root) { return false; }\n\t\t\tvar s = this.settings.contextmenu,\n\t\t\t\td = this.get_node(obj, true),\n\t\t\t\ta = d.children(\".jstree-anchor\"),\n\t\t\t\to = false,\n\t\t\t\ti = false;\n\t\t\tif(s.show_at_node || x === undefined || y === undefined) {\n\t\t\t\to = a.offset();\n\t\t\t\tx = o.left;\n\t\t\t\ty = o.top + this._data.core.li_height;\n\t\t\t}\n\t\t\tif(this.settings.contextmenu.select_node && !this.is_selected(obj)) {\n\t\t\t\tthis.activate_node(obj, e);\n\t\t\t}\n\n\t\t\ti = s.items;\n\t\t\tif($.isFunction(i)) {\n\t\t\t\ti = i.call(this, obj, $.proxy(function (i) {\n\t\t\t\t\tthis._show_contextmenu(obj, x, y, i);\n\t\t\t\t}, this));\n\t\t\t}\n\t\t\tif($.isPlainObject(i)) {\n\t\t\t\tthis._show_contextmenu(obj, x, y, i);\n\t\t\t}\n\t\t};\n\t\t/**\n\t\t * show the prepared context menu for a node\n\t\t * @name _show_contextmenu(obj, x, y, i)\n\t\t * @param {mixed} obj the node\n\t\t * @param {Number} x the x-coordinate relative to the document to show the menu at\n\t\t * @param {Number} y the y-coordinate relative to the document to show the menu at\n\t\t * @param {Number} i the object of items to show\n\t\t * @plugin contextmenu\n\t\t * @trigger show_contextmenu.jstree\n\t\t * @private\n\t\t */\n\t\tthis._show_contextmenu = function (obj, x, y, i) {\n\t\t\tvar d = this.get_node(obj, true),\n\t\t\t\ta = d.children(\".jstree-anchor\");\n\t\t\t$(document).one(\"context_show.sbswt.popup\", $.proxy(function (e, data) {\n\t\t\t\tvar cls = 'jstree-contextmenu jstree-' + this.get_theme() + '-contextmenu';\n\t\t\t\t$(data.element).addClass(cls);\n\t\t\t\ta.addClass('jstree-context');\n\t\t\t}, this));\n\t\t\tthis._data.contextmenu.visible = true;\n\t\t\tmenu.popup(a, { 'x' : x, 'y' : y }, i);\n\t\t\t/**\n\t\t\t * triggered when the contextmenu is shown for a node\n\t\t\t * @event\n\t\t\t * @name show_contextmenu.jstree\n\t\t\t * @param {Object} node the node\n\t\t\t * @param {Number} x the x-coordinate of the menu relative to the document\n\t\t\t * @param {Number} y the y-coordinate of the menu relative to the document\n\t\t\t * @plugin contextmenu\n\t\t\t */\n\t\t\tthis.trigger('show_contextmenu', { \"node\" : obj, \"x\" : x, \"y\" : y });\n\t\t};\n\t};\n\n\t// $.jstree.defaults.plugins.push(\"contextmenu\");\n\n\treturn $;\n\t\n});\n"]}