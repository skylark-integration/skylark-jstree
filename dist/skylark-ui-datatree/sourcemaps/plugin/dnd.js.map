{"version":3,"sources":["plugin/dnd.js"],"names":["define","langx","browser","eventer","noder","geom","velm","$","jstree","plugins","dnd","defaults","copy","open_timeout","is_draggable","check_while_dragging","always_copy","inside_pos","drag_selection","touch","large_drop_target","large_drag_target","use_html5","drg","elm","options","parent","this","init","el","call","settings","document","createElement","bind","element","on","proxy","e","target","closest","currentTarget","type","children","hasClass","obj","get_node","mlt","is_selected","get_top_selected","length","txt","get_string","get_text","core","force_text","vakata","html","escape","id","root","which","isFunction","origin","nodes","trigger","start","get_theme","get_theme_variant","themes","responsive","_trigger","helper","data","preventDefault","redraw_node","deep","callback","force_render","apply","arguments","setAttribute","i","j","tmp","childNodes","className","indexOf","lastmv","laster","lastev","opento","marker","hide","appendTo","body","isDifferentNode","event","clearTimeout","l","t","h","p","o","ok","t1","t2","op","ps","pr","ip","tm","is_copy","pn","ins","reference","ref","off","rel","_data","attr","metaKey","ctrlKey","find","first","get_container_ul","is","offset","undefined","pageY","originalEvent","top","outerHeight","each","v","left","get_parent","index","Math","min","inArray","check","pos","is_multi","is_foreign","last_error","setTimeout","x","z","open_node","removeClass","addClass","par","is_loaded","css","show","dataTransfer","dropEffect","detach","error","_get","_clean","div","str","text","strip","empty","append","parseHTML","vakata_dnd","is_down","is_drag","helper_w","init_x","init_y","scroll_l","scroll_t","scroll_e","scroll_i","is_touch","scroll_speed","scroll_proximity","helper_left","helper_top","threshold","threshold_touch","event_name","remove","clearInterval","drag","stop","_scroll","init_only","setInterval","scrollTop","scrollLeft","changedTouches","pageX","elementFromPoint","window","pageXOffset","pageYOffset","unselectable","onselectstart","style","touchAction","msTouchAction","MozUserSelect","ignore","display","margin","padding","position","lineHeight","zIndex","abs","outerWidth","one","d","w","dh","wh","dw","ww","dt","dl","ht","hl","parentsUntil","addBack","get","reverse","filter","test","scrollHeight","offsetHeight","scrollWidth","offsetWidth","height","width","parseInt","to","click"],"mappings":"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","file":"../../plugin/dnd.js","sourcesContent":["define([\n  \"skylark-utils/langx\",\n  \"skylark-utils/browser\",\n  \"skylark-utils/eventer\",\n  \"skylark-utils/noder\",\n  \"skylark-utils/geom\",\n  \"skylark-utils/velm\",\n  \"skylark-utils/query\",\n  \"../tree\"\n],function(langx,browser,eventer,noder,geom,velm,$,jstree){\n\n\t\"use strict\";\n\n\tif($.jstree.plugins.dnd) { return; }\n\n\t/**\n\t * stores all defaults for the drag'n'drop plugin\n\t * @name $.jstree.defaults.dnd\n\t * @plugin dnd\n\t */\n\t$.jstree.defaults.dnd = {\n\t\t/**\n\t\t * a boolean indicating if a copy should be possible while dragging (by pressint the meta key or Ctrl). Defaults to `true`.\n\t\t * @name $.jstree.defaults.dnd.copy\n\t\t * @plugin dnd\n\t\t */\n\t\tcopy : true,\n\t\t/**\n\t\t * a number indicating how long a node should remain hovered while dragging to be opened. Defaults to `500`.\n\t\t * @name $.jstree.defaults.dnd.open_timeout\n\t\t * @plugin dnd\n\t\t */\n\t\topen_timeout : 500,\n\t\t/**\n\t\t * a function invoked each time a node is about to be dragged, invoked in the tree's scope and receives the nodes about to be dragged as an argument (array) and the event that started the drag - return `false` to prevent dragging\n\t\t * @name $.jstree.defaults.dnd.is_draggable\n\t\t * @plugin dnd\n\t\t */\n\t\tis_draggable : true,\n\t\t/**\n\t\t * a boolean indicating if checks should constantly be made while the user is dragging the node (as opposed to checking only on drop), default is `true`\n\t\t * @name $.jstree.defaults.dnd.check_while_dragging\n\t\t * @plugin dnd\n\t\t */\n\t\tcheck_while_dragging : true,\n\t\t/**\n\t\t * a boolean indicating if nodes from this tree should only be copied with dnd (as opposed to moved), default is `false`\n\t\t * @name $.jstree.defaults.dnd.always_copy\n\t\t * @plugin dnd\n\t\t */\n\t\talways_copy : false,\n\t\t/**\n\t\t * when dropping a node \"inside\", this setting indicates the position the node should go to - it can be an integer or a string: \"first\" (same as 0) or \"last\", default is `0`\n\t\t * @name $.jstree.defaults.dnd.inside_pos\n\t\t * @plugin dnd\n\t\t */\n\t\tinside_pos : 0,\n\t\t/**\n\t\t * when starting the drag on a node that is selected this setting controls if all selected nodes are dragged or only the single node, default is `true`, which means all selected nodes are dragged when the drag is started on a selected node\n\t\t * @name $.jstree.defaults.dnd.drag_selection\n\t\t * @plugin dnd\n\t\t */\n\t\tdrag_selection : true,\n\t\t/**\n\t\t * controls whether dnd works on touch devices. If left as boolean true dnd will work the same as in desktop browsers, which in some cases may impair scrolling. If set to boolean false dnd will not work on touch devices. There is a special third option - string \"selected\" which means only selected nodes can be dragged on touch devices.\n\t\t * @name $.jstree.defaults.dnd.touch\n\t\t * @plugin dnd\n\t\t */\n\t\ttouch : true,\n\t\t/**\n\t\t * controls whether items can be dropped anywhere on the node, not just on the anchor, by default only the node anchor is a valid drop target. Works best with the wholerow plugin. If enabled on mobile depending on the interface it might be hard for the user to cancel the drop, since the whole tree container will be a valid drop target.\n\t\t * @name $.jstree.defaults.dnd.large_drop_target\n\t\t * @plugin dnd\n\t\t */\n\t\tlarge_drop_target : false,\n\t\t/**\n\t\t * controls whether a drag can be initiated from any part of the node and not just the text/icon part, works best with the wholerow plugin. Keep in mind it can cause problems with tree scrolling on mobile depending on the interface - in that case set the touch option to \"selected\".\n\t\t * @name $.jstree.defaults.dnd.large_drag_target\n\t\t * @plugin dnd\n\t\t */\n\t\tlarge_drag_target : false,\n\t\t/**\n\t\t * controls whether use HTML5 dnd api instead of classical. That will allow better integration of dnd events with other HTML5 controls.\n\t\t * @reference http://caniuse.com/#feat=dragndrop\n\t\t * @name $.jstree.defaults.dnd.use_html5\n\t\t * @plugin dnd\n\t\t */\n\t\tuse_html5: false\n\t};\n\tvar drg, elm;\n\t// TODO: now check works by checking for each node individually, how about max_children, unique, etc?\n\t$.jstree.plugins.dnd = function (options, parent) {\n\t\tthis.init = function (el, options) {\n\t\t\tparent.init.call(this, el, options);\n\t\t\tthis.settings.dnd.use_html5 = this.settings.dnd.use_html5 && ('draggable' in document.createElement('span'));\n\t\t};\n\t\tthis.bind = function () {\n\t\t\tparent.bind.call(this);\n\n\t\t\tthis.element\n\t\t\t\t.on(this.settings.dnd.use_html5 ? 'dragstart.jstree' : 'mousedown.jstree touchstart.jstree', this.settings.dnd.large_drag_target ? '.jstree-node' : '.jstree-anchor', $.proxy(function (e) {\n\t\t\t\t\t\tif(this.settings.dnd.large_drag_target && $(e.target).closest('.jstree-node')[0] !== e.currentTarget) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(e.type === \"touchstart\" && (!this.settings.dnd.touch || (this.settings.dnd.touch === 'selected' && !$(e.currentTarget).closest('.jstree-node').children('.jstree-anchor').hasClass('jstree-clicked')))) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar obj = this.get_node(e.target),\n\t\t\t\t\t\t\tmlt = this.is_selected(obj) && this.settings.dnd.drag_selection ? this.get_top_selected().length : 1,\n\t\t\t\t\t\t\ttxt = (mlt > 1 ? mlt + ' ' + this.get_string('nodes') : this.get_text(e.currentTarget));\n\t\t\t\t\t\tif(this.settings.core.force_text) {\n\t\t\t\t\t\t\ttxt = $.vakata.html.escape(txt);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(obj && obj.id && obj.id !== $.jstree.root && (e.which === 1 || e.type === \"touchstart\" || e.type === \"dragstart\") &&\n\t\t\t\t\t\t\t(this.settings.dnd.is_draggable === true || ($.isFunction(this.settings.dnd.is_draggable) && this.settings.dnd.is_draggable.call(this, (mlt > 1 ? this.get_top_selected(true) : [obj]), e)))\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tdrg = { 'jstree' : true, 'origin' : this, 'obj' : this.get_node(obj,true), 'nodes' : mlt > 1 ? this.get_top_selected() : [obj.id] };\n\t\t\t\t\t\t\telm = e.currentTarget;\n\t\t\t\t\t\t\tif (this.settings.dnd.use_html5) {\n\t\t\t\t\t\t\t\t$.vakata.dnd._trigger('start', e, { 'helper': $(), 'element': elm, 'data': drg });\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.element.trigger('mousedown.jstree');\n\t\t\t\t\t\t\t\treturn $.vakata.dnd.start(e, drg, '<div id=\"jstree-dnd\" class=\"jstree-' + this.get_theme() + ' jstree-' + this.get_theme() + '-' + this.get_theme_variant() + ' ' + ( this.settings.core.themes.responsive ? ' jstree-dnd-responsive' : '' ) + '\"><i class=\"jstree-icon jstree-er\"></i>' + txt + '<ins class=\"jstree-copy\" style=\"display:none;\">+</ins></div>');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this));\n\t\t\tif (this.settings.dnd.use_html5) {\n\t\t\t\tthis.element\n\t\t\t\t\t.on('dragover.jstree', function (e) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t$.vakata.dnd._trigger('move', e, { 'helper': $(), 'element': elm, 'data': drg });\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t})\n\t\t\t\t\t//.on('dragenter.jstree', this.settings.dnd.large_drop_target ? '.jstree-node' : '.jstree-anchor', $.proxy(function (e) {\n\t\t\t\t\t//\t\te.preventDefault();\n\t\t\t\t\t//\t\t$.vakata.dnd._trigger('move', e, { 'helper': $(), 'element': elm, 'data': drg });\n\t\t\t\t\t//\t\treturn false;\n\t\t\t\t\t//\t}, this))\n\t\t\t\t\t.on('drop.jstree', $.proxy(function (e) {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\t$.vakata.dnd._trigger('stop', e, { 'helper': $(), 'element': elm, 'data': drg });\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}, this));\n\t\t\t}\n\t\t};\n\t\tthis.redraw_node = function(obj, deep, callback, force_render) {\n\t\t\tobj = parent.redraw_node.apply(this, arguments);\n\t\t\tif (obj && this.settings.dnd.use_html5) {\n\t\t\t\tif (this.settings.dnd.large_drag_target) {\n\t\t\t\t\tobj.setAttribute('draggable', true);\n\t\t\t\t} else {\n\t\t\t\t\tvar i, j, tmp = null;\n\t\t\t\t\tfor(i = 0, j = obj.childNodes.length; i < j; i++) {\n\t\t\t\t\t\tif(obj.childNodes[i] && obj.childNodes[i].className && obj.childNodes[i].className.indexOf(\"jstree-anchor\") !== -1) {\n\t\t\t\t\t\t\ttmp = obj.childNodes[i];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(tmp) {\n\t\t\t\t\t\ttmp.setAttribute('draggable', true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn obj;\n\t\t};\n\t};\n\n\t$(function() {\n\t\t// bind only once for all instances\n\t\tvar lastmv = false,\n\t\t\tlaster = false,\n\t\t\tlastev = false,\n\t\t\topento = false,\n\t\t\tmarker = $('<div id=\"jstree-marker\">&#160;</div>').hide(); //.appendTo('body');\n\n\t\t$(document)\n\t\t\t.on('dnd_start.vakata.jstree', function (e, data) {\n\t\t\t\tlastmv = false;\n\t\t\t\tlastev = false;\n\t\t\t\tif(!data || !data.data || !data.data.jstree) { return; }\n\t\t\t\tmarker.appendTo(document.body); //.show();\n\t\t\t})\n\t\t\t.on('dnd_move.vakata.jstree', function (e, data) {\n\t\t\t\tvar isDifferentNode = data.event.target !== lastev.target;\n\t\t\t\tif(opento) {\n\t\t\t\t\tif (!data.event || data.event.type !== 'dragover' || isDifferentNode) {\n\t\t\t\t\t\tclearTimeout(opento);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!data || !data.data || !data.data.jstree) { return; }\n\n\t\t\t\t// if we are hovering the marker image do nothing (can happen on \"inside\" drags)\n\t\t\t\tif(data.event.target.id && data.event.target.id === 'jstree-marker') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlastev = data.event;\n\n\t\t\t\tvar ins = $.jstree.reference(data.event.target),\n\t\t\t\t\tref = false,\n\t\t\t\t\toff = false,\n\t\t\t\t\trel = false,\n\t\t\t\t\ttmp, l, t, h, p, i, o, ok, t1, t2, op, ps, pr, ip, tm, is_copy, pn;\n\t\t\t\t// if we are over an instance\n\t\t\t\tif(ins && ins._data && ins._data.dnd) {\n\t\t\t\t\tmarker.attr('class', 'jstree-' + ins.get_theme() + ( ins.settings.core.themes.responsive ? ' jstree-dnd-responsive' : '' ));\n\t\t\t\t\tis_copy = data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey)));\n\t\t\t\t\tdata.helper\n\t\t\t\t\t\t.children().attr('class', 'jstree-' + ins.get_theme() + ' jstree-' + ins.get_theme() + '-' + ins.get_theme_variant() + ' ' + ( ins.settings.core.themes.responsive ? ' jstree-dnd-responsive' : '' ))\n\t\t\t\t\t\t.find('.jstree-copy').first()[ is_copy ? 'show' : 'hide' ]();\n\n\t\t\t\t\t// if are hovering the container itself add a new root node\n\t\t\t\t\t//console.log(data.event);\n\t\t\t\t\tif( (data.event.target === ins.element[0] || data.event.target === ins.get_container_ul()[0]) && ins.get_container_ul().children().length === 0) {\n\t\t\t\t\t\tok = true;\n\t\t\t\t\t\tfor(t1 = 0, t2 = data.data.nodes.length; t1 < t2; t1++) {\n\t\t\t\t\t\t\tok = ok && ins.check( (data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey)) ) ? \"copy_node\" : \"move_node\"), (data.data.origin && data.data.origin !== ins ? data.data.origin.get_node(data.data.nodes[t1]) : data.data.nodes[t1]), $.jstree.root, 'last', { 'dnd' : true, 'ref' : ins.get_node($.jstree.root), 'pos' : 'i', 'origin' : data.data.origin, 'is_multi' : (data.data.origin && data.data.origin !== ins), 'is_foreign' : (!data.data.origin) });\n\t\t\t\t\t\t\tif(!ok) { break; }\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(ok) {\n\t\t\t\t\t\t\tlastmv = { 'ins' : ins, 'par' : $.jstree.root, 'pos' : 'last' };\n\t\t\t\t\t\t\tmarker.hide();\n\t\t\t\t\t\t\tdata.helper.find('.jstree-icon').first().removeClass('jstree-er').addClass('jstree-ok');\n\t\t\t\t\t\t\tif (data.event.originalEvent && data.event.originalEvent.dataTransfer) {\n\t\t\t\t\t\t\t\tdata.event.originalEvent.dataTransfer.dropEffect = is_copy ? 'copy' : 'move';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// if we are hovering a tree node\n\t\t\t\t\t\tref = ins.settings.dnd.large_drop_target ? $(data.event.target).closest('.jstree-node').children('.jstree-anchor') : $(data.event.target).closest('.jstree-anchor');\n\t\t\t\t\t\tif(ref && ref.length && ref.parent().is('.jstree-closed, .jstree-open, .jstree-leaf')) {\n\t\t\t\t\t\t\toff = ref.offset();\n\t\t\t\t\t\t\trel = (data.event.pageY !== undefined ? data.event.pageY : data.event.originalEvent.pageY) - off.top;\n\t\t\t\t\t\t\th = ref.outerHeight();\n\t\t\t\t\t\t\tif(rel < h / 3) {\n\t\t\t\t\t\t\t\to = ['b', 'i', 'a'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if(rel > h - h / 3) {\n\t\t\t\t\t\t\t\to = ['a', 'i', 'b'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\to = rel > h / 2 ? ['i', 'a', 'b'] : ['i', 'b', 'a'];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t$.each(o, function (j, v) {\n\t\t\t\t\t\t\t\tswitch(v) {\n\t\t\t\t\t\t\t\t\tcase 'b':\n\t\t\t\t\t\t\t\t\t\tl = off.left - 6;\n\t\t\t\t\t\t\t\t\t\tt = off.top;\n\t\t\t\t\t\t\t\t\t\tp = ins.get_parent(ref);\n\t\t\t\t\t\t\t\t\t\ti = ref.parent().index();\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'i':\n\t\t\t\t\t\t\t\t\t\tip = ins.settings.dnd.inside_pos;\n\t\t\t\t\t\t\t\t\t\ttm = ins.get_node(ref.parent());\n\t\t\t\t\t\t\t\t\t\tl = off.left - 2;\n\t\t\t\t\t\t\t\t\t\tt = off.top + h / 2 + 1;\n\t\t\t\t\t\t\t\t\t\tp = tm.id;\n\t\t\t\t\t\t\t\t\t\ti = ip === 'first' ? 0 : (ip === 'last' ? tm.children.length : Math.min(ip, tm.children.length));\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 'a':\n\t\t\t\t\t\t\t\t\t\tl = off.left - 6;\n\t\t\t\t\t\t\t\t\t\tt = off.top + h;\n\t\t\t\t\t\t\t\t\t\tp = ins.get_parent(ref);\n\t\t\t\t\t\t\t\t\t\ti = ref.parent().index() + 1;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tok = true;\n\t\t\t\t\t\t\t\tfor(t1 = 0, t2 = data.data.nodes.length; t1 < t2; t1++) {\n\t\t\t\t\t\t\t\t\top = data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey))) ? \"copy_node\" : \"move_node\";\n\t\t\t\t\t\t\t\t\tps = i;\n\t\t\t\t\t\t\t\t\tif(op === \"move_node\" && v === 'a' && (data.data.origin && data.data.origin === ins) && p === ins.get_parent(data.data.nodes[t1])) {\n\t\t\t\t\t\t\t\t\t\tpr = ins.get_node(p);\n\t\t\t\t\t\t\t\t\t\tif(ps > $.inArray(data.data.nodes[t1], pr.children)) {\n\t\t\t\t\t\t\t\t\t\t\tps -= 1;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tok = ok && ( (ins && ins.settings && ins.settings.dnd && ins.settings.dnd.check_while_dragging === false) || ins.check(op, (data.data.origin && data.data.origin !== ins ? data.data.origin.get_node(data.data.nodes[t1]) : data.data.nodes[t1]), p, ps, { 'dnd' : true, 'ref' : ins.get_node(ref.parent()), 'pos' : v, 'origin' : data.data.origin, 'is_multi' : (data.data.origin && data.data.origin !== ins), 'is_foreign' : (!data.data.origin) }) );\n\t\t\t\t\t\t\t\t\tif(!ok) {\n\t\t\t\t\t\t\t\t\t\tif(ins && ins.last_error) { laster = ins.last_error(); }\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(v === 'i' && ref.parent().is('.jstree-closed') && ins.settings.dnd.open_timeout) {\n\t\t\t\t\t\t\t\t\tif (!data.event || data.event.type !== 'dragover' || isDifferentNode) {\n\t\t\t\t\t\t\t\t\t\tif (opento) { clearTimeout(opento); }\n\t\t\t\t\t\t\t\t\t\topento = setTimeout((function (x, z) { return function () { x.open_node(z); }; }(ins, ref)), ins.settings.dnd.open_timeout);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tif(ok) {\n\t\t\t\t\t\t\t\t\tpn = ins.get_node(p, true);\n\t\t\t\t\t\t\t\t\tif (!pn.hasClass('.jstree-dnd-parent')) {\n\t\t\t\t\t\t\t\t\t\t$('.jstree-dnd-parent').removeClass('jstree-dnd-parent');\n\t\t\t\t\t\t\t\t\t\tpn.addClass('jstree-dnd-parent');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tlastmv = { 'ins' : ins, 'par' : p, 'pos' : v === 'i' && ip === 'last' && i === 0 && !ins.is_loaded(tm) ? 'last' : i };\n\t\t\t\t\t\t\t\t\tmarker.css({ 'left' : l + 'px', 'top' : t + 'px' }).show();\n\t\t\t\t\t\t\t\t\tdata.helper.find('.jstree-icon').first().removeClass('jstree-er').addClass('jstree-ok');\n\t\t\t\t\t\t\t\t\tif (data.event.originalEvent && data.event.originalEvent.dataTransfer) {\n\t\t\t\t\t\t\t\t\t\tdata.event.originalEvent.dataTransfer.dropEffect = is_copy ? 'copy' : 'move';\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tlaster = {};\n\t\t\t\t\t\t\t\t\to = true;\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tif(o === true) { return; }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$('.jstree-dnd-parent').removeClass('jstree-dnd-parent');\n\t\t\t\tlastmv = false;\n\t\t\t\tdata.helper.find('.jstree-icon').removeClass('jstree-ok').addClass('jstree-er');\n\t\t\t\tif (data.event.originalEvent && data.event.originalEvent.dataTransfer) {\n\t\t\t\t\tdata.event.originalEvent.dataTransfer.dropEffect = 'none';\n\t\t\t\t}\n\t\t\t\tmarker.hide();\n\t\t\t})\n\t\t\t.on('dnd_scroll.vakata.jstree', function (e, data) {\n\t\t\t\tif(!data || !data.data || !data.data.jstree) { return; }\n\t\t\t\tmarker.hide();\n\t\t\t\tlastmv = false;\n\t\t\t\tlastev = false;\n\t\t\t\tdata.helper.find('.jstree-icon').first().removeClass('jstree-ok').addClass('jstree-er');\n\t\t\t})\n\t\t\t.on('dnd_stop.vakata.jstree', function (e, data) {\n\t\t\t\t$('.jstree-dnd-parent').removeClass('jstree-dnd-parent');\n\t\t\t\tif(opento) { clearTimeout(opento); }\n\t\t\t\tif(!data || !data.data || !data.data.jstree) { return; }\n\t\t\t\tmarker.hide().detach();\n\t\t\t\tvar i, j, nodes = [];\n\t\t\t\tif(lastmv) {\n\t\t\t\t\tfor(i = 0, j = data.data.nodes.length; i < j; i++) {\n\t\t\t\t\t\tnodes[i] = data.data.origin ? data.data.origin.get_node(data.data.nodes[i]) : data.data.nodes[i];\n\t\t\t\t\t}\n\t\t\t\t\tlastmv.ins[ data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (data.event.metaKey || data.event.ctrlKey))) ? 'copy_node' : 'move_node' ](nodes, lastmv.par, lastmv.pos, false, false, false, data.data.origin);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\ti = $(data.event.target).closest('.jstree');\n\t\t\t\t\tif(i.length && laster && laster.error && laster.error === 'check') {\n\t\t\t\t\t\ti = i.jstree(true);\n\t\t\t\t\t\tif(i) {\n\t\t\t\t\t\t\ti.settings.core.error.call(this, laster);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tlastev = false;\n\t\t\t\tlastmv = false;\n\t\t\t})\n\t\t\t.on('keyup.jstree keydown.jstree', function (e, data) {\n\t\t\t\tdata = $.vakata.dnd._get();\n\t\t\t\tif(data && data.data && data.data.jstree) {\n\t\t\t\t\tif (e.type === \"keyup\" && e.which === 27) {\n\t\t\t\t\t\tif (opento) { clearTimeout(opento); }\n\t\t\t\t\t\tlastmv = false;\n\t\t\t\t\t\tlaster = false;\n\t\t\t\t\t\tlastev = false;\n\t\t\t\t\t\topento = false;\n\t\t\t\t\t\tmarker.hide().detach();\n\t\t\t\t\t\t$.vakata.dnd._clean();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdata.helper.find('.jstree-copy').first()[ data.data.origin && (data.data.origin.settings.dnd.always_copy || (data.data.origin.settings.dnd.copy && (e.metaKey || e.ctrlKey))) ? 'show' : 'hide' ]();\n\t\t\t\t\t\tif(lastev) {\n\t\t\t\t\t\t\tlastev.metaKey = e.metaKey;\n\t\t\t\t\t\t\tlastev.ctrlKey = e.ctrlKey;\n\t\t\t\t\t\t\t$.vakata.dnd._trigger('move', lastev);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t});\n\n\t// helpers\n\t(function ($) {\n\t\t$.vakata.html = {\n\t\t\tdiv : $('<div />'),\n\t\t\tescape : function (str) {\n\t\t\t\treturn $.vakata.html.div.text(str).html();\n\t\t\t},\n\t\t\tstrip : function (str) {\n\t\t\t\treturn $.vakata.html.div.empty().append($.parseHTML(str)).text();\n\t\t\t}\n\t\t};\n\t\t// private variable\n\t\tvar vakata_dnd = {\n\t\t\telement\t: false,\n\t\t\ttarget\t: false,\n\t\t\tis_down\t: false,\n\t\t\tis_drag\t: false,\n\t\t\thelper\t: false,\n\t\t\thelper_w: 0,\n\t\t\tdata\t: false,\n\t\t\tinit_x\t: 0,\n\t\t\tinit_y\t: 0,\n\t\t\tscroll_l: 0,\n\t\t\tscroll_t: 0,\n\t\t\tscroll_e: false,\n\t\t\tscroll_i: false,\n\t\t\tis_touch: false\n\t\t};\n\t\t$.vakata.dnd = {\n\t\t\tsettings : {\n\t\t\t\tscroll_speed\t\t: 10,\n\t\t\t\tscroll_proximity\t: 20,\n\t\t\t\thelper_left\t\t\t: 5,\n\t\t\t\thelper_top\t\t\t: 10,\n\t\t\t\tthreshold\t\t\t: 5,\n\t\t\t\tthreshold_touch\t\t: 10\n\t\t\t},\n\t\t\t_trigger : function (event_name, e, data) {\n\t\t\t\tif (data === undefined) {\n\t\t\t\t\tdata = $.vakata.dnd._get();\n\t\t\t\t}\n\t\t\t\tdata.event = e;\n\t\t\t\t$(document).trigger(\"dnd_\" + event_name + \".vakata\", data);\n\t\t\t},\n\t\t\t_get : function () {\n\t\t\t\treturn {\n\t\t\t\t\t\"data\"\t\t: vakata_dnd.data,\n\t\t\t\t\t\"element\"\t: vakata_dnd.element,\n\t\t\t\t\t\"helper\"\t: vakata_dnd.helper\n\t\t\t\t};\n\t\t\t},\n\t\t\t_clean : function () {\n\t\t\t\tif(vakata_dnd.helper) { vakata_dnd.helper.remove(); }\n\t\t\t\tif(vakata_dnd.scroll_i) { clearInterval(vakata_dnd.scroll_i); vakata_dnd.scroll_i = false; }\n\t\t\t\tvakata_dnd = {\n\t\t\t\t\telement\t: false,\n\t\t\t\t\ttarget\t: false,\n\t\t\t\t\tis_down\t: false,\n\t\t\t\t\tis_drag\t: false,\n\t\t\t\t\thelper\t: false,\n\t\t\t\t\thelper_w: 0,\n\t\t\t\t\tdata\t: false,\n\t\t\t\t\tinit_x\t: 0,\n\t\t\t\t\tinit_y\t: 0,\n\t\t\t\t\tscroll_l: 0,\n\t\t\t\t\tscroll_t: 0,\n\t\t\t\t\tscroll_e: false,\n\t\t\t\t\tscroll_i: false,\n\t\t\t\t\tis_touch: false\n\t\t\t\t};\n\t\t\t\t$(document).off(\"mousemove.vakata.jstree touchmove.vakata.jstree\", $.vakata.dnd.drag);\n\t\t\t\t$(document).off(\"mouseup.vakata.jstree touchend.vakata.jstree\", $.vakata.dnd.stop);\n\t\t\t},\n\t\t\t_scroll : function (init_only) {\n\t\t\t\tif(!vakata_dnd.scroll_e || (!vakata_dnd.scroll_l && !vakata_dnd.scroll_t)) {\n\t\t\t\t\tif(vakata_dnd.scroll_i) { clearInterval(vakata_dnd.scroll_i); vakata_dnd.scroll_i = false; }\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif(!vakata_dnd.scroll_i) {\n\t\t\t\t\tvakata_dnd.scroll_i = setInterval($.vakata.dnd._scroll, 100);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\tif(init_only === true) { return false; }\n\n\t\t\t\tvar i = vakata_dnd.scroll_e.scrollTop(),\n\t\t\t\t\tj = vakata_dnd.scroll_e.scrollLeft();\n\t\t\t\tvakata_dnd.scroll_e.scrollTop(i + vakata_dnd.scroll_t * $.vakata.dnd.settings.scroll_speed);\n\t\t\t\tvakata_dnd.scroll_e.scrollLeft(j + vakata_dnd.scroll_l * $.vakata.dnd.settings.scroll_speed);\n\t\t\t\tif(i !== vakata_dnd.scroll_e.scrollTop() || j !== vakata_dnd.scroll_e.scrollLeft()) {\n\t\t\t\t\t/**\n\t\t\t\t\t * triggered on the document when a drag causes an element to scroll\n\t\t\t\t\t * @event\n\t\t\t\t\t * @plugin dnd\n\t\t\t\t\t * @name dnd_scroll.vakata\n\t\t\t\t\t * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start\n\t\t\t\t\t * @param {DOM} element the DOM element being dragged\n\t\t\t\t\t * @param {jQuery} helper the helper shown next to the mouse\n\t\t\t\t\t * @param {jQuery} event the element that is scrolling\n\t\t\t\t\t */\n\t\t\t\t\t$.vakata.dnd._trigger(\"scroll\", vakata_dnd.scroll_e);\n\t\t\t\t}\n\t\t\t},\n\t\t\tstart : function (e, data, html) {\n\t\t\t\tif(e.type === \"touchstart\" && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0]) {\n\t\t\t\t\te.pageX = e.originalEvent.changedTouches[0].pageX;\n\t\t\t\t\te.pageY = e.originalEvent.changedTouches[0].pageY;\n\t\t\t\t\te.target = document.elementFromPoint(e.originalEvent.changedTouches[0].pageX - window.pageXOffset, e.originalEvent.changedTouches[0].pageY - window.pageYOffset);\n\t\t\t\t}\n\t\t\t\tif(vakata_dnd.is_drag) { $.vakata.dnd.stop({}); }\n\t\t\t\ttry {\n\t\t\t\t\te.currentTarget.unselectable = \"on\";\n\t\t\t\t\te.currentTarget.onselectstart = function() { return false; };\n\t\t\t\t\tif(e.currentTarget.style) {\n\t\t\t\t\t\te.currentTarget.style.touchAction = \"none\";\n\t\t\t\t\t\te.currentTarget.style.msTouchAction = \"none\";\n\t\t\t\t\t\te.currentTarget.style.MozUserSelect = \"none\";\n\t\t\t\t\t}\n\t\t\t\t} catch(ignore) { }\n\t\t\t\tvakata_dnd.init_x\t= e.pageX;\n\t\t\t\tvakata_dnd.init_y\t= e.pageY;\n\t\t\t\tvakata_dnd.data\t\t= data;\n\t\t\t\tvakata_dnd.is_down\t= true;\n\t\t\t\tvakata_dnd.element\t= e.currentTarget;\n\t\t\t\tvakata_dnd.target\t= e.target;\n\t\t\t\tvakata_dnd.is_touch\t= e.type === \"touchstart\";\n\t\t\t\tif(html !== false) {\n\t\t\t\t\tvakata_dnd.helper = $(\"<div id='vakata-dnd'></div>\").html(html).css({\n\t\t\t\t\t\t\"display\"\t\t: \"block\",\n\t\t\t\t\t\t\"margin\"\t\t: \"0\",\n\t\t\t\t\t\t\"padding\"\t\t: \"0\",\n\t\t\t\t\t\t\"position\"\t\t: \"absolute\",\n\t\t\t\t\t\t\"top\"\t\t\t: \"-2000px\",\n\t\t\t\t\t\t\"lineHeight\"\t: \"16px\",\n\t\t\t\t\t\t\"zIndex\"\t\t: \"10000\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t$(document).on(\"mousemove.vakata.jstree touchmove.vakata.jstree\", $.vakata.dnd.drag);\n\t\t\t\t$(document).on(\"mouseup.vakata.jstree touchend.vakata.jstree\", $.vakata.dnd.stop);\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tdrag : function (e) {\n\t\t\t\tif(e.type === \"touchmove\" && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0]) {\n\t\t\t\t\te.pageX = e.originalEvent.changedTouches[0].pageX;\n\t\t\t\t\te.pageY = e.originalEvent.changedTouches[0].pageY;\n\t\t\t\t\te.target = document.elementFromPoint(e.originalEvent.changedTouches[0].pageX - window.pageXOffset, e.originalEvent.changedTouches[0].pageY - window.pageYOffset);\n\t\t\t\t}\n\t\t\t\tif(!vakata_dnd.is_down) { return; }\n\t\t\t\tif(!vakata_dnd.is_drag) {\n\t\t\t\t\tif(\n\t\t\t\t\t\tMath.abs(e.pageX - vakata_dnd.init_x) > (vakata_dnd.is_touch ? $.vakata.dnd.settings.threshold_touch : $.vakata.dnd.settings.threshold) ||\n\t\t\t\t\t\tMath.abs(e.pageY - vakata_dnd.init_y) > (vakata_dnd.is_touch ? $.vakata.dnd.settings.threshold_touch : $.vakata.dnd.settings.threshold)\n\t\t\t\t\t) {\n\t\t\t\t\t\tif(vakata_dnd.helper) {\n\t\t\t\t\t\t\tvakata_dnd.helper.appendTo(document.body);\n\t\t\t\t\t\t\tvakata_dnd.helper_w = vakata_dnd.helper.outerWidth();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvakata_dnd.is_drag = true;\n\t\t\t\t\t\t$(vakata_dnd.target).one('click.vakata', false);\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * triggered on the document when a drag starts\n\t\t\t\t\t\t * @event\n\t\t\t\t\t\t * @plugin dnd\n\t\t\t\t\t\t * @name dnd_start.vakata\n\t\t\t\t\t\t * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start\n\t\t\t\t\t\t * @param {DOM} element the DOM element being dragged\n\t\t\t\t\t\t * @param {jQuery} helper the helper shown next to the mouse\n\t\t\t\t\t\t * @param {Object} event the event that caused the start (probably mousemove)\n\t\t\t\t\t\t */\n\t\t\t\t\t\t$.vakata.dnd._trigger(\"start\", e);\n\t\t\t\t\t}\n\t\t\t\t\telse { return; }\n\t\t\t\t}\n\n\t\t\t\tvar d  = false, w  = false,\n\t\t\t\t\tdh = false, wh = false,\n\t\t\t\t\tdw = false, ww = false,\n\t\t\t\t\tdt = false, dl = false,\n\t\t\t\t\tht = false, hl = false;\n\n\t\t\t\tvakata_dnd.scroll_t = 0;\n\t\t\t\tvakata_dnd.scroll_l = 0;\n\t\t\t\tvakata_dnd.scroll_e = false;\n\t\t\t\t$($(e.target).parentsUntil(\"body\").addBack().get().reverse())\n\t\t\t\t\t.filter(function () {\n\t\t\t\t\t\treturn\t(/^auto|scroll$/).test($(this).css(\"overflow\")) &&\n\t\t\t\t\t\t\t\t(this.scrollHeight > this.offsetHeight || this.scrollWidth > this.offsetWidth);\n\t\t\t\t\t})\n\t\t\t\t\t.each(function () {\n\t\t\t\t\t\tvar t = $(this), o = t.offset();\n\t\t\t\t\t\tif(this.scrollHeight > this.offsetHeight) {\n\t\t\t\t\t\t\tif(o.top + t.height() - e.pageY < $.vakata.dnd.settings.scroll_proximity)\t{ vakata_dnd.scroll_t = 1; }\n\t\t\t\t\t\t\tif(e.pageY - o.top < $.vakata.dnd.settings.scroll_proximity)\t\t\t\t{ vakata_dnd.scroll_t = -1; }\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(this.scrollWidth > this.offsetWidth) {\n\t\t\t\t\t\t\tif(o.left + t.width() - e.pageX < $.vakata.dnd.settings.scroll_proximity)\t{ vakata_dnd.scroll_l = 1; }\n\t\t\t\t\t\t\tif(e.pageX - o.left < $.vakata.dnd.settings.scroll_proximity)\t\t\t\t{ vakata_dnd.scroll_l = -1; }\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(vakata_dnd.scroll_t || vakata_dnd.scroll_l) {\n\t\t\t\t\t\t\tvakata_dnd.scroll_e = $(this);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\tif(!vakata_dnd.scroll_e) {\n\t\t\t\t\td  = $(document); w = $(window);\n\t\t\t\t\tdh = d.height(); wh = w.height();\n\t\t\t\t\tdw = d.width(); ww = w.width();\n\t\t\t\t\tdt = d.scrollTop(); dl = d.scrollLeft();\n\t\t\t\t\tif(dh > wh && e.pageY - dt < $.vakata.dnd.settings.scroll_proximity)\t\t{ vakata_dnd.scroll_t = -1;  }\n\t\t\t\t\tif(dh > wh && wh - (e.pageY - dt) < $.vakata.dnd.settings.scroll_proximity)\t{ vakata_dnd.scroll_t = 1; }\n\t\t\t\t\tif(dw > ww && e.pageX - dl < $.vakata.dnd.settings.scroll_proximity)\t\t{ vakata_dnd.scroll_l = -1; }\n\t\t\t\t\tif(dw > ww && ww - (e.pageX - dl) < $.vakata.dnd.settings.scroll_proximity)\t{ vakata_dnd.scroll_l = 1; }\n\t\t\t\t\tif(vakata_dnd.scroll_t || vakata_dnd.scroll_l) {\n\t\t\t\t\t\tvakata_dnd.scroll_e = d;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(vakata_dnd.scroll_e) { $.vakata.dnd._scroll(true); }\n\n\t\t\t\tif(vakata_dnd.helper) {\n\t\t\t\t\tht = parseInt(e.pageY + $.vakata.dnd.settings.helper_top, 10);\n\t\t\t\t\thl = parseInt(e.pageX + $.vakata.dnd.settings.helper_left, 10);\n\t\t\t\t\tif(dh && ht + 25 > dh) { ht = dh - 50; }\n\t\t\t\t\tif(dw && hl + vakata_dnd.helper_w > dw) { hl = dw - (vakata_dnd.helper_w + 2); }\n\t\t\t\t\tvakata_dnd.helper.css({\n\t\t\t\t\t\tleft\t: hl + \"px\",\n\t\t\t\t\t\ttop\t\t: ht + \"px\"\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\t/**\n\t\t\t\t * triggered on the document when a drag is in progress\n\t\t\t\t * @event\n\t\t\t\t * @plugin dnd\n\t\t\t\t * @name dnd_move.vakata\n\t\t\t\t * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start\n\t\t\t\t * @param {DOM} element the DOM element being dragged\n\t\t\t\t * @param {jQuery} helper the helper shown next to the mouse\n\t\t\t\t * @param {Object} event the event that caused this to trigger (most likely mousemove)\n\t\t\t\t */\n\t\t\t\t$.vakata.dnd._trigger(\"move\", e);\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tstop : function (e) {\n\t\t\t\tif(e.type === \"touchend\" && e.originalEvent && e.originalEvent.changedTouches && e.originalEvent.changedTouches[0]) {\n\t\t\t\t\te.pageX = e.originalEvent.changedTouches[0].pageX;\n\t\t\t\t\te.pageY = e.originalEvent.changedTouches[0].pageY;\n\t\t\t\t\te.target = document.elementFromPoint(e.originalEvent.changedTouches[0].pageX - window.pageXOffset, e.originalEvent.changedTouches[0].pageY - window.pageYOffset);\n\t\t\t\t}\n\t\t\t\tif(vakata_dnd.is_drag) {\n\t\t\t\t\t/**\n\t\t\t\t\t * triggered on the document when a drag stops (the dragged element is dropped)\n\t\t\t\t\t * @event\n\t\t\t\t\t * @plugin dnd\n\t\t\t\t\t * @name dnd_stop.vakata\n\t\t\t\t\t * @param {Mixed} data any data supplied with the call to $.vakata.dnd.start\n\t\t\t\t\t * @param {DOM} element the DOM element being dragged\n\t\t\t\t\t * @param {jQuery} helper the helper shown next to the mouse\n\t\t\t\t\t * @param {Object} event the event that caused the stop\n\t\t\t\t\t */\n\t\t\t\t\tif (e.target !== vakata_dnd.target) {\n\t\t\t\t\t\t$(vakata_dnd.target).off('click.vakata');\n\t\t\t\t\t}\n\t\t\t\t\t$.vakata.dnd._trigger(\"stop\", e);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif(e.type === \"touchend\" && e.target === vakata_dnd.target) {\n\t\t\t\t\t\tvar to = setTimeout(function () { $(e.target).click(); }, 100);\n\t\t\t\t\t\t$(e.target).one('click', function() { if(to) { clearTimeout(to); } });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t$.vakata.dnd._clean();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t};\n\t}($));\n\n\t// include the dnd plugin by default\n\t// $.jstree.defaults.plugins.push(\"dnd\");\n\n\treturn $;\n\t\n});\n"]}