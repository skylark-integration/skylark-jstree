{"version":3,"sources":["plugin/search.js"],"names":["define","langx","browser","eventer","noder","geom","velm","$","jstree","plugins","search","defaults","ajax","fuzzy","case_sensitive","show_only_matches","show_only_matches_children","close_opened_onclear","search_leaves_only","search_callback","options","parent","this","bind","call","_data","str","dom","res","opn","som","smc","hdn","element","on","proxy","e","data","length","i","j","k","l","m","_model","p","state","hidden","push","concat","parents","children_d","vakata","array_remove_item","array_unique","root","hide_all","show_node","redraw","skip_async","inside","append","trim","toString","clear_search","get_node","id","s","settings","a","f","r","undefined","isFunction","d","_load_nodes","isArray","extend","lastRequest","abort","fail","core","last_error","error","plugin","reason","JSON","stringify","done","caseSensitive","each","ii","v","text","loaded","children","isMatch","open_node","add","querySelectorAll","map","indexOf","substr","replace","idregex","join","addClass","trigger","nodes","close_node","removeClass","redraw_node","obj","deep","callback","force_render","apply","arguments","inArray","tmp","childNodes","className","pattern","txt","toLowerCase","matchmask","pattern_alphabet","match_bitapScore","MATCH_LOCATION","location","MATCH_DISTANCE","distance","MATCH_THRESHOLD","threshold","patternLen","mask","charAt","x","accuracy","proximity","Math","abs","score","binMin","binMid","lastRd","start","finish","rd","charMatch","textLen","scoreThreshold","bestLoc","binMax","locations","min","lastIndexOf","floor","max","Array"],"mappings":"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","file":"../../plugin/search.js","sourcesContent":["define([\n  \"skylark-utils/langx\",\n  \"skylark-utils/browser\",\n  \"skylark-utils/eventer\",\n  \"skylark-utils/noder\",\n  \"skylark-utils/geom\",\n  \"skylark-utils/velm\",\n  \"skylark-utils/query\",\n  \"../tree\"\n],function(langx,browser,eventer,noder,geom,velm,$,jstree){\n\n\t\"use strict\";\n\n\tif($.jstree.plugins.search) { return; }\n\n\t/**\n\t * stores all defaults for the search plugin\n\t * @name $.jstree.defaults.search\n\t * @plugin search\n\t */\n\t$.jstree.defaults.search = {\n\t\t/**\n\t\t * a jQuery-like AJAX config, which jstree uses if a server should be queried for results.\n\t\t *\n\t\t * A `str` (which is the search string) parameter will be added with the request, an optional `inside` parameter will be added if the search is limited to a node id. The expected result is a JSON array with nodes that need to be opened so that matching nodes will be revealed.\n\t\t * Leave this setting as `false` to not query the server. You can also set this to a function, which will be invoked in the instance's scope and receive 3 parameters - the search string, the callback to call with the array of nodes to load, and the optional node ID to limit the search to\n\t\t * @name $.jstree.defaults.search.ajax\n\t\t * @plugin search\n\t\t */\n\t\tajax : false,\n\t\t/**\n\t\t * Indicates if the search should be fuzzy or not (should `chnd3` match `child node 3`). Default is `false`.\n\t\t * @name $.jstree.defaults.search.fuzzy\n\t\t * @plugin search\n\t\t */\n\t\tfuzzy : false,\n\t\t/**\n\t\t * Indicates if the search should be case sensitive. Default is `false`.\n\t\t * @name $.jstree.defaults.search.case_sensitive\n\t\t * @plugin search\n\t\t */\n\t\tcase_sensitive : false,\n\t\t/**\n\t\t * Indicates if the tree should be filtered (by default) to show only matching nodes (keep in mind this can be a heavy on large trees in old browsers).\n\t\t * This setting can be changed at runtime when calling the search method. Default is `false`.\n\t\t * @name $.jstree.defaults.search.show_only_matches\n\t\t * @plugin search\n\t\t */\n\t\tshow_only_matches : false,\n\t\t/**\n\t\t * Indicates if the children of matched element are shown (when show_only_matches is true)\n\t\t * This setting can be changed at runtime when calling the search method. Default is `false`.\n\t\t * @name $.jstree.defaults.search.show_only_matches_children\n\t\t * @plugin search\n\t\t */\n\t\tshow_only_matches_children : false,\n\t\t/**\n\t\t * Indicates if all nodes opened to reveal the search result, should be closed when the search is cleared or a new search is performed. Default is `true`.\n\t\t * @name $.jstree.defaults.search.close_opened_onclear\n\t\t * @plugin search\n\t\t */\n\t\tclose_opened_onclear : true,\n\t\t/**\n\t\t * Indicates if only leaf nodes should be included in search results. Default is `false`.\n\t\t * @name $.jstree.defaults.search.search_leaves_only\n\t\t * @plugin search\n\t\t */\n\t\tsearch_leaves_only : false,\n\t\t/**\n\t\t * If set to a function it wil be called in the instance's scope with two arguments - search string and node (where node will be every node in the structure, so use with caution).\n\t\t * If the function returns a truthy value the node will be considered a match (it might not be displayed if search_only_leaves is set to true and the node is not a leaf). Default is `false`.\n\t\t * @name $.jstree.defaults.search.search_callback\n\t\t * @plugin search\n\t\t */\n\t\tsearch_callback : false\n\t};\n\n\t$.jstree.plugins.search = function (options, parent) {\n\t\tthis.bind = function () {\n\t\t\tparent.bind.call(this);\n\n\t\t\tthis._data.search.str = \"\";\n\t\t\tthis._data.search.dom = $();\n\t\t\tthis._data.search.res = [];\n\t\t\tthis._data.search.opn = [];\n\t\t\tthis._data.search.som = false;\n\t\t\tthis._data.search.smc = false;\n\t\t\tthis._data.search.hdn = [];\n\n\t\t\tthis.element\n\t\t\t\t.on(\"search.jstree\", $.proxy(function (e, data) {\n\t\t\t\t\t\tif(this._data.search.som && data.res.length) {\n\t\t\t\t\t\t\tvar m = this._model.data, i, j, p = [], k, l;\n\t\t\t\t\t\t\tfor(i = 0, j = data.res.length; i < j; i++) {\n\t\t\t\t\t\t\t\tif(m[data.res[i]] && !m[data.res[i]].state.hidden) {\n\t\t\t\t\t\t\t\t\tp.push(data.res[i]);\n\t\t\t\t\t\t\t\t\tp = p.concat(m[data.res[i]].parents);\n\t\t\t\t\t\t\t\t\tif(this._data.search.smc) {\n\t\t\t\t\t\t\t\t\t\tfor (k = 0, l = m[data.res[i]].children_d.length; k < l; k++) {\n\t\t\t\t\t\t\t\t\t\t\tif (m[m[data.res[i]].children_d[k]] && !m[m[data.res[i]].children_d[k]].state.hidden) {\n\t\t\t\t\t\t\t\t\t\t\t\tp.push(m[data.res[i]].children_d[k]);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tp = $.vakata.array_remove_item($.vakata.array_unique(p), $.jstree.root);\n\t\t\t\t\t\t\tthis._data.search.hdn = this.hide_all(true);\n\t\t\t\t\t\t\tthis.show_node(p, true);\n\t\t\t\t\t\t\tthis.redraw(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this))\n\t\t\t\t.on(\"clear_search.jstree\", $.proxy(function (e, data) {\n\t\t\t\t\t\tif(this._data.search.som && data.res.length) {\n\t\t\t\t\t\t\tthis.show_node(this._data.search.hdn, true);\n\t\t\t\t\t\t\tthis.redraw(true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this));\n\t\t};\n\t\t/**\n\t\t * used to search the tree nodes for a given string\n\t\t * @name search(str [, skip_async])\n\t\t * @param {String} str the search string\n\t\t * @param {Boolean} skip_async if set to true server will not be queried even if configured\n\t\t * @param {Boolean} show_only_matches if set to true only matching nodes will be shown (keep in mind this can be very slow on large trees or old browsers)\n\t\t * @param {mixed} inside an optional node to whose children to limit the search\n\t\t * @param {Boolean} append if set to true the results of this search are appended to the previous search\n\t\t * @plugin search\n\t\t * @trigger search.jstree\n\t\t */\n\t\tthis.search = function (str, skip_async, show_only_matches, inside, append, show_only_matches_children) {\n\t\t\tif(str === false || $.trim(str.toString()) === \"\") {\n\t\t\t\treturn this.clear_search();\n\t\t\t}\n\t\t\tinside = this.get_node(inside);\n\t\t\tinside = inside && inside.id ? inside.id : null;\n\t\t\tstr = str.toString();\n\t\t\tvar s = this.settings.search,\n\t\t\t\ta = s.ajax ? s.ajax : false,\n\t\t\t\tm = this._model.data,\n\t\t\t\tf = null,\n\t\t\t\tr = [],\n\t\t\t\tp = [], i, j;\n\t\t\tif(this._data.search.res.length && !append) {\n\t\t\t\tthis.clear_search();\n\t\t\t}\n\t\t\tif(show_only_matches === undefined) {\n\t\t\t\tshow_only_matches = s.show_only_matches;\n\t\t\t}\n\t\t\tif(show_only_matches_children === undefined) {\n\t\t\t\tshow_only_matches_children = s.show_only_matches_children;\n\t\t\t}\n\t\t\tif(!skip_async && a !== false) {\n\t\t\t\tif($.isFunction(a)) {\n\t\t\t\t\treturn a.call(this, str, $.proxy(function (d) {\n\t\t\t\t\t\t\tif(d && d.d) { d = d.d; }\n\t\t\t\t\t\t\tthis._load_nodes(!$.isArray(d) ? [] : $.vakata.array_unique(d), function () {\n\t\t\t\t\t\t\t\tthis.search(str, true, show_only_matches, inside, append, show_only_matches_children);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, this), inside);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\ta = $.extend({}, a);\n\t\t\t\t\tif(!a.data) { a.data = {}; }\n\t\t\t\t\ta.data.str = str;\n\t\t\t\t\tif(inside) {\n\t\t\t\t\t\ta.data.inside = inside;\n\t\t\t\t\t}\n\t\t\t\t\tif (this._data.search.lastRequest) {\n\t\t\t\t\t\tthis._data.search.lastRequest.abort();\n\t\t\t\t\t}\n\t\t\t\t\tthis._data.search.lastRequest = $.ajax(a)\n\t\t\t\t\t\t.fail($.proxy(function () {\n\t\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'ajax', 'plugin' : 'search', 'id' : 'search_01', 'reason' : 'Could not load search parents', 'data' : JSON.stringify(a) };\n\t\t\t\t\t\t\tthis.settings.core.error.call(this, this._data.core.last_error);\n\t\t\t\t\t\t}, this))\n\t\t\t\t\t\t.done($.proxy(function (d) {\n\t\t\t\t\t\t\tif(d && d.d) { d = d.d; }\n\t\t\t\t\t\t\tthis._load_nodes(!$.isArray(d) ? [] : $.vakata.array_unique(d), function () {\n\t\t\t\t\t\t\t\tthis.search(str, true, show_only_matches, inside, append, show_only_matches_children);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}, this));\n\t\t\t\t\treturn this._data.search.lastRequest;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(!append) {\n\t\t\t\tthis._data.search.str = str;\n\t\t\t\tthis._data.search.dom = $();\n\t\t\t\tthis._data.search.res = [];\n\t\t\t\tthis._data.search.opn = [];\n\t\t\t\tthis._data.search.som = show_only_matches;\n\t\t\t\tthis._data.search.smc = show_only_matches_children;\n\t\t\t}\n\n\t\t\tf = new $.vakata.search(str, true, { caseSensitive : s.case_sensitive, fuzzy : s.fuzzy });\n\t\t\t$.each(m[inside ? inside : $.jstree.root].children_d, function (ii, i) {\n\t\t\t\tvar v = m[i];\n\t\t\t\tif(v.text && !v.state.hidden && (!s.search_leaves_only || (v.state.loaded && v.children.length === 0)) && ( (s.search_callback && s.search_callback.call(this, str, v)) || (!s.search_callback && f.search(v.text).isMatch) ) ) {\n\t\t\t\t\tr.push(i);\n\t\t\t\t\tp = p.concat(v.parents);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif(r.length) {\n\t\t\t\tp = $.vakata.array_unique(p);\n\t\t\t\tfor(i = 0, j = p.length; i < j; i++) {\n\t\t\t\t\tif(p[i] !== $.jstree.root && m[p[i]] && this.open_node(p[i], null, 0) === true) {\n\t\t\t\t\t\tthis._data.search.opn.push(p[i]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(!append) {\n\t\t\t\t\tthis._data.search.dom = $(this.element[0].querySelectorAll('#' + $.map(r, function (v) { return \"0123456789\".indexOf(v[0]) !== -1 ? '\\\\3' + v[0] + ' ' + v.substr(1).replace($.jstree.idregex,'\\\\$&') : v.replace($.jstree.idregex,'\\\\$&'); }).join(', #')));\n\t\t\t\t\tthis._data.search.res = r;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._data.search.dom = this._data.search.dom.add($(this.element[0].querySelectorAll('#' + $.map(r, function (v) { return \"0123456789\".indexOf(v[0]) !== -1 ? '\\\\3' + v[0] + ' ' + v.substr(1).replace($.jstree.idregex,'\\\\$&') : v.replace($.jstree.idregex,'\\\\$&'); }).join(', #'))));\n\t\t\t\t\tthis._data.search.res = $.vakata.array_unique(this._data.search.res.concat(r));\n\t\t\t\t}\n\t\t\t\tthis._data.search.dom.children(\".jstree-anchor\").addClass('jstree-search');\n\t\t\t}\n\t\t\t/**\n\t\t\t * triggered after search is complete\n\t\t\t * @event\n\t\t\t * @name search.jstree\n\t\t\t * @param {jQuery} nodes a jQuery collection of matching nodes\n\t\t\t * @param {String} str the search string\n\t\t\t * @param {Array} res a collection of objects represeing the matching nodes\n\t\t\t * @plugin search\n\t\t\t */\n\t\t\tthis.trigger('search', { nodes : this._data.search.dom, str : str, res : this._data.search.res, show_only_matches : show_only_matches });\n\t\t};\n\t\t/**\n\t\t * used to clear the last search (removes classes and shows all nodes if filtering is on)\n\t\t * @name clear_search()\n\t\t * @plugin search\n\t\t * @trigger clear_search.jstree\n\t\t */\n\t\tthis.clear_search = function () {\n\t\t\tif(this.settings.search.close_opened_onclear) {\n\t\t\t\tthis.close_node(this._data.search.opn, 0);\n\t\t\t}\n\t\t\t/**\n\t\t\t * triggered after search is complete\n\t\t\t * @event\n\t\t\t * @name clear_search.jstree\n\t\t\t * @param {jQuery} nodes a jQuery collection of matching nodes (the result from the last search)\n\t\t\t * @param {String} str the search string (the last search string)\n\t\t\t * @param {Array} res a collection of objects represeing the matching nodes (the result from the last search)\n\t\t\t * @plugin search\n\t\t\t */\n\t\t\tthis.trigger('clear_search', { 'nodes' : this._data.search.dom, str : this._data.search.str, res : this._data.search.res });\n\t\t\tif(this._data.search.res.length) {\n\t\t\t\tthis._data.search.dom = $(this.element[0].querySelectorAll('#' + $.map(this._data.search.res, function (v) {\n\t\t\t\t\treturn \"0123456789\".indexOf(v[0]) !== -1 ? '\\\\3' + v[0] + ' ' + v.substr(1).replace($.jstree.idregex,'\\\\$&') : v.replace($.jstree.idregex,'\\\\$&');\n\t\t\t\t}).join(', #')));\n\t\t\t\tthis._data.search.dom.children(\".jstree-anchor\").removeClass(\"jstree-search\");\n\t\t\t}\n\t\t\tthis._data.search.str = \"\";\n\t\t\tthis._data.search.res = [];\n\t\t\tthis._data.search.opn = [];\n\t\t\tthis._data.search.dom = $();\n\t\t};\n\n\t\tthis.redraw_node = function(obj, deep, callback, force_render) {\n\t\t\tobj = parent.redraw_node.apply(this, arguments);\n\t\t\tif(obj) {\n\t\t\t\tif($.inArray(obj.id, this._data.search.res) !== -1) {\n\t\t\t\t\tvar i, j, tmp = null;\n\t\t\t\t\tfor(i = 0, j = obj.childNodes.length; i < j; i++) {\n\t\t\t\t\t\tif(obj.childNodes[i] && obj.childNodes[i].className && obj.childNodes[i].className.indexOf(\"jstree-anchor\") !== -1) {\n\t\t\t\t\t\t\ttmp = obj.childNodes[i];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(tmp) {\n\t\t\t\t\t\ttmp.className += ' jstree-search';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn obj;\n\t\t};\n\t};\n\n\t// helpers\n\t(function ($) {\n\t\t// from http://kiro.me/projects/fuse.html\n\t\t$.vakata.search = function(pattern, txt, options) {\n\t\t\toptions = options || {};\n\t\t\toptions = $.extend({}, $.vakata.search.defaults, options);\n\t\t\tif(options.fuzzy !== false) {\n\t\t\t\toptions.fuzzy = true;\n\t\t\t}\n\t\t\tpattern = options.caseSensitive ? pattern : pattern.toLowerCase();\n\t\t\tvar MATCH_LOCATION\t= options.location,\n\t\t\t\tMATCH_DISTANCE\t= options.distance,\n\t\t\t\tMATCH_THRESHOLD\t= options.threshold,\n\t\t\t\tpatternLen = pattern.length,\n\t\t\t\tmatchmask, pattern_alphabet, match_bitapScore, search;\n\t\t\tif(patternLen > 32) {\n\t\t\t\toptions.fuzzy = false;\n\t\t\t}\n\t\t\tif(options.fuzzy) {\n\t\t\t\tmatchmask = 1 << (patternLen - 1);\n\t\t\t\tpattern_alphabet = (function () {\n\t\t\t\t\tvar mask = {},\n\t\t\t\t\t\ti = 0;\n\t\t\t\t\tfor (i = 0; i < patternLen; i++) {\n\t\t\t\t\t\tmask[pattern.charAt(i)] = 0;\n\t\t\t\t\t}\n\t\t\t\t\tfor (i = 0; i < patternLen; i++) {\n\t\t\t\t\t\tmask[pattern.charAt(i)] |= 1 << (patternLen - i - 1);\n\t\t\t\t\t}\n\t\t\t\t\treturn mask;\n\t\t\t\t}());\n\t\t\t\tmatch_bitapScore = function (e, x) {\n\t\t\t\t\tvar accuracy = e / patternLen,\n\t\t\t\t\t\tproximity = Math.abs(MATCH_LOCATION - x);\n\t\t\t\t\tif(!MATCH_DISTANCE) {\n\t\t\t\t\t\treturn proximity ? 1.0 : accuracy;\n\t\t\t\t\t}\n\t\t\t\t\treturn accuracy + (proximity / MATCH_DISTANCE);\n\t\t\t\t};\n\t\t\t}\n\t\t\tsearch = function (text) {\n\t\t\t\ttext = options.caseSensitive ? text : text.toLowerCase();\n\t\t\t\tif(pattern === text || text.indexOf(pattern) !== -1) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tisMatch: true,\n\t\t\t\t\t\tscore: 0\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif(!options.fuzzy) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tisMatch: false,\n\t\t\t\t\t\tscore: 1\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tvar i, j,\n\t\t\t\t\ttextLen = text.length,\n\t\t\t\t\tscoreThreshold = MATCH_THRESHOLD,\n\t\t\t\t\tbestLoc = text.indexOf(pattern, MATCH_LOCATION),\n\t\t\t\t\tbinMin, binMid,\n\t\t\t\t\tbinMax = patternLen + textLen,\n\t\t\t\t\tlastRd, start, finish, rd, charMatch,\n\t\t\t\t\tscore = 1,\n\t\t\t\t\tlocations = [];\n\t\t\t\tif (bestLoc !== -1) {\n\t\t\t\t\tscoreThreshold = Math.min(match_bitapScore(0, bestLoc), scoreThreshold);\n\t\t\t\t\tbestLoc = text.lastIndexOf(pattern, MATCH_LOCATION + patternLen);\n\t\t\t\t\tif (bestLoc !== -1) {\n\t\t\t\t\t\tscoreThreshold = Math.min(match_bitapScore(0, bestLoc), scoreThreshold);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbestLoc = -1;\n\t\t\t\tfor (i = 0; i < patternLen; i++) {\n\t\t\t\t\tbinMin = 0;\n\t\t\t\t\tbinMid = binMax;\n\t\t\t\t\twhile (binMin < binMid) {\n\t\t\t\t\t\tif (match_bitapScore(i, MATCH_LOCATION + binMid) <= scoreThreshold) {\n\t\t\t\t\t\t\tbinMin = binMid;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tbinMax = binMid;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbinMid = Math.floor((binMax - binMin) / 2 + binMin);\n\t\t\t\t\t}\n\t\t\t\t\tbinMax = binMid;\n\t\t\t\t\tstart = Math.max(1, MATCH_LOCATION - binMid + 1);\n\t\t\t\t\tfinish = Math.min(MATCH_LOCATION + binMid, textLen) + patternLen;\n\t\t\t\t\trd = new Array(finish + 2);\n\t\t\t\t\trd[finish + 1] = (1 << i) - 1;\n\t\t\t\t\tfor (j = finish; j >= start; j--) {\n\t\t\t\t\t\tcharMatch = pattern_alphabet[text.charAt(j - 1)];\n\t\t\t\t\t\tif (i === 0) {\n\t\t\t\t\t\t\trd[j] = ((rd[j + 1] << 1) | 1) & charMatch;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\trd[j] = ((rd[j + 1] << 1) | 1) & charMatch | (((lastRd[j + 1] | lastRd[j]) << 1) | 1) | lastRd[j + 1];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (rd[j] & matchmask) {\n\t\t\t\t\t\t\tscore = match_bitapScore(i, j - 1);\n\t\t\t\t\t\t\tif (score <= scoreThreshold) {\n\t\t\t\t\t\t\t\tscoreThreshold = score;\n\t\t\t\t\t\t\t\tbestLoc = j - 1;\n\t\t\t\t\t\t\t\tlocations.push(bestLoc);\n\t\t\t\t\t\t\t\tif (bestLoc > MATCH_LOCATION) {\n\t\t\t\t\t\t\t\t\tstart = Math.max(1, 2 * MATCH_LOCATION - bestLoc);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (match_bitapScore(i + 1, MATCH_LOCATION) > scoreThreshold) {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tlastRd = rd;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tisMatch: bestLoc >= 0,\n\t\t\t\t\tscore: score\n\t\t\t\t};\n\t\t\t};\n\t\t\treturn txt === true ? { 'search' : search } : search(txt);\n\t\t};\n\t\t$.vakata.search.defaults = {\n\t\t\tlocation : 0,\n\t\t\tdistance : 100,\n\t\t\tthreshold : 0.6,\n\t\t\tfuzzy : false,\n\t\t\tcaseSensitive : false\n\t\t};\n\t}($));\n\n\t// include the search plugin by default\n\t// $.jstree.defaults.plugins.push(\"search\");\n\n\treturn $;\n\t\n});\n"]}