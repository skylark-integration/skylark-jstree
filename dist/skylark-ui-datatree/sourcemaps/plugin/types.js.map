{"version":3,"sources":["plugin/types.js"],"names":["define","langx","browser","eventer","noder","geom","velm","$","jstree","plugins","types","defaults","default","root","options","parent","this","init","el","i","j","hasOwnProperty","undefined","call","_model","data","type","refresh","skip_loading","forget_state","bind","element","on","proxy","e","k","m","dpc","nodes","t","settings","c","length","original","icon","li_attr","a_attr","get_json","obj","flat","opt","extend","no_id","tmp","isArray","id","_delete_ids","children","check","chk","par","pos","more","get_node","d","origin","reference","inArray","get_rules","max_children","_data","core","last_error","error","plugin","reason","JSON","stringify","valid_children","children_d","parents","Math","max","max_depth","get_type","rules","set_type","t1","t2","old_type","old_icon","a","slice","get_icon","set_icon","replace","removeClass","removeAttr","attr","addClass"],"mappings":"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","file":"../../plugin/types.js","sourcesContent":["define([\n  \"skylark-utils/langx\",\n  \"skylark-utils/browser\",\n  \"skylark-utils/eventer\",\n  \"skylark-utils/noder\",\n  \"skylark-utils/geom\",\n  \"skylark-utils/velm\",\n  \"skylark-utils/query\",\n  \"../tree\"\n],function(langx,browser,eventer,noder,geom,velm,$,jstree){\n\t\"use strict\";\n\n\tif($.jstree.plugins.types) { return; }\n\n\t/**\n\t * An object storing all types as key value pairs, where the key is the type name and the value is an object that could contain following keys (all optional).\n\t *\n\t * * `max_children` the maximum number of immediate children this node type can have. Do not specify or set to `-1` for unlimited.\n\t * * `max_depth` the maximum number of nesting this node type can have. A value of `1` would mean that the node can have children, but no grandchildren. Do not specify or set to `-1` for unlimited.\n\t * * `valid_children` an array of node type strings, that nodes of this type can have as children. Do not specify or set to `-1` for no limits.\n\t * * `icon` a string - can be a path to an icon or a className, if using an image that is in the current directory use a `./` prefix, otherwise it will be detected as a class. Omit to use the default icon from your theme.\n\t * * `li_attr` an object of values which will be used to add HTML attributes on the resulting LI DOM node (merged with the node's own data)\n\t * * `a_attr` an object of values which will be used to add HTML attributes on the resulting A DOM node (merged with the node's own data)\n\t *\n\t * There are two predefined types:\n\t *\n\t * * `#` represents the root of the tree, for example `max_children` would control the maximum number of root nodes.\n\t * * `default` represents the default node - any settings here will be applied to all nodes that do not have a type specified.\n\t *\n\t * @name $.jstree.defaults.types\n\t * @plugin types\n\t */\n\t$.jstree.defaults.types = {\n\t\t'default' : {}\n\t};\n\t$.jstree.defaults.types[$.jstree.root] = {};\n\n\t$.jstree.plugins.types = function (options, parent) {\n\t\tthis.init = function (el, options) {\n\t\t\tvar i, j;\n\t\t\tif(options && options.types && options.types['default']) {\n\t\t\t\tfor(i in options.types) {\n\t\t\t\t\tif(i !== \"default\" && i !== $.jstree.root && options.types.hasOwnProperty(i)) {\n\t\t\t\t\t\tfor(j in options.types['default']) {\n\t\t\t\t\t\t\tif(options.types['default'].hasOwnProperty(j) && options.types[i][j] === undefined) {\n\t\t\t\t\t\t\t\toptions.types[i][j] = options.types['default'][j];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tparent.init.call(this, el, options);\n\t\t\tthis._model.data[$.jstree.root].type = $.jstree.root;\n\t\t};\n\t\tthis.refresh = function (skip_loading, forget_state) {\n\t\t\tparent.refresh.call(this, skip_loading, forget_state);\n\t\t\tthis._model.data[$.jstree.root].type = $.jstree.root;\n\t\t};\n\t\tthis.bind = function () {\n\t\t\tthis.element\n\t\t\t\t.on('model.jstree', $.proxy(function (e, data) {\n\t\t\t\t\t\tvar m = this._model.data,\n\t\t\t\t\t\t\tdpc = data.nodes,\n\t\t\t\t\t\t\tt = this.settings.types,\n\t\t\t\t\t\t\ti, j, c = 'default', k;\n\t\t\t\t\t\tfor(i = 0, j = dpc.length; i < j; i++) {\n\t\t\t\t\t\t\tc = 'default';\n\t\t\t\t\t\t\tif(m[dpc[i]].original && m[dpc[i]].original.type && t[m[dpc[i]].original.type]) {\n\t\t\t\t\t\t\t\tc = m[dpc[i]].original.type;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(m[dpc[i]].data && m[dpc[i]].data.jstree && m[dpc[i]].data.jstree.type && t[m[dpc[i]].data.jstree.type]) {\n\t\t\t\t\t\t\t\tc = m[dpc[i]].data.jstree.type;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tm[dpc[i]].type = c;\n\t\t\t\t\t\t\tif(m[dpc[i]].icon === true && t[c].icon !== undefined) {\n\t\t\t\t\t\t\t\tm[dpc[i]].icon = t[c].icon;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(t[c].li_attr !== undefined && typeof t[c].li_attr === 'object') {\n\t\t\t\t\t\t\t\tfor (k in t[c].li_attr) {\n\t\t\t\t\t\t\t\t\tif (t[c].li_attr.hasOwnProperty(k)) {\n\t\t\t\t\t\t\t\t\t\tif (k === 'id') {\n\t\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse if (m[dpc[i]].li_attr[k] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\tm[dpc[i]].li_attr[k] = t[c].li_attr[k];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse if (k === 'class') {\n\t\t\t\t\t\t\t\t\t\t\tm[dpc[i]].li_attr['class'] = t[c].li_attr['class'] + ' ' + m[dpc[i]].li_attr['class'];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif(t[c].a_attr !== undefined && typeof t[c].a_attr === 'object') {\n\t\t\t\t\t\t\t\tfor (k in t[c].a_attr) {\n\t\t\t\t\t\t\t\t\tif (t[c].a_attr.hasOwnProperty(k)) {\n\t\t\t\t\t\t\t\t\t\tif (k === 'id') {\n\t\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse if (m[dpc[i]].a_attr[k] === undefined) {\n\t\t\t\t\t\t\t\t\t\t\tm[dpc[i]].a_attr[k] = t[c].a_attr[k];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse if (k === 'href' && m[dpc[i]].a_attr[k] === '#') {\n\t\t\t\t\t\t\t\t\t\t\tm[dpc[i]].a_attr['href'] = t[c].a_attr['href'];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse if (k === 'class') {\n\t\t\t\t\t\t\t\t\t\t\tm[dpc[i]].a_attr['class'] = t[c].a_attr['class'] + ' ' + m[dpc[i]].a_attr['class'];\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tm[$.jstree.root].type = $.jstree.root;\n\t\t\t\t\t}, this));\n\t\t\tparent.bind.call(this);\n\t\t};\n\t\tthis.get_json = function (obj, options, flat) {\n\t\t\tvar i, j,\n\t\t\t\tm = this._model.data,\n\t\t\t\topt = options ? $.extend(true, {}, options, {no_id:false}) : {},\n\t\t\t\ttmp = parent.get_json.call(this, obj, opt, flat);\n\t\t\tif(tmp === false) { return false; }\n\t\t\tif($.isArray(tmp)) {\n\t\t\t\tfor(i = 0, j = tmp.length; i < j; i++) {\n\t\t\t\t\ttmp[i].type = tmp[i].id && m[tmp[i].id] && m[tmp[i].id].type ? m[tmp[i].id].type : \"default\";\n\t\t\t\t\tif(options && options.no_id) {\n\t\t\t\t\t\tdelete tmp[i].id;\n\t\t\t\t\t\tif(tmp[i].li_attr && tmp[i].li_attr.id) {\n\t\t\t\t\t\t\tdelete tmp[i].li_attr.id;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(tmp[i].a_attr && tmp[i].a_attr.id) {\n\t\t\t\t\t\t\tdelete tmp[i].a_attr.id;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\ttmp.type = tmp.id && m[tmp.id] && m[tmp.id].type ? m[tmp.id].type : \"default\";\n\t\t\t\tif(options && options.no_id) {\n\t\t\t\t\ttmp = this._delete_ids(tmp);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn tmp;\n\t\t};\n\t\tthis._delete_ids = function (tmp) {\n\t\t\tif($.isArray(tmp)) {\n\t\t\t\tfor(var i = 0, j = tmp.length; i < j; i++) {\n\t\t\t\t\ttmp[i] = this._delete_ids(tmp[i]);\n\t\t\t\t}\n\t\t\t\treturn tmp;\n\t\t\t}\n\t\t\tdelete tmp.id;\n\t\t\tif(tmp.li_attr && tmp.li_attr.id) {\n\t\t\t\tdelete tmp.li_attr.id;\n\t\t\t}\n\t\t\tif(tmp.a_attr && tmp.a_attr.id) {\n\t\t\t\tdelete tmp.a_attr.id;\n\t\t\t}\n\t\t\tif(tmp.children && $.isArray(tmp.children)) {\n\t\t\t\ttmp.children = this._delete_ids(tmp.children);\n\t\t\t}\n\t\t\treturn tmp;\n\t\t};\n\t\tthis.check = function (chk, obj, par, pos, more) {\n\t\t\tif(parent.check.call(this, chk, obj, par, pos, more) === false) { return false; }\n\t\t\tobj = obj && obj.id ? obj : this.get_node(obj);\n\t\t\tpar = par && par.id ? par : this.get_node(par);\n\t\t\tvar m = obj && obj.id ? (more && more.origin ? more.origin : $.jstree.reference(obj.id)) : null, tmp, d, i, j;\n\t\t\tm = m && m._model && m._model.data ? m._model.data : null;\n\t\t\tswitch(chk) {\n\t\t\t\tcase \"create_node\":\n\t\t\t\tcase \"move_node\":\n\t\t\t\tcase \"copy_node\":\n\t\t\t\t\tif(chk !== 'move_node' || $.inArray(obj.id, par.children) === -1) {\n\t\t\t\t\t\ttmp = this.get_rules(par);\n\t\t\t\t\t\tif(tmp.max_children !== undefined && tmp.max_children !== -1 && tmp.max_children === par.children.length) {\n\t\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'types', 'id' : 'types_01', 'reason' : 'max_children prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(tmp.valid_children !== undefined && tmp.valid_children !== -1 && $.inArray((obj.type || 'default'), tmp.valid_children) === -1) {\n\t\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'types', 'id' : 'types_02', 'reason' : 'valid_children prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(m && obj.children_d && obj.parents) {\n\t\t\t\t\t\t\td = 0;\n\t\t\t\t\t\t\tfor(i = 0, j = obj.children_d.length; i < j; i++) {\n\t\t\t\t\t\t\t\td = Math.max(d, m[obj.children_d[i]].parents.length);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\td = d - obj.parents.length + 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(d <= 0 || d === undefined) { d = 1; }\n\t\t\t\t\t\tdo {\n\t\t\t\t\t\t\tif(tmp.max_depth !== undefined && tmp.max_depth !== -1 && tmp.max_depth < d) {\n\t\t\t\t\t\t\t\tthis._data.core.last_error = { 'error' : 'check', 'plugin' : 'types', 'id' : 'types_03', 'reason' : 'max_depth prevents function: ' + chk, 'data' : JSON.stringify({ 'chk' : chk, 'pos' : pos, 'obj' : obj && obj.id ? obj.id : false, 'par' : par && par.id ? par.id : false }) };\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tpar = this.get_node(par.parent);\n\t\t\t\t\t\t\ttmp = this.get_rules(par);\n\t\t\t\t\t\t\td++;\n\t\t\t\t\t\t} while(par);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\t\t/**\n\t\t * used to retrieve the type settings object for a node\n\t\t * @name get_rules(obj)\n\t\t * @param {mixed} obj the node to find the rules for\n\t\t * @return {Object}\n\t\t * @plugin types\n\t\t */\n\t\tthis.get_rules = function (obj) {\n\t\t\tobj = this.get_node(obj);\n\t\t\tif(!obj) { return false; }\n\t\t\tvar tmp = this.get_type(obj, true);\n\t\t\tif(tmp.max_depth === undefined) { tmp.max_depth = -1; }\n\t\t\tif(tmp.max_children === undefined) { tmp.max_children = -1; }\n\t\t\tif(tmp.valid_children === undefined) { tmp.valid_children = -1; }\n\t\t\treturn tmp;\n\t\t};\n\t\t/**\n\t\t * used to retrieve the type string or settings object for a node\n\t\t * @name get_type(obj [, rules])\n\t\t * @param {mixed} obj the node to find the rules for\n\t\t * @param {Boolean} rules if set to `true` instead of a string the settings object will be returned\n\t\t * @return {String|Object}\n\t\t * @plugin types\n\t\t */\n\t\tthis.get_type = function (obj, rules) {\n\t\t\tobj = this.get_node(obj);\n\t\t\treturn (!obj) ? false : ( rules ? $.extend({ 'type' : obj.type }, this.settings.types[obj.type]) : obj.type);\n\t\t};\n\t\t/**\n\t\t * used to change a node's type\n\t\t * @name set_type(obj, type)\n\t\t * @param {mixed} obj the node to change\n\t\t * @param {String} type the new type\n\t\t * @plugin types\n\t\t */\n\t\tthis.set_type = function (obj, type) {\n\t\t\tvar m = this._model.data, t, t1, t2, old_type, old_icon, k, d, a;\n\t\t\tif($.isArray(obj)) {\n\t\t\t\tobj = obj.slice();\n\t\t\t\tfor(t1 = 0, t2 = obj.length; t1 < t2; t1++) {\n\t\t\t\t\tthis.set_type(obj[t1], type);\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tt = this.settings.types;\n\t\t\tobj = this.get_node(obj);\n\t\t\tif(!t[type] || !obj) { return false; }\n\t\t\td = this.get_node(obj, true);\n\t\t\tif (d && d.length) {\n\t\t\t\ta = d.children('.jstree-anchor');\n\t\t\t}\n\t\t\told_type = obj.type;\n\t\t\told_icon = this.get_icon(obj);\n\t\t\tobj.type = type;\n\t\t\tif(old_icon === true || !t[old_type] || (t[old_type].icon !== undefined && old_icon === t[old_type].icon)) {\n\t\t\t\tthis.set_icon(obj, t[type].icon !== undefined ? t[type].icon : true);\n\t\t\t}\n\n\t\t\t// remove old type props\n\t\t\tif(t[old_type] && t[old_type].li_attr !== undefined && typeof t[old_type].li_attr === 'object') {\n\t\t\t\tfor (k in t[old_type].li_attr) {\n\t\t\t\t\tif (t[old_type].li_attr.hasOwnProperty(k)) {\n\t\t\t\t\t\tif (k === 'id') {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (k === 'class') {\n\t\t\t\t\t\t\tm[obj.id].li_attr['class'] = (m[obj.id].li_attr['class'] || '').replace(t[old_type].li_attr[k], '');\n\t\t\t\t\t\t\tif (d) { d.removeClass(t[old_type].li_attr[k]); }\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (m[obj.id].li_attr[k] === t[old_type].li_attr[k]) {\n\t\t\t\t\t\t\tm[obj.id].li_attr[k] = null;\n\t\t\t\t\t\t\tif (d) { d.removeAttr(k); }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(t[old_type] && t[old_type].a_attr !== undefined && typeof t[old_type].a_attr === 'object') {\n\t\t\t\tfor (k in t[old_type].a_attr) {\n\t\t\t\t\tif (t[old_type].a_attr.hasOwnProperty(k)) {\n\t\t\t\t\t\tif (k === 'id') {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (k === 'class') {\n\t\t\t\t\t\t\tm[obj.id].a_attr['class'] = (m[obj.id].a_attr['class'] || '').replace(t[old_type].a_attr[k], '');\n\t\t\t\t\t\t\tif (a) { a.removeClass(t[old_type].a_attr[k]); }\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (m[obj.id].a_attr[k] === t[old_type].a_attr[k]) {\n\t\t\t\t\t\t\tif (k === 'href') {\n\t\t\t\t\t\t\t\tm[obj.id].a_attr[k] = '#';\n\t\t\t\t\t\t\t\tif (a) { a.attr('href', '#'); }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tdelete m[obj.id].a_attr[k];\n\t\t\t\t\t\t\t\tif (a) { a.removeAttr(k); }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// add new props\n\t\t\tif(t[type].li_attr !== undefined && typeof t[type].li_attr === 'object') {\n\t\t\t\tfor (k in t[type].li_attr) {\n\t\t\t\t\tif (t[type].li_attr.hasOwnProperty(k)) {\n\t\t\t\t\t\tif (k === 'id') {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (m[obj.id].li_attr[k] === undefined) {\n\t\t\t\t\t\t\tm[obj.id].li_attr[k] = t[type].li_attr[k];\n\t\t\t\t\t\t\tif (d) {\n\t\t\t\t\t\t\t\tif (k === 'class') {\n\t\t\t\t\t\t\t\t\td.addClass(t[type].li_attr[k]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\td.attr(k, t[type].li_attr[k]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (k === 'class') {\n\t\t\t\t\t\t\tm[obj.id].li_attr['class'] = t[type].li_attr[k] + ' ' + m[obj.id].li_attr['class'];\n\t\t\t\t\t\t\tif (d) { d.addClass(t[type].li_attr[k]); }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif(t[type].a_attr !== undefined && typeof t[type].a_attr === 'object') {\n\t\t\t\tfor (k in t[type].a_attr) {\n\t\t\t\t\tif (t[type].a_attr.hasOwnProperty(k)) {\n\t\t\t\t\t\tif (k === 'id') {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (m[obj.id].a_attr[k] === undefined) {\n\t\t\t\t\t\t\tm[obj.id].a_attr[k] = t[type].a_attr[k];\n\t\t\t\t\t\t\tif (a) {\n\t\t\t\t\t\t\t\tif (k === 'class') {\n\t\t\t\t\t\t\t\t\ta.addClass(t[type].a_attr[k]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\ta.attr(k, t[type].a_attr[k]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (k === 'href' && m[obj.id].a_attr[k] === '#') {\n\t\t\t\t\t\t\tm[obj.id].a_attr['href'] = t[type].a_attr['href'];\n\t\t\t\t\t\t\tif (a) { a.attr('href', t[type].a_attr['href']); }\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (k === 'class') {\n\t\t\t\t\t\t\tm[obj.id].a_attr['class'] = t[type].a_attr['class'] + ' ' + m[obj.id].a_attr['class'];\n\t\t\t\t\t\t\tif (a) { a.addClass(t[type].a_attr[k]); }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t};\n\t};\n\t// include the types plugin by default\n\t// $.jstree.defaults.plugins.push(\"types\");\n\treturn $;\n\t\n});\n"]}