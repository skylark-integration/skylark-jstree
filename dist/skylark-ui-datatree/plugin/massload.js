/**
 * skylark-ui-datatree - The skylark datatree widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-ui-datatree/
 * @license MIT
 */
define(["skylark-utils/langx","skylark-utils/browser","skylark-utils/eventer","skylark-utils/noder","skylark-utils/geom","skylark-utils/velm","skylark-utils/query","../tree"],function(t,s,a,i,e,l,n,o){"use strict";if(!n.jstree.plugins.massload)return n.jstree.defaults.massload=null,n.jstree.plugins.massload=function(t,s){this.init=function(t,a){this._data.massload={},s.init.call(this,t,a)},this._load_nodes=function(t,a,i,e){var l,o,r,d=this.settings.massload,h=(JSON.stringify(t),[]),u=this._model.data;if(!i){for(l=0,o=t.length;l<o;l++)u[t[l]]&&(u[t[l]].state.loaded||u[t[l]].state.failed)&&!e||(h.push(t[l]),r=this.get_node(t[l],!0),r&&r.length&&r.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},h.length){if(n.isFunction(d))return d.call(this,h,n.proxy(function(l){var n,o;if(l)for(n in l)l.hasOwnProperty(n)&&(this._data.massload[n]=l[n]);for(n=0,o=t.length;n<o;n++)r=this.get_node(t[n],!0),r&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1);s._load_nodes.call(this,t,a,i,e)},this));if("object"==typeof d&&d&&d.url)return d=n.extend(!0,{},d),n.isFunction(d.url)&&(d.url=d.url.call(this,h)),n.isFunction(d.data)&&(d.data=d.data.call(this,h)),n.ajax(d).done(n.proxy(function(l,n,o){var d,h;if(l)for(d in l)l.hasOwnProperty(d)&&(this._data.massload[d]=l[d]);for(d=0,h=t.length;d<h;d++)r=this.get_node(t[d],!0),r&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1);s._load_nodes.call(this,t,a,i,e)},this)).fail(n.proxy(function(l){s._load_nodes.call(this,t,a,i,e)},this))}}return s._load_nodes.call(this,t,a,i,e)},this._load_node=function(t,a){var i,e=this._data.massload[t.id],l=null;return e?(l=this["string"==typeof e?"_append_html_data":"_append_json_data"](t,"string"==typeof e?n(n.parseHTML(e)).filter(function(){return 3!==this.nodeType}):e,function(t){a.call(this,t)}),i=this.get_node(t.id,!0),i&&i.length&&i.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],l):s._load_node.call(this,t,a)}},n});
//# sourceMappingURL=../sourcemaps/plugin/massload.js.map
