/**
 * skylark-jstree - A version of jstree that ported to running on skylarkjs ui.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-jstree/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-utils-dom/browser","skylark-utils-dom/eventer","skylark-utils-dom/noder","skylark-utils-dom/geom","skylark-utils-dom/query","../tree"],function(t,a,s,i,e,l,n){"use strict";if(!l.jstree.plugins.massload)return l.jstree.defaults.massload=null,l.jstree.plugins.massload=function(t,a){this.init=function(t,s){this._data.massload={},a.init.call(this,t,s)},this._load_nodes=function(t,s,i,e){var n,o,r,d=this.settings.massload,h=(JSON.stringify(t),[]),u=this._model.data;if(!i){for(n=0,o=t.length;n<o;n++)u[t[n]]&&(u[t[n]].state.loaded||u[t[n]].state.failed)&&!e||(h.push(t[n]),r=this.get_node(t[n],!0),r&&r.length&&r.addClass("jstree-loading").attr("aria-busy",!0));if(this._data.massload={},h.length){if(l.isFunction(d))return d.call(this,h,l.proxy(function(l){var n,o;if(l)for(n in l)l.hasOwnProperty(n)&&(this._data.massload[n]=l[n]);for(n=0,o=t.length;n<o;n++)r=this.get_node(t[n],!0),r&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1);a._load_nodes.call(this,t,s,i,e)},this));if("object"==typeof d&&d&&d.url)return d=l.extend(!0,{},d),l.isFunction(d.url)&&(d.url=d.url.call(this,h)),l.isFunction(d.data)&&(d.data=d.data.call(this,h)),l.ajax(d).done(l.proxy(function(l,n,o){var d,h;if(l)for(d in l)l.hasOwnProperty(d)&&(this._data.massload[d]=l[d]);for(d=0,h=t.length;d<h;d++)r=this.get_node(t[d],!0),r&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1);a._load_nodes.call(this,t,s,i,e)},this)).fail(l.proxy(function(l){a._load_nodes.call(this,t,s,i,e)},this))}}return a._load_nodes.call(this,t,s,i,e)},this._load_node=function(t,s){var i,e=this._data.massload[t.id],n=null;return e?(n=this["string"==typeof e?"_append_html_data":"_append_json_data"](t,"string"==typeof e?l(l.parseHTML(e)).filter(function(){return 3!==this.nodeType}):e,function(t){s.call(this,t)}),i=this.get_node(t.id,!0),i&&i.length&&i.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[t.id],n):a._load_node.call(this,t,s)}},l});
//# sourceMappingURL=../sourcemaps/plugin/massload.js.map
