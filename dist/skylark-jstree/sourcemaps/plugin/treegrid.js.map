{"version":3,"sources":["plugin/treegrid.js"],"names":["define","langx","browser","eventer","noder","geom","$","menu","jstree","BLANKRE","IDREGEX","escapeId","id","replace","NODE_DATA_ATTR","COL_DATA_ATTR","SEARCHCLASS","SPECIAL_TITLE","styled","MINCOLWIDTH","generateCellId","tree","getIds","nodes","makeArray","map","this","findDataCell","uniq","ids","col","scope","undefined","length","cellId","ret","columns","concat","join","forEach","elm","i","find","isClickedSep","toResize","oldMouseX","newMouseX","htmlstripre","copyData","fromtree","from","totree","to","recurse","j","data","extend","children_d","get_node","findLastClosedNode","node","children","state","opened","renderATitle","t","title","a","hasClass","settings","grid","get_text","attr","getCellData","value","val","defaults","width","plugins","options","parent","_guid","s4","Math","floor","random","toString","substring","_initialize","_initialized","styles","s","container","element","gs","_gridSettings","treeClass","context","contextmenu","columnWidth","defaultConf","*display","*+display","isThemeroller","_data","themeroller","treeWidthDiff","resizable","draggable","stateful","indent","sortOrder","sortAsc","caseInsensitive","fixedHeader","height","gridcontextmenu","treecol","gridcols","cols","columnSearch","target","edit","label","action","obj","_edit","len","push","ceil","rootid","msie","test","navigator","userAgent","toLowerCase","version","parseFloat","appVersion","split","display","zoom","appendTo","gridWrapper","addClass","insertAfter","midWrapper","append","scroll","css","scrollTop","defaultSort","proxy","sort","b","bigger","colrefs","caseInsensitiveSort","localeCompare","nodeA","nodeB","valueA","valueB","ui","sortable","axis","handle","cancel","start","event","item","index","stop","splice","console","warn","searchColumn","searchObj","validatedSearchObj","columnIndex","hasOwnProperty","Object","keys","search","column","search_callback","str","columnValue","f","vakata","caseSensitive","searchSettings","case_sensitive","fuzzy","isMatch","omniSearchCallback","matched","text","searchValue","trigger","init","el","call","bind","on","e","_detachColumns","_prepare_grid","_reattachColumns","removeNodes","remove","_hideOrShowTree","_hide_grid","_prepare_headers","q","anchorHeight","outerHeight","cls","match","new_instance","each","selected","_hover_node","removeClass","nodesToShow","endTime","that","startTime","Date","getTime","filter","holdingCells","cells","som","smc","add","parentsUntil","hide","_domManipulation","show","time","newtree","oldtree","old_instance","original","rslt","nextAll","localStorage","teardown","gw","gridparent","detach","_clean_grid","header","cl","ccl","name","last","puller","coluuid","_this","defaultWidth","tr","classAdd","hasHeaders","conf","borPadWidth","totalWidth","headerClass","columnClass","String","minWidth","maxWidth","html","core","themes","ellipsis","prependTo","outerWidth","next","bound","document","mouseup","ref","headers","currentTree","colNum","prevAll","closest","reference","isNaN","mousemove","pageX","oldPrevHeaderInner","oldPrevColWidth","newPrevColWidth","diff","innerWidth","max","clickedSep","newWidth","stopPropagation","symbol","rootNode","redraw_node","mw","parentNode","removeChild","appendChild","open_node","callback","animation","isArray","deep","is_callback","force_render","refresh","apply","arguments","set_id","old","result","oldNodes","_hideOrShowNode","child","lenj","getHoldingCells","hc","hidden","prop","rtl","w","h1","position","top","left","visibility","h2","class","padding","border","box-sizing","lineHeight","blur","v","keydown","key","which","stopImmediatePropagation","preventDefault","click","mousedown","keyup","min","keypress","fn","fontFamily","fontSize","fontWeight","fontStyle","fontStretch","fontVariant","letterSpacing","wordSpacing","select","grid_hide_column","grid_show_column","img","wcl","valClass","wideValClass","span","paddingleft","gridCellName","gridCellParentId","gridCellParent","gridCellPrev","gridCellPrevId","gridCellNext","gridCellNextId","gridCellChild","gridCellChildId","content","tmpWidth","highlightSearch","isClicked","closed","c","objData","cellClickHandler","create","sourceName","isDefaultPrevented","cellRightClickHandler","popup","x","y","pageY","hoverInHandler","jsTreeInstance","hover_node","hoverOutHandler","dehover_node","lid","peers","pos","inArray","rendered","cellClass","wideCellClass","format","images","substr","valueClass","valueClassPrefix","wideValueClass","wideValueClassPrefix","insertBefore","toRen","after","hover","overflow-y"],"mappings":"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","file":"../../plugin/treegrid.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-utils-dom/browser\",\r\n  \"skylark-utils-dom/eventer\",\r\n  \"skylark-utils-dom/noder\",\r\n  \"skylark-utils-dom/geom\",\r\n  \"skylark-utils-dom/query\",\r\n  \"./menu\",\r\n  \"../tree\"\r\n],function(langx,browser,eventer,noder,geom,$,menu,jstree){\r\n    var BLANKRE = /^\\s*$/g,\r\n        IDREGEX = /[\\\\:&!^|()\\[\\]<>@*'+~#\";,= \\/${}%]/g,\r\n        escapeId = function(id) {\r\n            return (id || \"\").replace(IDREGEX, '\\\\$&');\r\n        },\r\n        NODE_DATA_ATTR = \"data-jstreegrid\",\r\n        COL_DATA_ATTR = \"data-jstreegrid-column\",\r\n        SEARCHCLASS = \"jstree-search\",\r\n        SPECIAL_TITLE = \"_DATA_\",\r\n        LEVELINDENT = 24,\r\n        styled = false,\r\n        MINCOLWIDTH = 10,\r\n        generateCellId = function(tree, id) {\r\n            return (\"jstree_\" + tree + \"_grid_\" + escapeId(id) + \"_col\");\r\n        },\r\n        getIds = function(nodes) {\r\n            return $.makeArray(nodes.map(function() {\r\n                return this.id;\r\n            }));\r\n        },\r\n        findDataCell = function(uniq, ids, col, scope) {\r\n            if (scope == undefined) {\r\n                scope = $();\r\n            };\r\n            if (ids === null || ids === undefined || ids.length === 0) {\r\n                return scope;\r\n            }\r\n            var ret = $(),\r\n                columns = [].concat(col),\r\n                cellId;\r\n            if (typeof(ids) === \"string\") {\r\n                cellId = generateCellId(uniq, ids);\r\n                ret = columns.map(function(col) {\r\n                    return \"#\" + cellId + col;\r\n                }).join(\", \");\r\n            } else {\r\n                ret = []\r\n                ids.forEach(function(elm, i) {\r\n                    var cellId = generateCellId(uniq, elm);\r\n                    ret = ret.concat(columns.map(function(col) {\r\n                        return \"#\" + cellId + col;\r\n                    }));\r\n                });\r\n                ret = ret.join(\", \");\r\n            }\r\n            return columns.length == 1 ? scope.find(ret) : $(ret);\r\n        },\r\n        isClickedSep = false,\r\n        toResize = null,\r\n        oldMouseX = 0,\r\n        newMouseX = 0,\r\n\r\n        /*jslint regexp:true */\r\n        htmlstripre = /<\\/?[^>]+>/gi,\r\n        /*jslint regexp:false */\r\n\r\n        getIndent = function(node, tree) {\r\n            var div, i, li, width;\r\n\r\n            // did we already save it for this tree?\r\n            tree._gridSettings = tree._gridSettings || {};\r\n            if (tree._gridSettings.indent > 0) {\r\n                width = tree._gridSettings.indent;\r\n            } else {\r\n                // create a new div on the DOM but not visible on the page\r\n                div = $(\"<div></div>\");\r\n                i = node.prev(\"i\");\r\n                li = i.parent();\r\n                // add to that div all of the classes on the tree root\r\n                div.addClass(tree.get_node(\"#\", true).attr(\"class\"));\r\n\r\n                // move the li to the temporary div root\r\n                li.appendTo(div);\r\n\r\n                // attach to the body quickly\r\n                div.appendTo($(\"body\"));\r\n\r\n                // get the width\r\n                width = i.width() || LEVELINDENT;\r\n\r\n                // detach the li from the new div and destroy the new div\r\n                li.detach();\r\n                div.remove();\r\n\r\n                // save it for the future\r\n                tree._gridSettings.indent = width;\r\n            }\r\n\r\n\r\n            return (width);\r\n\r\n        },\r\n\r\n        copyData = function(fromtree, from, totree, to, recurse) {\r\n            var i, j;\r\n            to.data = $.extend(true, {}, from.data);\r\n            if (from && from.children_d && recurse) {\r\n                for (i = 0, j = from.children_d.length; i < j; i++) {\r\n                    copyData(fromtree, fromtree.get_node(from.children_d[i]), totree, totree.get_node(to.children_d[i]), recurse);\r\n                }\r\n            }\r\n        },\r\n\r\n        findLastClosedNode = function(tree, id) {\r\n            // first get our node\r\n            var ret, node = tree.get_node(id),\r\n                children = node.children;\r\n            // is it closed?\r\n            if (!children || children.length <= 0 || !node.state.opened) {\r\n                ret = id;\r\n            } else {\r\n                ret = findLastClosedNode(tree, children[children.length - 1]);\r\n            }\r\n            return (ret);\r\n        },\r\n\r\n        renderAWidth = function(node, tree) {\r\n            var depth, width,\r\n                fullWidth = parseInt(tree.settings.grid.columns[0].width, 10) + parseInt(tree._gridSettings.treeWidthDiff, 10);\r\n            // need to use a selector in jquery 1.4.4+\r\n            depth = tree.get_node(node).parents.length;\r\n            width = fullWidth - depth * getIndent(node, tree);\r\n            // the following line is no longer needed, since we are doing this inside a <td>\r\n            //a.css({\"vertical-align\": \"top\", \"overflow\":\"hidden\"});\r\n            return (fullWidth);\r\n        },\r\n        renderATitle = function(node, t, tree) {\r\n            var a = node.hasClass(\"jstree-anchor\") ? node : node.children(\"[class~='jstree-anchor']\"),\r\n                title, col = tree.settings.grid.columns[0];\r\n            // get the title\r\n            title = \"\";\r\n            if (col.title) {\r\n                if (col.title === SPECIAL_TITLE) {\r\n                    title = tree.get_text(t);\r\n                } else if (t.attr(col.title)) {\r\n                    title = t.attr(col.title);\r\n                }\r\n            }\r\n            // strip out HTML\r\n            title = title.replace(htmlstripre, '');\r\n            if (title) {\r\n                a.attr(\"title\", title);\r\n            }\r\n        },\r\n        getCellData = function(value, data) {\r\n            var val;\r\n            // get the contents of the cell - value could be a string or a function\r\n            if (value !== undefined && value !== null) {\r\n                if (typeof(value) === \"function\") {\r\n                    val = value(data);\r\n                } else if (data.data !== null && data.data !== undefined && data.data[value] !== undefined) {\r\n                    val = data.data[value];\r\n                } else {\r\n                    val = \"\";\r\n                }\r\n            } else {\r\n                val = \"\";\r\n            }\r\n            return val;\r\n        };\r\n\r\n    $.jstree.defaults.grid = {\r\n        width: 'auto'\r\n    };\r\n\r\n    $.jstree.plugins.grid = function(options, parent) {\r\n        this._initialize = function() {\r\n            if (!this._initialized) {\r\n                var s = this.settings.grid || {},\r\n                    styles, container = this.element,\r\n                    i,\r\n                    gs = this._gridSettings = {\r\n                        columns: s.columns || [],\r\n                        treeClass: \"jstree-grid-col-0\",\r\n                        context: s.contextmenu || false,\r\n                        columnWidth: s.columnWidth,\r\n                        defaultConf: {\r\n                            \"*display\": \"inline\",\r\n                            \"*+display\": \"inline\"\r\n                        },\r\n                        isThemeroller: !!this._data.themeroller,\r\n                        treeWidthDiff: 0,\r\n                        resizable: s.resizable,\r\n                        draggable: s.draggable,\r\n                        stateful: s.stateful,\r\n                        indent: 0,\r\n                        sortOrder: 'text',\r\n                        sortAsc: true,\r\n                        caseInsensitive: s.caseInsensitive,\r\n                        fixedHeader: s.fixedHeader !== false,\r\n                        width: s.width,\r\n                        height: s.height,\r\n                        gridcontextmenu: s.gridcontextmenu,\r\n                        treecol: 0,\r\n                        gridcols: []\r\n                    },\r\n                    cols = gs.columns,\r\n                    treecol = 0,\r\n                    columnSearch = false;\r\n                if (gs.gridcontextmenu === true) {\r\n                    gs.gridcontextmenu = function(grid, tree, node, val, col, t, target) {\r\n                        return {\r\n                            \"edit\": {\r\n                                label: \"Edit\",\r\n                                \"action\": function(data) {\r\n                                    var obj = t.get_node(node);\r\n                                    grid._edit(obj, col, target);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                } else if (gs.gridcontextmenu === false) {\r\n                    gs.gridcontextmenu = false;\r\n                }\r\n                // find which column our tree shuld go in\r\n                for (var i = 0, len = s.columns.length; i < len; i++) {\r\n                    if (s.columns[i].tree) {\r\n                        // save which column it was\r\n                        treecol = i;\r\n                        gs.treecol = treecol;\r\n                    } else {\r\n                        gs.gridcols.push(i);\r\n                    }\r\n                }\r\n                // set a unique ID for this table\r\n                this.uniq = Math.ceil(Math.random() * 1000);\r\n                this.rootid = container.attr(\"id\");\r\n\r\n                var msie = /msie/.test(navigator.userAgent.toLowerCase());\r\n                if (msie) {\r\n                    var version = parseFloat(navigator.appVersion.split(\"MSIE\")[1]);\r\n                    if (version < 8) {\r\n                        gs.defaultConf.display = \"inline\";\r\n                        gs.defaultConf.zoom = \"1\";\r\n                    }\r\n                }\r\n\r\n                // set up the classes we need\r\n                if (!styled) {\r\n                    styled = true;\r\n                    styles = [\r\n                        '.jstree-grid-cell {vertical-align: top; overflow:hidden;margin-left:0;position:relative;width: 100%;padding-left:7px;white-space: nowrap;}',\r\n                        '.jstree-grid-cell span {margin-right:0px;margin-right:0px;*display:inline;*+display:inline;white-space: nowrap;}',\r\n                        '.jstree-grid-separator {position:absolute; top:0; right:0; height:24px; margin-left: -2px; border-width: 0 2px 0 0; *display:inline; *+display:inline; margin-right:0px;width:0px;}',\r\n                        '.jstree-grid-header-cell {overflow: hidden; white-space: nowrap;padding: 1px 3px 2px 5px; cursor: default;}',\r\n                        '.jstree-grid-header-themeroller {border: 0; padding: 1px 3px;}',\r\n                        '.jstree-grid-header-regular {position:relative; background-color: #EBF3FD; z-index: 1;}',\r\n                        '.jstree-grid-hidden {display: none;}',\r\n                        '.jstree-grid-resizable-separator {cursor: col-resize; width: 2px;}',\r\n                        '.jstree-grid-separator-regular {border-color: #d0d0d0; border-style: solid;}',\r\n                        '.jstree-grid-cell-themeroller {border: none !important; background: transparent !important;}',\r\n                        '.jstree-grid-wrapper {table-layout: fixed; width: 100%; overflow: auto; position: relative;}',\r\n                        '.jstree-grid-midwrapper {display: table-row;}',\r\n                        '.jstree-grid-width-auto {width:auto;display:block;}',\r\n                        '.jstree-grid-column {display: table-cell; overflow: hidden;}',\r\n                        '.jstree-grid-ellipsis {text-overflow: ellipsis;}',\r\n                        '.jstree-grid-col-0 {width: 100%;}'\r\n                    ];\r\n                    $('<style type=\"text/css\">' + styles.join(\"\\n\") + '</style>').appendTo(\"head\");\r\n                }\r\n                this.gridWrapper = $(\"<div></div>\").addClass(\"jstree-grid-wrapper\").insertAfter(container);\r\n                this.midWrapper = $(\"<div></div>\").addClass(\"jstree-grid-midwrapper\").appendTo(this.gridWrapper);\r\n                // set the wrapper width\r\n                if (s.width) {\r\n                    this.gridWrapper.width(s.width);\r\n                }\r\n                if (s.height) {\r\n                    this.gridWrapper.height(s.height);\r\n                }\r\n                // create the data columns\r\n                for (var i = 0, len = cols.length; i < len; i++) {\r\n                    // create the column\r\n                    $(\"<div></div>\").addClass(\"jstree-default jstree-grid-column jstree-grid-column-\" + i + \" jstree-grid-column-root-\" + this.rootid).appendTo(this.midWrapper);\r\n                }\r\n                this.midWrapper.children(\"div:eq(\" + treecol + \")\").append(container);\r\n                container.addClass(\"jstree-grid-cell\");\r\n\r\n                //move header with scroll\r\n                if (gs.fixedHeader) {\r\n                    this.gridWrapper.scroll(function() {\r\n                        $(this).find('.jstree-grid-header').css('top', $(this).scrollTop());\r\n                    });\r\n                }\r\n\r\n                // copy original sort function\r\n                var defaultSort = $.proxy(this.settings.sort, this);\r\n\r\n                // override sort function\r\n                this.settings.sort = function(a, b) {\r\n                    var bigger, colrefs = this.colrefs;\r\n\r\n                    if (gs.sortOrder === 'text') {\r\n                        var caseInsensitiveSort = this.get_text(a).toLowerCase().localeCompare(this.get_text(b).toLowerCase());\r\n                        bigger = gs.caseInsensitive ? (caseInsensitiveSort === 1) : (defaultSort(a, b) === 1);\r\n                    } else {\r\n                        // gs.sortOrder just refers to the unique random name for this column\r\n                        // we need to get the correct value\r\n                        var nodeA = this.get_node(a),\r\n                            nodeB = this.get_node(b),\r\n                            value = colrefs[gs.sortOrder].value,\r\n                            valueA = typeof(value) === 'function' ? value(nodeA) : nodeA.data[value],\r\n                            valueB = typeof(value) === 'function' ? value(nodeB) : nodeB.data[value];\r\n                        if (typeof(valueA) && typeof(valueB) !== 'undefined') {\r\n                            bigger = gs.caseInsensitive ? valueA.toLowerCase() > valueB.toLowerCase() : valueA > valueB;\r\n                        }\r\n                    }\r\n\r\n                    if (!gs.sortAsc)\r\n                        bigger = !bigger;\r\n\r\n                    return bigger ? 1 : -1;\r\n                };\r\n\r\n                // sortable columns when jQuery UI is available\r\n                if (gs.draggable) {\r\n                    if (!$.ui || !$.ui.sortable) {\r\n                        console.warn('[jstree-grid] draggable option requires jQuery UI');\r\n                    } else {\r\n                        var from, to;\r\n\r\n                        $(this.midWrapper).sortable({\r\n                            axis: \"x\",\r\n                            handle: \".jstree-grid-header\",\r\n                            cancel: \".jstree-grid-separator\",\r\n                            start: function(event, ui) {\r\n                                from = ui.item.index();\r\n                            },\r\n                            stop: function(event, ui) {\r\n                                to = ui.item.index();\r\n                                gs.columns.splice(to, 0, gs.columns.splice(from, 1)[0]);\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n\r\n                //public function. validate searchObject keys, set columnSearch flag, calls jstree search and reset columnSearch flag\r\n                this.searchColumn = function(searchObj) {\r\n                    var validatedSearchObj = {};\r\n\r\n                    if (typeof searchObj == 'object') {\r\n                        for (var columnIndex in searchObj) {\r\n                            if (searchObj.hasOwnProperty(columnIndex)) {\r\n                                // keys should be the index of a column. This means the following:\r\n                                // only integers and smaller than the number of columns and bigger or equal to 0\r\n                                // (possilbe idea for in the future: ability to set key as a more human readable term like the column header and then map it here to an index)\r\n                                if (columnIndex % 1 === 0 && columnIndex < cols.length && columnIndex >= 0) {\r\n                                    validatedSearchObj[columnIndex] = searchObj[columnIndex];\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    columnSearch = validatedSearchObj;\r\n\r\n                    if (Object.keys(validatedSearchObj).length !== 0) {\r\n                        //the search string doesn't matter. we'll use the search string in the columnSearch object!\r\n                        this.search('someValue');\r\n                    } else { // nothing to search so reset jstree's search by passing an empty string\r\n                        this.search('');\r\n                    }\r\n                    columnSearch = false;\r\n                }\r\n\r\n\r\n                // set default search for each column with no user defined search function (used when doing a columnSearch)\r\n                for (var i = 0, len = cols.length; i < len; i++) {\r\n                    var column = cols[i];\r\n                    if (typeof(column.search_callback) !== \"function\") {\r\n                        // no search callback so set default function\r\n                        column.search_callback = function(str, columnValue, node, column) {\r\n                            var f = new $.vakata.search(str, true, {\r\n                                caseSensitive: searchSettings.case_sensitive,\r\n                                fuzzy: searchSettings.fuzzy\r\n                            });\r\n\r\n                            return f.search(columnValue).isMatch;\r\n\r\n                        };\r\n                    }\r\n                }\r\n\r\n                // if there was no overridden search_callback, we will provide it\r\n                // it will use the default per-node search algorithm, augmented by searching our data nodes\r\n                var searchSettings = this.settings.search;\r\n                var omniSearchCallback = searchSettings.search_callback;\r\n\r\n                if (!omniSearchCallback) {\r\n                    omniSearchCallback = function(str, node) {\r\n                        var i, f = new $.vakata.search(str, true, {\r\n                                caseSensitive: searchSettings.case_sensitive,\r\n                                fuzzy: searchSettings.fuzzy\r\n                            }),\r\n                            matched = f.search(node.text).isMatch,\r\n                            col;\r\n\r\n                        // only bother looking in each cell if it was not yet matched\r\n                        if (!matched) {\r\n                            for (var i = 0, len = cols.length; i < len; i++) {\r\n                                if (treecol === i) {\r\n                                    continue;\r\n                                }\r\n                                col = cols[i];\r\n                                matched = f.search(getCellData(col.value, node)).isMatch;\r\n                                if (matched) {\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        return matched;\r\n                    }\r\n                }\r\n\r\n                searchSettings.search_callback = function(str, node) {\r\n                    var matched = false;\r\n                    if (columnSearch) {\r\n                        //using logical AND for column searches (more options in the future)\r\n                        for (var columnIndex in columnSearch) {\r\n                            if (columnSearch.hasOwnProperty(columnIndex)) {\r\n                                var searchValue = columnSearch[columnIndex];\r\n                                if (searchValue == '') {\r\n                                    continue;\r\n                                }\r\n                                var col = cols[columnIndex];\r\n                                if (treecol == columnIndex) {\r\n                                    matched = col.search_callback(searchValue, node.text, node, col)\r\n                                } else {\r\n                                    matched = col.search_callback(searchValue, getCellData(col.value, node), node, col)\r\n                                }\r\n\r\n                                if (!matched) {\r\n                                    break; //found one that didn't match\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        container.trigger(\"columnSearch_grid.jstree\");\r\n                    } else {\r\n                        matched = omniSearchCallback(str, node);\r\n                        container.trigger(\"omniSearch_grid.jstree\");\r\n                    }\r\n                    return matched;\r\n                };\r\n                this._initialized = true;\r\n            }\r\n        };\r\n        this.init = function(el, options) {\r\n            parent.init.call(this, el, options);\r\n            this._initialize();\r\n        };\r\n        this.bind = function() {\r\n            parent.bind.call(this);\r\n            this._initialize();\r\n            this.element\r\n                .on(\"move_node.jstree create_node.jstree clean_node.jstree change_node.jstree\", $.proxy(function(e, data) {\r\n                    var target = this.get_node(data || \"#\", true);\r\n                    var id = _guid();\r\n                    this._detachColumns(id);\r\n                    this._prepare_grid(target);\r\n                    this._reattachColumns(id);\r\n                }, this))\r\n                .on(\"delete_node.jstree\", $.proxy(function(e, data) {\r\n                    if (data.node.id !== undefined) {\r\n                        var grid = this.gridWrapper,\r\n                            removeNodes = [data.node.id],\r\n                            i;\r\n                        // add children to remove list\r\n                        if (data.node && data.node.children_d) {\r\n                            removeNodes = removeNodes.concat(data.node.children_d);\r\n                        }\r\n                        findDataCell(this.uniq, removeNodes, this._gridSettings.gridcols).remove();\r\n                    }\r\n                }, this))\r\n                .on(\"show_node.jstree\", $.proxy(function(e, data) {\r\n                    this._hideOrShowTree(data.node, false);\r\n                }, this))\r\n                .on(\"hide_node.jstree\", $.proxy(function(e, data) {\r\n                    this._hideOrShowTree(data.node, true);\r\n                }, this))\r\n                .on(\"close_node.jstree\", $.proxy(function(e, data) {\r\n                    this._hide_grid(data.node);\r\n                }, this))\r\n                .on(\"open_node.jstree\", $.proxy(function(e, data) {}, this))\r\n                .on(\"load_node.jstree\", $.proxy(function(e, data) {}, this))\r\n                .on(\"loaded.jstree\", $.proxy(function(e) {\r\n                    this._prepare_headers();\r\n                    this.element.trigger(\"loaded_grid.jstree\");\r\n                }, this))\r\n                .on(\"ready.jstree\", $.proxy(function(e, data) {\r\n                    // find the line-height of the first known node\r\n                    var anchorHeight = this.element.find(\"[class~='jstree-anchor']:first\").outerHeight(),\r\n                        q,\r\n                        cls = this.element.attr(\"class\") || \"\";\r\n                    $('<style type=\"text/css\">div.jstree-grid-cell-root-' + this.rootid + ' {line-height: ' + anchorHeight + 'px; height: ' + anchorHeight + 'px;}</style>').appendTo(\"head\");\r\n\r\n                    // add container classes to the wrapper - EXCEPT those that are added by jstree, i.e. \"jstree\" and \"jstree-*\"\r\n                    q = cls.split(/\\s+/).map(function(i) {\r\n                        var match = i.match(/^jstree(-|$)/);\r\n                        return (match ? \"\" : i);\r\n                    });\r\n                    this.gridWrapper.addClass(q.join(\" \"));\r\n\r\n                }, this))\r\n                .on(\"move_node.jstree\", $.proxy(function(e, data) {\r\n                    var node = data.new_instance.element;\r\n                    //renderAWidth(node,this);\r\n                    // check all the children, because we could drag a tree over\r\n                    node.find(\"li > a\").each($.proxy(function(i, elm) {\r\n                        //renderAWidth($(elm),this);\r\n                    }, this));\r\n\r\n                }, this))\r\n                .on(\"hover_node.jstree\", $.proxy(function(node, selected, event) {\r\n                    var id = selected.node.id;\r\n                    if (this._hover_node !== null && this._hover_node !== undefined) {\r\n                        findDataCell(this.uniq, this._hover_node, this._gridSettings.gridcols).removeClass(\"jstree-hovered\");\r\n                    }\r\n                    this._hover_node = id;\r\n                    findDataCell(this.uniq, id, this._gridSettings.gridcols).addClass(\"jstree-hovered\");\r\n                }, this))\r\n                .on(\"dehover_node.jstree\", $.proxy(function(node, selected, event) {\r\n                    var id = selected.node.id;\r\n                    this._hover_node = null;\r\n                    findDataCell(this.uniq, id, this._gridSettings.gridcols).removeClass(\"jstree-hovered\");\r\n                }, this))\r\n                .on(\"select_node.jstree\", $.proxy(function(node, selected, event) {\r\n                    var id = selected.node.id;\r\n                    findDataCell(this.uniq, id, this._gridSettings.gridcols).addClass(\"jstree-clicked\");\r\n                    this.get_node(selected.node.id, true).children(\"div.jstree-grid-cell\").addClass(\"jstree-clicked\");\r\n                }, this))\r\n                .on(\"deselect_node.jstree\", $.proxy(function(node, selected, event) {\r\n                    var id = selected.node.id;\r\n                    findDataCell(this.uniq, id, this._gridSettings.gridcols).removeClass(\"jstree-clicked\");\r\n                }, this))\r\n                .on(\"deselect_all.jstree\", $.proxy(function(node, selected, event) {\r\n                    // get all of the ids that were unselected\r\n                    var ids = selected.node || [],\r\n                        i;\r\n                    findDataCell(this.uniq, ids, this._gridSettings.gridcols).removeClass(\"jstree-clicked\");\r\n                }, this))\r\n                .on(\"search.jstree\", $.proxy(function(e, data) {\r\n                    // search sometimes filters, so we need to hide all of the appropriate grid cells as well, and show only the matches\r\n                    var grid = this.gridWrapper,\r\n                        that = this,\r\n                        nodesToShow, startTime = new Date().getTime(),\r\n                        ids = getIds(data.nodes.filter(\".jstree-node\")),\r\n                        endTime;\r\n                    this.holdingCells = {};\r\n                    if (data.nodes.length) {\r\n                        var id = _guid();\r\n                        // save the cells we will hide\r\n                        var cells = grid.find('div.jstree-grid-cell-regular');\r\n                        this._detachColumns(id);\r\n                        if (this._data.search.som) {\r\n                            // create the list of nodes we want to look at\r\n                            if (this._data.search.smc) {\r\n                                nodesToShow = data.nodes.add(data.nodes.find('.jstree-node'));\r\n                            }\r\n                            nodesToShow = (nodesToShow || data.nodes).add(data.nodes.parentsUntil(\".jstree\"));\r\n\r\n                            // hide all of the grid cells\r\n                            cells.hide();\r\n                            // show only those that match\r\n                            nodesToShow.filter(\".jstree-node\").each(function(i, node) {\r\n                                var id = node.id;\r\n                                if (id) {\r\n                                    that._prepare_grid(node);\r\n                                    for (var i = 0, len = that._gridSettings.gridcols.length; i < len; i++) {\r\n                                        if (i === that._gridSettings.treecol) {\r\n                                            continue;\r\n                                        }\r\n                                        findDataCell(that.uniq, id, that._gridSettings.gridcols[i], $(that._domManipulation.columns[i])).show();\r\n                                    }\r\n                                }\r\n                            });\r\n                        }\r\n\r\n                        for (var i = 0, len = this._gridSettings.gridcols.length; i < len; i++) {\r\n                            if (i === this._gridSettings.treecol) {\r\n                                continue;\r\n                            }\r\n                            findDataCell(that.uniq, ids, this._gridSettings.gridcols[i], $(this._domManipulation.columns[i])).addClass(SEARCHCLASS);\r\n                        }\r\n                        this._reattachColumns(id);\r\n                        endTime = new Date().getTime();\r\n                        this.element.trigger(\"search-complete.jstree-grid\", [{\r\n                            time: endTime - startTime\r\n                        }]);\r\n                    }\r\n                    return true;\r\n                }, this))\r\n                .on(\"clear_search.jstree\", $.proxy(function(e, data) {\r\n                    // search has been cleared, so we need to show all rows\r\n                    var grid = this.gridWrapper,\r\n                        ids = getIds(data.nodes.filter(\".jstree-node\"));\r\n                    grid.find('div.jstree-grid-cell').show();\r\n                    findDataCell(this.uniq, ids, this._gridSettings.gridcols).removeClass(SEARCHCLASS);\r\n                    return true;\r\n                }, this))\r\n                .on(\"copy_node.jstree\", function(e, data) {\r\n                    var newtree = data.new_instance,\r\n                        oldtree = data.old_instance,\r\n                        obj = newtree.get_node(data.node, true);\r\n                    copyData(oldtree, data.original, newtree, data.node, true);\r\n                    newtree._detachColumns(obj.id);\r\n                    newtree._prepare_grid(obj);\r\n                    newtree._reattachColumns(obj.id);\r\n                    return true;\r\n                })\r\n                .on(\"show_ellipsis.jstree\", $.proxy(function(e, data) {\r\n                    this.gridWrapper.find(\".jstree-grid-cell\").add(\".jstree-grid-header\", this.gridWrapper).addClass(\"jstree-grid-ellipsis\");\r\n                    return true;\r\n                }, this))\r\n                .on(\"hide_ellipsis.jstree\", $.proxy(function(e, data) {\r\n                    this.gridWrapper.find(\".jstree-grid-cell\").add(\".jstree-grid-header\", this.gridWrapper).removeClass(\"jstree-grid-ellipsis\");\r\n                    return true;\r\n                }, this));\r\n            if (this._gridSettings.isThemeroller) {\r\n                this.element\r\n                    .on(\"select_node.jstree\", $.proxy(function(e, data) {\r\n                        data.rslt.obj.children(\"[class~='jstree-anchor']\").nextAll(\"div\").addClass(\"ui-state-active\");\r\n                    }, this))\r\n                    .on(\"deselect_node.jstree deselect_all.jstree\", $.proxy(function(e, data) {\r\n                        data.rslt.obj.children(\"[class~='jstree-anchor']\").nextAll(\"div\").removeClass(\"ui-state-active\");\r\n                    }, this))\r\n                    .on(\"hover_node.jstree\", $.proxy(function(e, data) {\r\n                        data.rslt.obj.children(\"[class~='jstree-anchor']\").nextAll(\"div\").addClass(\"ui-state-hover\");\r\n                    }, this))\r\n                    .on(\"dehover_node.jstree\", $.proxy(function(e, data) {\r\n                        data.rslt.obj.children(\"[class~='jstree-anchor']\").nextAll(\"div\").removeClass(\"ui-state-hover\");\r\n                    }, this));\r\n            }\r\n\r\n            if (this._gridSettings.stateful) {\r\n                this.element\r\n                    .on(\"resize_column.jstree-grid\", $.proxy(function(e, col, width) {\r\n                        localStorage['jstree-root-' + this.rootid + '-column-' + col] = width;\r\n                    }, this));\r\n            }\r\n        };\r\n\r\n        // tear down the tree entirely\r\n        this.teardown = function() {\r\n            var gw = this.gridWrapper,\r\n                container = this.element,\r\n                gridparent = gw.parent();\r\n            container.detach();\r\n            gw.remove();\r\n            gridparent.append(container);\r\n            parent.teardown.call(this);\r\n        };\r\n        // clean the grid in case of redraw or refresh entire tree\r\n        this._clean_grid = function(target, id) {\r\n            var grid = this.gridWrapper;\r\n            if (target) {\r\n                findDataCell(this.uniq, id, this._gridSettings.gridcols).remove();\r\n            } else {\r\n                // get all of the `div` children in all of the `td` in dataRow except for :first (that is the tree itself) and remove\r\n                grid.find(\"div.jstree-grid-cell-regular\").remove();\r\n            }\r\n        };\r\n        // prepare the headers\r\n        this._prepare_headers = function() {\r\n            var header, i, col, _this = this,\r\n                gs = this._gridSettings,\r\n                cols = gs.columns || [],\r\n                width, defaultWidth = gs.columnWidth,\r\n                resizable = gs.resizable || false,\r\n                cl, ccl, val, name, last, tr = gs.isThemeroller,\r\n                classAdd = (tr ? \"themeroller\" : \"regular\"),\r\n                puller,\r\n                hasHeaders = false,\r\n                gridparent = this.gridparent,\r\n                rootid = this.rootid,\r\n                conf = gs.defaultConf,\r\n                coluuid,\r\n                borPadWidth = 0,\r\n                totalWidth = 0;\r\n\r\n            // save the original parent so we can reparent on destroy\r\n            this.parent = gridparent;\r\n\r\n            // save the references to columns by unique ID\r\n            this.colrefs = {};\r\n\r\n\r\n            // create the headers\r\n            for (var i = 0, len = cols.length; i < len; i++) {\r\n                //col = $(\"<col/>\");\r\n                //col.appendTo(colgroup);\r\n                cl = cols[i].headerClass || \"\";\r\n                ccl = cols[i].columnClass || \"\";\r\n                val = cols[i].header || \"\";\r\n                do {\r\n                    coluuid = String(Math.floor(Math.random() * 10000));\r\n                } while (this.colrefs[coluuid] !== undefined);\r\n                // create a unique name for this column\r\n                name = cols[i].value ? coluuid : \"text\";\r\n                this.colrefs[name] = cols[i];\r\n\r\n                if (val) {\r\n                    hasHeaders = true;\r\n                }\r\n                if (gs.stateful && localStorage['jstree-root-' + rootid + '-column-' + i])\r\n                    width = localStorage['jstree-root-' + rootid + '-column-' + i];\r\n                else\r\n                    width = cols[i].width || defaultWidth;\r\n\r\n                var minWidth = cols[i].minWidth || width;\r\n                var maxWidth = cols[i].maxWidth || width;\r\n\r\n                // we only deal with borders if width is not auto and not percentages\r\n                borPadWidth = tr ? 1 + 6 : 2 + 8; // account for the borders and padding\r\n                if (width !== 'auto' && typeof(width) !== \"string\") {\r\n                    width -= borPadWidth;\r\n                }\r\n                col = this.midWrapper.children(\"div.jstree-grid-column-\" + i);\r\n                last = $(\"<div></div>\").css(conf).addClass(\"jstree-grid-div-\" + this.uniq + \"-\" + i + \" \" + (tr ? \"ui-widget-header \" : \"\") + \" jstree-grid-header jstree-grid-header-cell jstree-grid-header-\" + classAdd + \" \" + cl + \" \" + ccl).html(val);\r\n                last.addClass((tr ? \"ui-widget-header \" : \"\") + \"jstree-grid-header jstree-grid-header-\" + classAdd);\r\n                if (this.settings.core.themes.ellipsis === true) {\r\n                    last.addClass('jstree-grid-ellipsis');\r\n                }\r\n                last.prependTo(col);\r\n                last.attr(COL_DATA_ATTR, name);\r\n                totalWidth += last.outerWidth();\r\n                puller = $(\"<div class='jstree-grid-separator jstree-grid-separator-\" + classAdd + (tr ? \" ui-widget-header\" : \"\") + (resizable ? \" jstree-grid-resizable-separator\" : \"\") + \"'>&nbsp;</div>\").appendTo(last);\r\n                col.width(width);\r\n                col.css(\"min-width\", minWidth);\r\n                col.css(\"max-width\", maxWidth);\r\n            }\r\n\r\n            last.addClass((tr ? \"ui-widget-header \" : \"\") + \"jstree-grid-header jstree-grid-header-last jstree-grid-header-\" + classAdd);\r\n            // if there is no width given for the last column, do it via automatic\r\n            if (cols[cols.length - 1].width === undefined) {\r\n                totalWidth -= width;\r\n                col.css({\r\n                    width: \"auto\"\r\n                });\r\n                last.addClass(\"jstree-grid-width-auto\").next(\".jstree-grid-separator\").remove();\r\n            }\r\n            if (hasHeaders) {\r\n                // save the offset of the div from the body\r\n                //gs.divOffset = header.parent().offset().left;\r\n                gs.header = header;\r\n            } else {\r\n                $(\"div.jstree-grid-header\").hide();\r\n            }\r\n\r\n            if (!this.bound && resizable) {\r\n                this.bound = true;\r\n                $(document).mouseup(function() {\r\n                    var ref, cols, width, headers, currentTree, colNum;\r\n                    if (isClickedSep) {\r\n                        colNum = toResize.prevAll(\".jstree-grid-column\").length;\r\n                        currentTree = toResize.closest(\".jstree-grid-wrapper\").find(\".jstree\");\r\n                        ref = $.jstree.reference(currentTree);\r\n                        cols = ref.settings.grid.columns;\r\n                        headers = toResize.parent().children(\"div.jstree-grid-column\");\r\n                        if (isNaN(colNum) || colNum < 0) {\r\n                            ref._gridSettings.treeWidthDiff = currentTree.find(\"ins:eq(0)\").width() + currentTree.find(\"[class~='jstree-anchor']:eq(0)\").width() - ref._gridSettings.columns[0].width;\r\n                        }\r\n                        width = ref._gridSettings.columns[colNum].width = parseFloat(toResize.css(\"width\"));\r\n                        isClickedSep = false;\r\n                        toResize = null;\r\n\r\n                        currentTree.trigger(\"resize_column.jstree-grid\", [colNum, width]);\r\n                    }\r\n                }).mousemove(function(e) {\r\n                    if (isClickedSep) {\r\n                        newMouseX = e.pageX;\r\n                        var diff = newMouseX - oldMouseX,\r\n                            oldPrevHeaderInner,\r\n                            oldPrevColWidth, newPrevColWidth;\r\n\r\n                        if (diff !== 0) {\r\n                            oldPrevHeaderInner = toResize.width();\r\n                            oldPrevColWidth = parseFloat(toResize.css(\"width\"));\r\n\r\n                            // handle a Chrome issue with columns set to auto\r\n                            // thanks to Brabus https://github.com/side-by-side\r\n                            if (!oldPrevColWidth) {\r\n                                oldPrevColWidth = toResize.innerWidth();\r\n                            }\r\n\r\n                            // make sure that diff cannot be beyond the left/right limits\r\n                            diff = diff < 0 ? Math.max(diff, -oldPrevHeaderInner) : diff;\r\n                            newPrevColWidth = oldPrevColWidth + diff;\r\n\r\n                            // only do this if we are not shrinking past 0 on left - and limit it to that amount\r\n                            if ((diff > 0 || oldPrevHeaderInner > 0) && newPrevColWidth > MINCOLWIDTH) {\r\n                                toResize.width(newPrevColWidth + \"px\");\r\n                                toResize.css(\"min-width\", newPrevColWidth + \"px\");\r\n                                toResize.css(\"max-width\", newPrevColWidth + \"px\");\r\n                                oldMouseX = newMouseX;\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n                this.gridWrapper.on(\"selectstart\", \".jstree-grid-resizable-separator\", function() {\r\n                        return false;\r\n                    }).on(\"mousedown\", \".jstree-grid-resizable-separator\", function(e) {\r\n                        isClickedSep = true;\r\n                        oldMouseX = e.pageX;\r\n                        toResize = $(this).closest(\"div.jstree-grid-column\");\r\n                        // the max rightmost position we will allow is the right-most of the wrapper minus a buffer (10)\r\n                        return false;\r\n                    })\r\n                    .on(\"dblclick\", \".jstree-grid-resizable-separator\", function(e) {\r\n                        var clickedSep = $(this),\r\n                            col = clickedSep.closest(\"div.jstree-grid-column\"),\r\n                            oldPrevColWidth = parseFloat(col.css(\"width\")),\r\n                            newWidth = 0,\r\n                            diff,\r\n                            colNum = col.prevAll(\".jstree-grid-column\").length,\r\n                            oldPrevHeaderInner = col.width(),\r\n                            newPrevColWidth;\r\n\r\n\r\n                        //find largest width\r\n                        col.find(\".jstree-grid-cell\").each(function() {\r\n                            var item = $(this),\r\n                                width;\r\n                            item.css(\"position\", \"absolute\");\r\n                            item.css(\"width\", \"auto\");\r\n                            width = item.outerWidth();\r\n                            item.css(\"position\", \"relative\");\r\n\r\n                            if (width > newWidth) {\r\n                                newWidth = width;\r\n                            }\r\n                        });\r\n\r\n                        diff = newWidth - oldPrevColWidth;\r\n\r\n                        // make sure that diff cannot be beyond the left limits\r\n                        diff = diff < 0 ? Math.max(diff, -oldPrevHeaderInner) : diff;\r\n                        newPrevColWidth = (oldPrevColWidth + diff) + \"px\";\r\n\r\n                        col.width(newPrevColWidth);\r\n                        col.css(\"min-width\", newPrevColWidth);\r\n                        col.css(\"max-width\", newPrevColWidth);\r\n\r\n                        $(this).closest(\".jstree-grid-wrapper\").find(\".jstree\").trigger(\"resize_column.jstree-grid\", [colNum, newPrevColWidth]);\r\n                    })\r\n                    .on(\"click\", \".jstree-grid-separator\", function(e) {\r\n                        // don't sort after resize\r\n                        e.stopPropagation();\r\n                    });\r\n            }\r\n            this.gridWrapper.on(\"click\", \".jstree-grid-header-cell\", function(e) {\r\n                if (!_this.sort) {\r\n                    return;\r\n                }\r\n\r\n                // get column\r\n                var name = $(this).attr(COL_DATA_ATTR);\r\n\r\n                // sort order\r\n                var symbol;\r\n                if (gs.sortOrder === name && gs.sortAsc === true) {\r\n                    gs.sortAsc = false;\r\n                    symbol = \"&darr;\";\r\n                } else {\r\n                    gs.sortOrder = name;\r\n                    gs.sortAsc = true;\r\n                    symbol = \"&uarr;\";\r\n                }\r\n\r\n                // add sort arrow\r\n                $(this.closest('.jstree-grid-wrapper')).find(\".jstree-grid-sort-icon\").remove();\r\n                $(\"<span></span>\").addClass(\"jstree-grid-sort-icon\").appendTo($(this)).html(symbol);\r\n\r\n                // sort by column\r\n                var rootNode = _this.get_node('#');\r\n                _this.sort(rootNode, true);\r\n                _this.redraw_node(rootNode, true);\r\n            });\r\n\r\n        };\r\n\r\n        this._domManipulation = null; // We'll store the column nodes in this object and an id for the grid-node that started the manipulation { id: \"id of the node that started the manipulation\", columns: { Key-Value-Pair col-No: Column }}\r\n\r\n        function _guid() {\r\n            function s4() {\r\n                return Math.floor((1 + Math.random()) * 0x10000)\r\n                    .toString(16)\r\n                    .substring(1);\r\n            }\r\n            return s4() + s4() + '-' + s4() + '-' + s4() + '-' +\r\n                s4() + '-' + s4() + s4() + s4();\r\n        }\r\n        /*\r\n         * Trys to detach the tree columns on massive dom manipulations\r\n         */\r\n        this._detachColumns = function(id) {\r\n            // if the columns are not detached, then detach them\r\n            if (this._domManipulation == null) {\r\n                var cols = this._gridSettings.columns || [],\r\n                    treecol = this._gridSettings.treecol,\r\n                    mw = this.midWrapper;\r\n                this._domManipulation = {\r\n                    id: id,\r\n                    columns: {}\r\n                };\r\n                for (var i = 0, len = cols.length; i < len; i++) {\r\n                    //if (treecol === i) {\r\n                    //  continue;\r\n                    //}\r\n                    this._domManipulation.columns[i] = mw.children(\".jstree-grid-column-\" + i)[0];\r\n                    this._domManipulation.columns[i].parentNode.removeChild(this._domManipulation.columns[i]);\r\n                }\r\n            }\r\n            return this._domManipulation;\r\n        }\r\n\r\n        this._reattachColumns = function(id) {\r\n            if (this._domManipulation == null) {\r\n                return false;\r\n            }\r\n            if (this._domManipulation.id === id) {\r\n                var cols = this._gridSettings.columns || [],\r\n                    treecol = this._gridSettings.treecol,\r\n                    mw = this.midWrapper;\r\n                for (var i = 0, len = cols.length; i < len; i++) {\r\n                    //if (treecol === i) {\r\n                    //  continue;\r\n                    //}\r\n                    mw[0].appendChild(this._domManipulation.columns[i]);\r\n                }\r\n                this._domManipulation = null;\r\n            }\r\n            return true;\r\n        }\r\n\r\n        /*\r\n         * Override open_node to detach the columns before redrawing child-nodes, and do reattach them afterwarts\r\n         */\r\n        this.open_node = function(obj, callback, animation) {\r\n            var isArray = $.isArray(obj);\r\n            var node = null;\r\n            if (!isArray) {\r\n                node = this.get_node(obj);\r\n                if (node.id === \"#\") {\r\n                    return;\r\n                } // wtf??? we ar in the root and do not need a open!\r\n            }\r\n            var id = isArray ? _guid() : node.id;\r\n            this._detachColumns(id);\r\n            var ret = parent.open_node.call(this, obj, callback, animation);\r\n            this._reattachColumns(id);\r\n            return ret;\r\n        }\r\n\r\n        /*\r\n         * Override redraw_node to correctly insert the grid\r\n         */\r\n        this.redraw_node = function(obj, deep, is_callback, force_render) {\r\n            var id = $.isArray(obj) ? _guid() : this.get_node(obj).id;\r\n            // we detach the columns once\r\n            this._detachColumns(id);\r\n            // first allow the parent to redraw the node\r\n            obj = parent.redraw_node.call(this, obj, deep, is_callback, force_render);\r\n            // next prepare the grid for a redrawn node - but only if ths node is not hidden (search does that)\r\n            if (obj) {\r\n                this._prepare_grid(obj);\r\n            }\r\n            // don't forget to reattach\r\n            this._reattachColumns(id);\r\n            return obj;\r\n        };\r\n        this.refresh = function() {\r\n            this._clean_grid();\r\n            return parent.refresh.apply(this, arguments);\r\n        };\r\n        /*\r\n         * Override set_id to update cell attributes\r\n         */\r\n        this.set_id = function(obj, id) {\r\n            var old, uniq = this.uniq;\r\n            if (obj) {\r\n                old = obj.id;\r\n            }\r\n            var result = parent.set_id.apply(this, arguments);\r\n            if (result) {\r\n                if (old !== undefined) {\r\n                    var grid = this.gridWrapper,\r\n                        oldNodes = [old],\r\n                        i;\r\n                    // get children\r\n                    if (obj && obj.children_d) {\r\n                        oldNodes = oldNodes.concat(obj.children_d);\r\n                    }\r\n                    // update id in children\r\n                    findDataCell(uniq, oldNodes, this._gridSettings.gridcols)\r\n                        .attr(NODE_DATA_ATTR, obj.id)\r\n                        .removeClass(generateCellId(uniq, old))\r\n                        .addClass(generateCellId(uniq, obj.id))\r\n                        .each(function(i, node) {\r\n                            $(node).attr('id', generateCellId(uniq, obj.id) + (i + 1));\r\n                        });\r\n                }\r\n            }\r\n            return result;\r\n        };\r\n\r\n        this._hideOrShowTree = function(node, hide) {\r\n            //Hides or shows a tree\r\n            this._detachColumns(node.id);\r\n            // show cells in each detachted column\r\n            this._hideOrShowNode(node, hide, this._gridSettings.columns || [], this._gridSettings.treecol);\r\n            this._reattachColumns(node.id);\r\n        }\r\n        this._hideOrShowNode = function(node, hide, cols, treecol) {\r\n            //Hides or shows a node with recursive calls to all open child-nodes\r\n            for (var i = 0, len = cols.length; i < len; i++) {\r\n                if (i === treecol) {\r\n                    continue;\r\n                }\r\n                var cells = findDataCell(this.uniq, node.id, i, $(this._domManipulation.columns[i]));\r\n                if (hide) {\r\n                    cells.addClass(\"jstree-grid-hidden\");\r\n                } else {\r\n                    cells.removeClass(\"jstree-grid-hidden\");\r\n                }\r\n            }\r\n            if (node.state.opened && node.children) {\r\n                for (var i = 0, len = node.children.length; i < len; i++) {\r\n                    this._hideOrShowNode(this.get_node(node.children[i]), hide, cols, treecol);\r\n                }\r\n            }\r\n        }\r\n        this._hide_grid = function(node) {\r\n            if (!node) {\r\n                return true;\r\n            }\r\n            this._detachColumns(node.id);\r\n            var children = node.children ? node.children : [],\r\n                cols = this._gridSettings.columns || [],\r\n                treecol = this._gridSettings.treecol;\r\n            // try to remove all children\r\n            for (var i = 0, len = children.length; i < len; i++) {\r\n                var child = this.get_node(children[i]);\r\n                // go through each column, remove all children with the correct ID name\r\n                for (var j = 0, lenj = cols.length; j < lenj; j++) {\r\n                    if (j === treecol) {\r\n                        continue;\r\n                    }\r\n                    findDataCell(this.uniq, child.id, j, $(this._domManipulation.columns[j])).remove();\r\n                }\r\n                if (child.state.opened) {\r\n                    this._hide_grid(child);\r\n                }\r\n            }\r\n\r\n\r\n            this._reattachColumns(node.id);\r\n        };\r\n        this.holdingCells = {};\r\n        this.getHoldingCells = function(obj, col, hc) {\r\n            if (obj.state.hidden || !obj.state.opened) {\r\n                return $();\r\n            }\r\n            var ret = $(),\r\n                children = obj.children || [],\r\n                child, i, uniq = this.uniq;\r\n            // run through each child, render it, and then render its children recursively\r\n            for (i = 0; i < children.length; i++) {\r\n                child = generateCellId(uniq, children[i]) + col;\r\n                if (hc[child]) {\r\n                    ret = ret.add(hc[child]).add(this.getHoldingCells(this.get_node(children[i]), col, hc));\r\n                    //delete hc[child];\r\n                }\r\n            }\r\n            return (ret);\r\n        };\r\n\r\n        /**\r\n         * put a grid cell in edit mode (input field to edit the data)\r\n         * @name edit(obj, col)\r\n         * @param  {mixed} obj\r\n         * @param  {obj} col definition\r\n         * @param  {element} cell element, either span or wrapping div\r\n         */\r\n        this._edit = function(obj, col, element) {\r\n            if (!obj) {\r\n                return false;\r\n            }\r\n            if (!obj.data) {\r\n                obj.data = {};\r\n            }\r\n            if (element) {\r\n                element = $(element);\r\n                if (element.prop(\"tagName\").toLowerCase() === \"div\") {\r\n                    element = element.children(\"span:first\");\r\n                }\r\n            } else {\r\n                // need to find the element - later\r\n                return false;\r\n            }\r\n            var rtl = this._data.core.rtl,\r\n                w = this.element.width(),\r\n                t = obj.data[col.value],\r\n                h1 = $(\"<\" + \"div />\", {\r\n                    css: {\r\n                        \"position\": \"absolute\",\r\n                        \"top\": \"-200px\",\r\n                        \"left\": (rtl ? \"0px\" : \"-1000px\"),\r\n                        \"visibility\": \"hidden\"\r\n                    }\r\n                }).appendTo(\"body\"),\r\n                h2 = $(\"<\" + \"input />\", {\r\n                    \"value\": t,\r\n                    \"class\": \"jstree-rename-input\",\r\n                    \"css\": {\r\n                        \"padding\": \"0\",\r\n                        \"border\": \"1px solid silver\",\r\n                        \"box-sizing\": \"border-box\",\r\n                        \"display\": \"inline-block\",\r\n                        \"height\": (this._data.core.li_height) + \"px\",\r\n                        \"lineHeight\": (this._data.core.li_height) + \"px\",\r\n                        \"width\": \"150px\" // will be set a bit further down\r\n                    },\r\n                    \"blur\": $.proxy(function() {\r\n                        var v = h2.val();\r\n                        // save the value if changed\r\n                        if (v === \"\" || v === t) {\r\n                            v = t;\r\n                        } else {\r\n                            obj.data[col.value] = v;\r\n                            this.element.trigger('update_cell.jstree-grid', {\r\n                                node: obj,\r\n                                col: col.value,\r\n                                value: v,\r\n                                old: t\r\n                            });\r\n                            var id = _guid();\r\n                            this._detachColumns(id);\r\n                            this._prepare_grid(this.get_node(obj, true));\r\n                            this._reattachColumns(id);\r\n                        }\r\n                        h2.remove();\r\n                        element.show();\r\n                    }, this),\r\n                    \"keydown\": function(event) {\r\n                        var key = event.which;\r\n                        if (key === 27) {\r\n                            this.value = t;\r\n                        }\r\n                        if (key === 27 || key === 13 || key === 37 || key === 38 || key === 39 || key === 40 || key === 32) {\r\n                            event.stopImmediatePropagation();\r\n                        }\r\n                        if (key === 27 || key === 13) {\r\n                            event.preventDefault();\r\n                            this.blur();\r\n                        }\r\n                    },\r\n                    \"click\": function(e) {\r\n                        e.stopImmediatePropagation();\r\n                    },\r\n                    \"mousedown\": function(e) {\r\n                        e.stopImmediatePropagation();\r\n                    },\r\n                    \"keyup\": function(event) {\r\n                        h2.width(Math.min(h1.text(\"pW\" + this.value).width(), w));\r\n                    },\r\n                    \"keypress\": function(event) {\r\n                        if (event.which === 13) {\r\n                            return false;\r\n                        }\r\n                    }\r\n                }),\r\n                fn = {\r\n                    fontFamily: element.css('fontFamily') || '',\r\n                    fontSize: element.css('fontSize') || '',\r\n                    fontWeight: element.css('fontWeight') || '',\r\n                    fontStyle: element.css('fontStyle') || '',\r\n                    fontStretch: element.css('fontStretch') || '',\r\n                    fontVariant: element.css('fontVariant') || '',\r\n                    letterSpacing: element.css('letterSpacing') || '',\r\n                    wordSpacing: element.css('wordSpacing') || ''\r\n                };\r\n            element.hide();\r\n            element.parent().append(h2);\r\n            h2.css(fn).width(Math.min(h1.text(\"pW\" + h2[0].value).width(), w))[0].select();\r\n        };\r\n\r\n        this.grid_hide_column = function(col) {\r\n            this.midWrapper.find(\".jstree-grid-column-\" + col).hide();\r\n        };\r\n        this.grid_show_column = function(col) {\r\n            this.midWrapper.find(\".jstree-grid-column-\" + col).show();\r\n        };\r\n\r\n        this._prepare_grid = function(obj) {\r\n            var gs = this._gridSettings,\r\n                c = gs.treeClass,\r\n                _this = this,\r\n                t,\r\n                cols = gs.columns || [],\r\n                width, tr = gs.isThemeroller,\r\n                uniq = this.uniq,\r\n                treecol = gs.treecol,\r\n                tree = this.element,\r\n                rootid = this.rootid,\r\n                classAdd = (tr ? \"themeroller\" : \"regular\"),\r\n                img, objData = this.get_node(obj),\r\n                defaultWidth = gs.columnWidth,\r\n                conf = gs.defaultConf,\r\n                cellClickHandler = function(tree, node, val, col, t) {\r\n                    return function(e) {\r\n                        //node = tree.find(\"#\"+node.attr(\"id\"));\r\n                        var event = eventer.create(\"select_cell.jstree-grid\");\r\n                        tree.trigger(event, [{\r\n                            value: val,\r\n                            column: col.header,\r\n                            node: node,\r\n                            grid: $(this),\r\n                            sourceName: col.value\r\n                        }]);\r\n                        if (!event.isDefaultPrevented()) {\r\n                            node.children(\".jstree-anchor\").trigger(\"click.jstree\", e);\r\n                        }\r\n                    };\r\n                },\r\n                cellRightClickHandler = function(tree, node, val, col, t) {\r\n                    return function(e) {\r\n                        if (gs.gridcontextmenu) {\r\n                            e.preventDefault();\r\n                            menu.popup(this, {\r\n                                'x': e.pageX,\r\n                                'y': e.pageY\r\n                            }, gs.gridcontextmenu(_this, tree, node, val, col, t, e.target));\r\n                        }\r\n                    };\r\n                },\r\n                hoverInHandler = function(node, jsTreeInstance) {\r\n                    return function() {\r\n                        jsTreeInstance.hover_node(node);\r\n                    };\r\n                },\r\n                hoverOutHandler = function(node, jsTreeInstance) {\r\n                    return function() {\r\n                        jsTreeInstance.dehover_node(node);\r\n                    };\r\n                },\r\n                i, val, cl, wcl, ccl, a, last, valClass, wideValClass, span, paddingleft, title, gridCellName, gridCellParentId, gridCellParent,\r\n                gridCellPrev, gridCellPrevId, gridCellNext, gridCellNextId, gridCellChild, gridCellChildId,\r\n                col, content, tmpWidth, mw = this.midWrapper,\r\n                column, lid = objData.id,\r\n                highlightSearch, isClicked,\r\n                peers = this.get_node(objData.parent).children,\r\n                // find my position in the list of peers. \"peers\" is the list of everyone at my level under my parent, in order\r\n                pos = $.inArray(lid, peers),\r\n                hc = this.holdingCells,\r\n                rendered = false,\r\n                closed;\r\n            // get our column definition\r\n            t = $(obj);\r\n\r\n            // find the a children\r\n            a = t.children(\"[class~='jstree-anchor']\");\r\n            highlightSearch = a.hasClass(SEARCHCLASS);\r\n            isClicked = a.hasClass(\"jstree-clicked\");\r\n\r\n            if (a.length === 1) {\r\n                closed = !objData.state.opened;\r\n                gridCellName = generateCellId(uniq, lid);\r\n                gridCellParentId = objData.parent === \"#\" ? null : objData.parent;\r\n                a.addClass(c);\r\n                //renderAWidth(a,_this);\r\n                renderATitle(a, t, _this);\r\n                last = a;\r\n\r\n                // calculate position ids once\r\n                gridCellPrevId = pos <= 0 ? objData.parent : findLastClosedNode(this, peers[pos - 1]);\r\n                gridCellNextId = pos >= peers.length - 1 ? \"NULL\" : peers[pos + 1];\r\n                gridCellChildId = objData.children && objData.children.length > 0 ? objData.children[0] : \"NULL\";\r\n\r\n                // find which column our tree shuld go in\r\n                var s = this.settings.grid;\r\n                for (var i = 0, len = cols.length; i < len; i++) {\r\n                    if (treecol === i) {\r\n                        continue;\r\n                    }\r\n                    col = cols[i];\r\n                    column = this._domManipulation == null ? mw.children(\"div:eq(\" + i + \")\") : $(this._domManipulation.columns[i]); //Geht the detached column not mw.children(\"div:eq(\"+i+\")\");\r\n                    // get the cellClass, the wideCellClass, and the columnClass\r\n                    cl = col.cellClass || \"\";\r\n                    wcl = col.wideCellClass || \"\";\r\n                    ccl = col.columnClass || \"\";\r\n\r\n                    // add a column class to the Column\r\n                    column.addClass(ccl);\r\n\r\n\r\n                    // get the contents of the cell - value could be a string or a function\r\n                    val = getCellData(col.value, objData);\r\n\r\n                    if (typeof(col.format) === \"function\") {\r\n                        val = col.format(val);\r\n                    }\r\n\r\n                    // put images instead of text if needed\r\n                    if (col.images) {\r\n                        img = col.images[val] || col.images[\"default\"];\r\n                        if (img) {\r\n                            content = img[0] === \"*\" ? '<span class=\"' + img.substr(1) + '\"></span>' : '<img src=\"' + img + '\">';\r\n                        }\r\n                    } else {\r\n                        content = val;\r\n                    }\r\n\r\n                    // content cannot be blank, or it messes up heights\r\n                    if (content === undefined || content === null || BLANKRE.test(content)) {\r\n                        content = \"&nbsp;\";\r\n                    }\r\n\r\n                    // get the valueClass\r\n                    valClass = col.valueClass && objData.data !== null && objData.data !== undefined ? objData.data[col.valueClass] || \"\" : \"\";\r\n                    if (valClass && col.valueClassPrefix && col.valueClassPrefix !== \"\") {\r\n                        valClass = col.valueClassPrefix + valClass;\r\n                    }\r\n                    // get the wideValueClass\r\n                    wideValClass = col.wideValueClass && objData.data !== null && objData.data !== undefined ? objData.data[col.wideValueClass] || \"\" : \"\";\r\n                    if (wideValClass && col.wideValueClassPrefix && col.wideValueClassPrefix !== \"\") {\r\n                        wideValClass = col.wideValueClassPrefix + wideValClass;\r\n                    }\r\n                    // get the title\r\n                    title = col.title && objData.data !== null && objData.data !== undefined ? objData.data[col.title] || \"\" : \"\";\r\n                    // strip out HTML\r\n                    title = title.replace(htmlstripre, '');\r\n\r\n                    // get the width\r\n                    paddingleft = 7;\r\n                    width = col.width || defaultWidth;\r\n                    if (width !== 'auto') {\r\n                        width = tmpWidth || (width - paddingleft);\r\n                    }\r\n\r\n                    last = findDataCell(uniq, lid, i, column);\r\n                    if (!last || last.length < 1) {\r\n                        last = $(\"<div></div>\");\r\n                        $(\"<span></span>\").appendTo(last);\r\n                        last.attr(\"id\", gridCellName + i);\r\n                        last.addClass(gridCellName);\r\n                        last.attr(NODE_DATA_ATTR, lid);\r\n                        if (highlightSearch) {\r\n                            last.addClass(SEARCHCLASS);\r\n                        } else {\r\n                            last.removeClass(SEARCHCLASS);\r\n                        }\r\n                        if (isClicked) {\r\n                            last.addClass(\"jstree-clicked\");\r\n                        } else {\r\n                            last.removeClass(\"jstree-clicked\");\r\n                        }\r\n                        if (this.settings.core.themes.ellipsis === true && i !== treecol) {\r\n                            last.addClass('jstree-grid-ellipsis');\r\n                        }\r\n\r\n                    }\r\n\r\n                    // we need to check the hidden-state and see if we need to hide the node\r\n                    if (objData.state.hidden) {\r\n                        last.addClass(\"jstree-grid-hidden\");\r\n                    } else {\r\n                        last.removeClass(\"jstree-grid-hidden\");\r\n                    }\r\n\r\n                    // we need to put it in the dataCell - after the parent, but the position matters\r\n                    // if we have no parent, then we are one of the root nodes, but still need to look at peers\r\n\r\n\r\n                    // if we are first, i.e. pos === 0, we go right after the parent;\r\n                    // if we are not first, and our previous peer (one before us) is closed, we go right after the previous peer cell\r\n                    // if we are not first, and our previous peer is opened, then we have to find its youngest & lowest closed child (incl. leaf)\r\n                    //\r\n                    // probably be much easier to go *before* our next one\r\n                    // but that one might not be drawn yet\r\n                    // here is the logic for jstree drawing:\r\n                    //   it draws peers from first to last or from last to first\r\n                    //   it draws children before a parent\r\n                    //\r\n                    // so I can rely on my *parent* not being drawn, but I cannot rely on my previous peer or my next peer being drawn\r\n\r\n                    // so we do the following:\r\n                    //   1- We are the first child: install after the parent\r\n                    //   2- Our previous peer is already drawn: install after the previous peer\r\n                    //   3- Our previous peer is not drawn, we have a child that is drawn: install right before our first child\r\n                    //   4- Our previous peer is not drawn, we have no child that is drawn, our next peer is drawn: install right before our next peer\r\n                    //   5- Our previous peer is not drawn, we have no child that is drawn, our next peer is not drawn: install right after parent\r\n                    gridCellPrev = findDataCell(uniq, gridCellPrevId, i, column);\r\n                    gridCellNext = findDataCell(uniq, gridCellNextId, i, column);\r\n                    gridCellChild = findDataCell(uniq, gridCellChildId, i, column);\r\n                    gridCellParent = findDataCell(uniq, gridCellParentId, i, column);\r\n\r\n\r\n                    // if our parent is already drawn, then we put this in the right order under our parent\r\n                    if (gridCellParentId) {\r\n                        if (gridCellParent && gridCellParent.length > 0) {\r\n                            if (gridCellPrev && gridCellPrev.length > 0) {\r\n                                last.insertAfter(gridCellPrev);\r\n                            } else if (gridCellChild && gridCellChild.length > 0) {\r\n                                last.insertBefore(gridCellChild);\r\n                            } else if (gridCellNext && gridCellNext.length > 0) {\r\n                                last.insertBefore(gridCellNext);\r\n                            } else {\r\n                                last.insertAfter(gridCellParent);\r\n                            }\r\n                            rendered = true;\r\n                        } else {\r\n                            rendered = false;\r\n                        }\r\n                        // always put it in the holding cells, and then sort when the parent comes in, in case parent is (re)drawn later\r\n                        hc[gridCellName + i] = last;\r\n                    } else {\r\n                        if (gridCellPrev && gridCellPrev.length > 0) {\r\n                            last.insertAfter(gridCellPrev);\r\n                        } else if (gridCellChild && gridCellChild.length > 0) {\r\n                            last.insertBefore(gridCellChild);\r\n                        } else if (gridCellNext && gridCellNext.length > 0) {\r\n                            last.insertBefore(gridCellNext);\r\n                        } else {\r\n                            last.appendTo(column);\r\n                        }\r\n                        rendered = true;\r\n                    }\r\n                    // do we have any children waiting for this cell? walk down through the children/grandchildren/etc tree\r\n                    if (rendered) {\r\n                        var toRen = this.getHoldingCells(objData, i, hc);\r\n                        last.after(toRen);\r\n                    }\r\n                    // need to make the height of this match the line height of the tree. How?\r\n                    span = last.children(\"span\");\r\n\r\n                    // create a span inside the div, so we can control what happens in the whole div versus inside just the text/background\r\n                    span.addClass(cl + \" \" + valClass).html(content);\r\n                    last = last.css(conf).addClass(\"jstree-grid-cell jstree-grid-cell-regular jstree-grid-cell-root-\" + rootid + \" jstree-grid-cell-\" + classAdd + \" \" + wcl + \" \" + wideValClass + (tr ? \" ui-state-default\" : \"\")).addClass(\"jstree-grid-col-\" + i).addClass(\"jstree-animated\");\r\n                    // add click handler for clicking inside a grid cell\r\n                    last.click(cellClickHandler(tree, t, val, col, this));\r\n                    last.on(\"contextmenu\", cellRightClickHandler(tree, t, val, col, this));\r\n                    last.hover(hoverInHandler(t, this), hoverOutHandler(t, this));\r\n\r\n                    if (title) {\r\n                        span.attr(\"title\", title);\r\n                    }\r\n\r\n                    tree.trigger(\"render_cell.jstree-grid\", [{\r\n                        value: val,\r\n                        column: col.header,\r\n                        node: t,\r\n                        sourceName: col.value\r\n                    }]);\r\n                }\r\n                last.addClass(\"jstree-grid-cell-last\" + (tr ? \" ui-state-default\" : \"\"));\r\n                // if there is no width given for the last column, do it via automatic\r\n                if (cols[cols.length - 1].width === undefined) {\r\n                    last.addClass(\"jstree-grid-width-auto\").next(\".jstree-grid-separator\").remove();\r\n                }\r\n            }\r\n            this.element.css({\r\n                'overflow-y': 'auto !important'\r\n            });\r\n        };\r\n        // clean up holding cells\r\n        this.holdingCells = {};\r\n\r\n        // need to do alternating background colors or borders\r\n    };\r\n\r\n    return $;\r\n});"]}