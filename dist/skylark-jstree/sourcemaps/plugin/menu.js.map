{"version":3,"sources":["plugin/menu.js"],"names":["define","langx","browser","eventer","noder","geom","$","right_to_left","popup","Menu","Evented","inherit","klassName","init","elm","options","$el","self","this","_options","mixin","hide_onmouseleave","icons","to","on","e","stopImmediatePropagation","contains","relatedTarget","clearTimeout","find","removeClass","end","siblings","hide","parentsUntil","addBack","addClass","_show_submenu","setTimeout","t","preventDefault","blur","parent","hasClass","_execute","attr","o","which","type","currentTarget","trigger","last","closest","first","children","focus","prevAll","length","show","nextAll","a","not","click","render","items","_parse","html","width","_trigger","event_name","document","reference","element","position","x","position_x","y","position_y","i","_disabled","isFunction","item","action","call","is_callback","tmp","str","sep","each","val","push","separator_before","_class","shortcut","title","icon","indexOf","label","shortcut_label","submenu","separator_after","replace","xl","offset","left","outerWidth","top","w","h","height","dw","window","scrollLeft","dh","scrollTop","css","data","cond","outerHeight","appendTo","body","is_visible","detach","target","m"],"mappings":"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","file":"../../plugin/menu.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-utils-dom/browser\",\r\n  \"skylark-utils-dom/eventer\",\r\n  \"skylark-utils-dom/noder\",\r\n  \"skylark-utils-dom/geom\",\r\n  \"skylark-utils-dom/query\"\r\n],function(langx,browser,eventer,noder,geom,$){\r\n\r\n\tvar popup = null;\r\n\tvar right_to_left ;\r\n\r\n\tvar Menu = langx.Evented.inherit({\r\n        klassName: \"Menu\",\r\n\r\n        init : function(elm,options) {\r\n        \tif (!options) {\r\n        \t\toptions = elm;\r\n        \t\telm = null;\r\n        \t}\r\n\t\t\tvar self = this,$el;\r\n\r\n\t\t\tthis._options = langx.mixin({\r\n\t\t\t\t\thide_onmouseleave\t: 0,\r\n\t\t\t\t\ticons\t\t\t\t: true\r\n\r\n\t\t\t},options);\r\n\r\n\t\t\tif (!elm) {\r\n\t\t\t\t$el = this.$el = $(\"<ul class='vakata-context'></ul>\");\r\n\t\t\t} else {\r\n\t\t\t\t$el = this.$el = $(elm);\r\n\t\t\t}\r\n\r\n\t\t\tvar to = false;\r\n\t\t\t$el.on(\"mouseenter\", \"li\", function (e) {\r\n\t\t\t\t\te.stopImmediatePropagation();\r\n\r\n\t\t\t\t\tif(noder.contains(this, e.relatedTarget)) {\r\n\t\t\t\t\t\t// премахнато заради delegate mouseleave по-долу\r\n\t\t\t\t\t\t// $(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\");\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(to) { clearTimeout(to); }\r\n\t\t\t\t\t$el.find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end();\r\n\r\n\t\t\t\t\t$(this)\r\n\t\t\t\t\t\t.siblings().find(\"ul\").hide().end().end()\r\n\t\t\t\t\t\t.parentsUntil(\".vakata-context\", \"li\").addBack().addClass(\"vakata-context-hover\");\r\n\t\t\t\t\tself._show_submenu(this);\r\n\t\t\t\t})\r\n\t\t\t\t// тестово - дали не натоварва?\r\n\t\t\t\t.on(\"mouseleave\", \"li\", function (e) {\r\n\t\t\t\t\tif(noder.contains(this, e.relatedTarget)) { return; }\r\n\t\t\t\t\t$(this).find(\".vakata-context-hover\").addBack().removeClass(\"vakata-context-hover\");\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"mouseleave\", function (e) {\r\n\t\t\t\t\t$(this).find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\");\r\n\t\t\t\t\tif(self._options.hide_onmouseleave) {\r\n\t\t\t\t\t\tto = setTimeout(\r\n\t\t\t\t\t\t\t(function (t) {\r\n\t\t\t\t\t\t\t\treturn function () { self.hide(); };\r\n\t\t\t\t\t\t\t}(this)), self._options.hide_onmouseleave);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.on(\"click\", \"a\", function (e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t//})\r\n\t\t\t\t//.on(\"mouseup\", \"a\", function (e) {\r\n\t\t\t\t\tif(!$(this).blur().parent().hasClass(\"vakata-context-disabled\") && self._execute($(this).attr(\"rel\")) !== false) {\r\n\t\t\t\t\t\tself.hide();\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.on('keydown', 'a', function (e) {\r\n\t\t\t\t\t\tvar o = null;\r\n\t\t\t\t\t\tswitch(e.which) {\r\n\t\t\t\t\t\t\tcase 13:\r\n\t\t\t\t\t\t\tcase 32:\r\n\t\t\t\t\t\t\t\te.type = \"click\";\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\t$(e.currentTarget).trigger(e);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 37:\r\n\t\t\t\t\t\t\t\tself.$el.find(\".vakata-context-hover\").last().closest(\"li\").first().find(\"ul\").hide().find(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").end().end().children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 38:\r\n\t\t\t\t\t\t\t\to = self.$el.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").prevAll(\"li:not(.vakata-context-separator)\").first();\r\n\t\t\t\t\t\t\t\tif(!o.length) { o = self.$el.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").last(); }\r\n\t\t\t\t\t\t\t\to.addClass(\"vakata-context-hover\").children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 39:\r\n\t\t\t\t\t\t\t\tself.$el.find(\".vakata-context-hover\").last().children(\"ul\").show().children(\"li:not(.vakata-context-separator)\").removeClass(\"vakata-context-hover\").first().addClass(\"vakata-context-hover\").children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 40:\r\n\t\t\t\t\t\t\t\to = self.$el.find(\"ul:visible\").addBack().last().children(\".vakata-context-hover\").removeClass(\"vakata-context-hover\").nextAll(\"li:not(.vakata-context-separator)\").first();\r\n\t\t\t\t\t\t\t\tif(!o.length) { o = self.$el.find(\"ul:visible\").addBack().last().children(\"li:not(.vakata-context-separator)\").first(); }\r\n\t\t\t\t\t\t\t\to.addClass(\"vakata-context-hover\").children('a').focus();\r\n\t\t\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tcase 27:\r\n\t\t\t\t\t\t\t\tself.hide();\r\n\t\t\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t//console.log(e.which);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t.on('keydown', function (e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar a = self.$el.find('.vakata-contextmenu-shortcut-' + e.which).parent();\r\n\t\t\t\t\tif(a.parent().not('.vakata-context-disabled')) {\r\n\t\t\t\t\t\ta.click();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\tthis.render();\r\n        },\r\n\r\n        render : function() {\r\n        \tvar items = this._options.items;\r\n\t\t\tif(this._parse(items)) {\r\n\t\t\t\tthis.$el.html(this.html);\r\n\t\t\t}\r\n\t\t\tthis.$el.width('');\r\n        },\r\n\r\n\t\t_trigger : function (event_name) {\r\n\t\t\t$(document).trigger(\"context_\" + event_name + \".sbswt\", {\r\n\t\t\t\t\"reference\"\t: this.reference,\r\n\t\t\t\t\"element\"\t: this.$el,\r\n\t\t\t\t\"position\"\t: {\r\n\t\t\t\t\t\"x\" : this.position_x,\r\n\t\t\t\t\t\"y\" : this.position_y\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t},        \r\n\r\n\t\t_execute : function (i) {\r\n\t\t\ti = this.items[i];\r\n\t\t\treturn i && (!i._disabled || (langx.isFunction(i._disabled) && !i._disabled({ \"item\" : i, \"reference\" : this.reference, \"element\" : this.$el }))) && i.action ? i.action.call(null, {\r\n\t\t\t\t\t\t\"item\"\t\t: i,\r\n\t\t\t\t\t\t\"reference\"\t: this.reference,\r\n\t\t\t\t\t\t\"element\"\t: this.$el,\r\n\t\t\t\t\t\t\"position\"\t: {\r\n\t\t\t\t\t\t\t\"x\" : this.position_x,\r\n\t\t\t\t\t\t\t\"y\" : this.position_y\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}) : false;\r\n\t\t},\r\n\t\t_parse : function (o, is_callback) {\r\n\t\t\tvar self = this,\r\n\t\t\t\treference = self._options.reference;\r\n\r\n\t\t\tif(!o) { return false; }\r\n\t\t\tif(!is_callback) {\r\n\t\t\t\tself.html\t\t= \"\";\r\n\t\t\t\tself.items\t= [];\r\n\t\t\t}\r\n\t\t\tvar str = \"\",\r\n\t\t\t\tsep = false,\r\n\t\t\t\ttmp;\r\n\r\n\t\t\tif(is_callback) { str += \"<\"+\"ul>\"; }\r\n\t\t\tlangx.each(o, function (i, val) {\r\n\t\t\t\tif(!val) { return true; }\r\n\t\t\t\tself.items.push(val);\r\n\t\t\t\tif(!sep && val.separator_before) {\r\n\t\t\t\t\tstr += \"<\"+\"li class='vakata-context-separator'><\"+\"a href='#' \" + (self._options.icons ? '' : 'style=\"margin-left:0px;\"') + \">&#160;<\"+\"/a><\"+\"/li>\";\r\n\t\t\t\t}\r\n\t\t\t\tsep = false;\r\n\t\t\t\tstr += \"<\"+\"li class='\" + (val._class || \"\") + (val._disabled === true || (langx.isFunction(val._disabled) && val._disabled({ \"item\" : val, \"reference\" : reference, \"element\" : self.$el })) ? \" vakata-contextmenu-disabled \" : \"\") + \"' \"+(val.shortcut?\" data-shortcut='\"+val.shortcut+\"' \":'')+\">\";\r\n\t\t\t\tstr += \"<\"+\"a href='#' rel='\" + (self.items.length - 1) + \"' \" + (val.title ? \"title='\" + val.title + \"'\" : \"\") + \">\";\r\n\t\t\t\tif(self._options.icons) {\r\n\t\t\t\t\tstr += \"<\"+\"i \";\r\n\t\t\t\t\tif(val.icon) {\r\n\t\t\t\t\t\tif(val.icon.indexOf(\"/\") !== -1 || val.icon.indexOf(\".\") !== -1) { str += \" style='background:url(\\\"\" + val.icon + \"\\\") center center no-repeat' \"; }\r\n\t\t\t\t\t\telse { str += \" class='\" + val.icon + \"' \"; }\r\n\t\t\t\t\t}\r\n\t\t\t\t\tstr += \"><\"+\"/i><\"+\"span class='vakata-contextmenu-sep'>&#160;<\"+\"/span>\";\r\n\t\t\t\t}\r\n\t\t\t\tstr += (langx.isFunction(val.label) ? val.label({ \"item\" : i, \"reference\" : reference, \"element\" : self.$el }) : val.label) + (val.shortcut?' <span class=\"vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+val.shortcut+'\">'+ (val.shortcut_label || '') +'</span>':'') + \"<\"+\"/a>\";\r\n\t\t\t\tif(val.submenu) {\r\n\t\t\t\t\ttmp = self._parse(val.submenu, true);\r\n\t\t\t\t\tif(tmp) { str += tmp; }\r\n\t\t\t\t}\r\n\t\t\t\tstr += \"<\"+\"/li>\";\r\n\t\t\t\tif(val.separator_after) {\r\n\t\t\t\t\tstr += \"<\"+\"li class='vakata-context-separator'><\"+\"a href='#' \" + (self._options.icons ? '' : 'style=\"margin-left:0px;\"') + \">&#160;<\"+\"/a><\"+\"/li>\";\r\n\t\t\t\t\tsep = true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tstr  = str.replace(/<li class\\='vakata-context-separator'\\><\\/li\\>$/,\"\");\r\n\t\t\tif(is_callback) { str += \"</ul>\"; }\r\n\t\t\t/**\r\n\t\t\t * triggered on the document when the contextmenu is parsed (HTML is built)\r\n\t\t\t * @event\r\n\t\t\t * @plugin contextmenu\r\n\t\t\t * @name context_parse.vakata\r\n\t\t\t * @param {jQuery} reference the element that was right clicked\r\n\t\t\t * @param {jQuery} element the DOM element of the menu itself\r\n\t\t\t * @param {Object} position the x & y coordinates of the menu\r\n\t\t\t */\r\n\t\t\tif(!is_callback) { self.html = str; self._trigger(\"parse\"); }\r\n\t\t\treturn str.length > 10 ? str : false;\r\n\t\t},\r\n\t\t_show_submenu : function (o) {\r\n\t\t\to = $(o);\r\n\t\t\tif(!o.length || !o.children(\"ul\").length) { return; }\r\n\t\t\tvar e = o.children(\"ul\"),\r\n\t\t\t\txl = o.offset().left,\r\n\t\t\t\tx = xl + o.outerWidth(),\r\n\t\t\t\ty = o.offset().top,\r\n\t\t\t\tw = e.width(),\r\n\t\t\t\th = e.height(),\r\n\t\t\t\tdw = $(window).width() + $(window).scrollLeft(),\r\n\t\t\t\tdh = $(window).height() + $(window).scrollTop();\r\n\t\t\t// може да се спести е една проверка - дали няма някой от класовете вече нагоре\r\n\t\t\tif(right_to_left) {\r\n\t\t\t\to[x - (w + 10 + o.outerWidth()) < 0 ? \"addClass\" : \"removeClass\"](\"vakata-context-left\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\to[x + w > dw  && xl > dw - x ? \"addClass\" : \"removeClass\"](\"vakata-context-right\");\r\n\t\t\t}\r\n\t\t\tif(y + h + 10 > dh) {\r\n\t\t\t\te.css(\"bottom\",\"-1px\");\r\n\t\t\t}\r\n\r\n\t\t\t//if does not fit - stick it to the side\r\n\t\t\tif (o.hasClass('vakata-context-right')) {\r\n\t\t\t\tif (xl < w) {\r\n\t\t\t\t\te.css(\"margin-right\", xl - w);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (dw - x < w) {\r\n\t\t\t\t\te.css(\"margin-left\", dw - x - w);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\te.show();\r\n\t\t},\r\n\t\tshow : function (reference, position, data) {\r\n\t\t\tvar o, e, x, y, w, h, dw, dh, cond = true;\r\n\t\t\tswitch(cond) {\r\n\t\t\t\tcase (!position && !reference):\r\n\t\t\t\t\treturn false;\r\n\t\t\t\tcase (!!position && !!reference):\r\n\t\t\t\t\tthis.reference\t= reference;\r\n\t\t\t\t\tthis.position_x\t= position.x;\r\n\t\t\t\t\tthis.position_y\t= position.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase (!position && !!reference):\r\n\t\t\t\t\tthis.reference\t= reference;\r\n\t\t\t\t\to = reference.offset();\r\n\t\t\t\t\tthis.position_x\t= o.left + reference.outerHeight();\r\n\t\t\t\t\tthis.position_y\t= o.top;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase (!!position && !reference):\r\n\t\t\t\t\tthis.position_x\t= position.x;\r\n\t\t\t\t\tthis.position_y\t= position.y;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tif(!!reference && !data && $(reference).data('vakata_contextmenu')) {\r\n\t\t\t\tdata = $(reference).data('vakata_contextmenu');\r\n\t\t\t}\r\n\r\n\t\t\tif(this.items.length) {\r\n\t\t\t\tthis.$el.appendTo(document.body);\r\n\t\t\t\te = this.$el;\r\n\t\t\t\tx = this.position_x;\r\n\t\t\t\ty = this.position_y;\r\n\t\t\t\tw = e.width();\r\n\t\t\t\th = e.height();\r\n\t\t\t\tdw = $(window).width() + $(window).scrollLeft();\r\n\t\t\t\tdh = $(window).height() + $(window).scrollTop();\r\n\t\t\t\tif(right_to_left) {\r\n\t\t\t\t\tx -= (e.outerWidth() - $(reference).outerWidth());\r\n\t\t\t\t\tif(x < $(window).scrollLeft() + 20) {\r\n\t\t\t\t\t\tx = $(window).scrollLeft() + 20;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(x + w + 20 > dw) {\r\n\t\t\t\t\tx = dw - (w + 20);\r\n\t\t\t\t}\r\n\t\t\t\tif(y + h + 20 > dh) {\r\n\t\t\t\t\ty = dh - (h + 20);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.$el\r\n\t\t\t\t\t.css({ \"left\" : x, \"top\" : y })\r\n\t\t\t\t\t.show()\r\n\t\t\t\t\t.find('a').first().focus().parent().addClass(\"vakata-context-hover\");\r\n\t\t\t\tthis.is_visible = true;\r\n\r\n\t\t\t\tpopup = this;\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * triggered on the document when the contextmenu is shown\r\n\t\t\t\t * @event\r\n\t\t\t\t * @plugin contextmenu\r\n\t\t\t\t * @name context_show.vakata\r\n\t\t\t\t * @param {jQuery} reference the element that was right clicked\r\n\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\r\n\t\t\t\t * @param {Object} position the x & y coordinates of the menu\r\n\t\t\t\t */\r\n\t\t\t\tthis._trigger(\"show\");\r\n\t\t\t}\r\n\t\t},\r\n\t\thide : function () {\r\n\t\t\tif(this.is_visible) {\r\n\t\t\t\tthis.$el.hide().find(\"ul\").hide().end().find(':focus').blur().end().detach();\r\n\t\t\t\tthis.is_visible = false;\r\n\t\t\t\tpopup = null;\r\n\t\t\t\t/**\r\n\t\t\t\t * triggered on the document when the contextmenu is hidden\r\n\t\t\t\t * @event\r\n\t\t\t\t * @plugin contextmenu\r\n\t\t\t\t * @name context_hide.vakata\r\n\t\t\t\t * @param {jQuery} reference the element that was right clicked\r\n\t\t\t\t * @param {jQuery} element the DOM element of the menu itself\r\n\t\t\t\t * @param {Object} position the x & y coordinates of the menu\r\n\t\t\t\t */\r\n\t\t\t\tthis._trigger(\"hide\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n    });\t\r\n\r\n\t$(function () {\r\n\t\tright_to_left = $(document.body).css(\"direction\") === \"rtl\";\r\n\r\n\t\t$(document)\r\n\t\t\t.on(\"mousedown.sbswt.popup\", function (e) {\r\n\t\t\t\tif(popup && popup.$el[0] !== e.target  && !noder.contains(popup.$el[0], e.target)) {\r\n\t\t\t\t\tpopup.hide();\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.on(\"context_show.sbswt.popup\", function (e, data) {\r\n\t\t\t\tpopup.$el.find(\"li:has(ul)\").children(\"a\").addClass(\"vakata-context-parent\");\r\n\t\t\t\tif(right_to_left) {\r\n\t\t\t\t\tpopup.$el.addClass(\"vakata-context-rtl\").css(\"direction\", \"rtl\");\r\n\t\t\t\t}\r\n\t\t\t\t// also apply a RTL class?\r\n\t\t\t\tpopup.$el.find(\"ul\").hide().end();\r\n\t\t\t});\r\n\t});\r\n\r\n\tMenu.popup = function (reference, position, data) {\r\n\t\tvar m = new Menu({\r\n\t\t\treference : reference,\r\n\t\t\titems : data\r\n\t\t});\r\n\t\tm.show(reference,position);\r\n\t};\r\n\r\n\tMenu.hide = function() {\r\n\t\tif (popup) {\r\n\t\t\tpopup.hide();\r\n\t\t}\r\n\t}\r\n\r\n\treturn Menu;\r\n\r\n});"]}