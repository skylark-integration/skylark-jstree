{"version":3,"sources":["plugin/changed.js"],"names":["define","langx","browser","eventer","noder","geom","$","jstree","plugins","changed","options","parent","last","this","trigger","ev","data","i","j","replace","selected","deselected","tmp","length","push","slice","call","refresh","skip_loading","forget_state","apply","arguments"],"mappings":";;;;;;;AAAAA,QACE,sBACA,4BACA,4BACA,0BACA,yBACA,0BACA,WACA,SAASC,EAAMC,EAAQC,EAAQC,EAAMC,EAAKC,EAAEC,GAC7C,YAEA,KAAGD,EAAEC,OAAOC,QAAQC,QAiDpB,MA/CAH,GAAEC,OAAOC,QAAQC,QAAU,SAAUC,EAASC,GAC7C,GAAIC,KACJC,MAAKC,QAAU,SAAUC,EAAIC,GAC5B,GAAIC,GAAGC,CAIP,IAHIF,IACHA,MAE+B,YAA7BD,EAAGI,QAAQ,UAAU,IAAmB,CAC1CH,EAAKP,SAAYW,YAAeC,cAChC,IAAIC,KACJ,KAAIL,EAAI,EAAGC,EAAIN,EAAKW,OAAQN,EAAIC,EAAGD,IAClCK,EAAIV,EAAKK,IAAM,CAEhB,KAAIA,EAAI,EAAGC,EAAIF,EAAKI,SAASG,OAAQN,EAAIC,EAAGD,IACvCK,EAAIN,EAAKI,SAASH,IAIrBK,EAAIN,EAAKI,SAASH,IAAM,EAHxBD,EAAKP,QAAQW,SAASI,KAAKR,EAAKI,SAASH,GAM3C,KAAIA,EAAI,EAAGC,EAAIN,EAAKW,OAAQN,EAAIC,EAAGD,IACd,IAAjBK,EAAIV,EAAKK,KACXD,EAAKP,QAAQY,WAAWG,KAAKZ,EAAKK,GAGpCL,GAAOI,EAAKI,SAASK,QAatBd,EAAOG,QAAQY,KAAKb,KAAME,EAAIC,IAE/BH,KAAKc,QAAU,SAAUC,EAAcC,GAEtC,MADAjB,MACOD,EAAOgB,QAAQG,MAAMjB,KAAMkB,aAI7BzB","file":"../../plugin/changed.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-utils-dom/browser\",\r\n  \"skylark-utils-dom/eventer\",\r\n  \"skylark-utils-dom/noder\",\r\n  \"skylark-utils-dom/geom\",\r\n  \"skylark-utils-dom/query\",\r\n  \"../tree\"\r\n],function(langx,browser,eventer,noder,geom,$,jstree){\r\n\t\"use strict\";\r\n\r\n\tif($.jstree.plugins.changed) { return; }\r\n\r\n\t$.jstree.plugins.changed = function (options, parent) {\r\n\t\tvar last = [];\r\n\t\tthis.trigger = function (ev, data) {\r\n\t\t\tvar i, j;\r\n\t\t\tif(!data) {\r\n\t\t\t\tdata = {};\r\n\t\t\t}\r\n\t\t\tif(ev.replace('.jstree','') === 'changed') {\r\n\t\t\t\tdata.changed = { selected : [], deselected : [] };\r\n\t\t\t\tvar tmp = {};\r\n\t\t\t\tfor(i = 0, j = last.length; i < j; i++) {\r\n\t\t\t\t\ttmp[last[i]] = 1;\r\n\t\t\t\t}\r\n\t\t\t\tfor(i = 0, j = data.selected.length; i < j; i++) {\r\n\t\t\t\t\tif(!tmp[data.selected[i]]) {\r\n\t\t\t\t\t\tdata.changed.selected.push(data.selected[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttmp[data.selected[i]] = 2;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tfor(i = 0, j = last.length; i < j; i++) {\r\n\t\t\t\t\tif(tmp[last[i]] === 1) {\r\n\t\t\t\t\t\tdata.changed.deselected.push(last[i]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlast = data.selected.slice();\r\n\t\t\t}\r\n\t\t\t/**\r\n\t\t\t * triggered when selection changes (the \"changed\" plugin enhances the original event with more data)\r\n\t\t\t * @event\r\n\t\t\t * @name changed.jstree\r\n\t\t\t * @param {Object} node\r\n\t\t\t * @param {Object} action the action that caused the selection to change\r\n\t\t\t * @param {Array} selected the current selection\r\n\t\t\t * @param {Object} changed an object containing two properties `selected` and `deselected` - both arrays of node IDs, which were selected or deselected since the last changed event\r\n\t\t\t * @param {Object} event the event (if any) that triggered this changed event\r\n\t\t\t * @plugin changed\r\n\t\t\t */\r\n\t\t\tparent.trigger.call(this, ev, data);\r\n\t\t};\r\n\t\tthis.refresh = function (skip_loading, forget_state) {\r\n\t\t\tlast = [];\r\n\t\t\treturn parent.refresh.apply(this, arguments);\r\n\t\t};\r\n\t};\r\n\r\n\treturn $;\r\n});"]}